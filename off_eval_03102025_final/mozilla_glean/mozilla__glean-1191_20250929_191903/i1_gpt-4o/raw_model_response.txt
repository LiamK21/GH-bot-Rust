<Filename>
glean-core/src/upload/mod.rs
</Filename>
<imports>
use super::PingUploadManager;
use crate::Glean;
use crate::PingUploadTask;
use crate::new_glean;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_async_ping_directories_scanning_works() {
    let (glean, dir) = new_glean(None);

    let upload_manager = PingUploadManager::no_policy(dir.path(), false);

    while upload_manager.get_upload_task(&glean, false) == PingUploadTask::Wait {
        thread::sleep(Duration::from_millis(10));
    }

    assert_eq!(
        upload_manager.get_upload_task(&glean, false),
        PingUploadTask::Done
    );
}
</Rust>