#[test]
fn test_intermittent_uploader_test_suite() {
  let (mut glean, _) = new_glean(None);
  let ping_type = PingType::new("test", true, /* send_if_empty */ true, vec![]);
  glean.register_ping_type(&ping_type);
  glean.submit_ping(&ping_type, None).unwrap();
  let mut upload_manager = PingUploadManager::no_policy(glean.data_path.clone(), /* sync_scan */ true);
  let max_recoverable_failures = 3;
  upload_manager.policy.set_max_recoverable_failures(Some(max_recoverable_failures));
  for _ in 0..max_recoverable_failures {
    match upload_manager.get_upload_task(&glean, false) {
      PingUploadTask::Upload(req) => upload_manager.process_ping_upload_response(&glean, &req.document_id, RecoverableFailure),
      _ => panic!("Expected upload manager to return the next request!"),
    }
  }
  assert_eq!(upload_manager.get_upload_task(&glean, false), PingUploadTask::Done);
}