#[test]
fn test_memory_distribution_records_errors() {
    setup_glean!(glean);
    let meta = glean_core::CommonMetricData {
        name: "test_memory_distribution".to_string(),
        send_in_pings: vec!["test_ping".to_string()],
        lifetime: glean_core::Lifetime::Application,
        ..Default::default()
    };
    let metric = MemoryDistributionMetric::new(meta, MemoryUnit::Byte);

    // Accumulate a sample that should cause an error (value too large)
    metric.accumulate(2_000_000_000_000);

    dispatcher::block_on_queue();

    let error_count = metric.test_get_num_recorded_errors(
        ErrorType::InvalidValue,
        None,
    );

    assert_eq!(error_count, 1);
}