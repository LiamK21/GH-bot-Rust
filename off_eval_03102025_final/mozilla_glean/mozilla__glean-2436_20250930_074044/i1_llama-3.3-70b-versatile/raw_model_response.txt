<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use glean_core::upload::mod::PingUploadManager;
use glean_core::upload::request::create_date_header_value;
use chrono::Utc;
use chrono::DateTime;
use std::collections::HashMap;
</imports>
<Rust>
#[test]
fn test_date_header_set_at_upload_time() {
  let mut ping_upload_manager = PingUploadManager::new();
  let request = ping_upload_manager.get_upload_task().unwrap();
  let date_header_value = request.request.headers.get("Date").unwrap();
  let current_time = Utc::now();
  let current_date_header_value = create_date_header_value(current_time);
  assert!(date_header_value.clone() != current_date_header_value);
  let updated_request = ping_upload_manager.get_upload_task().unwrap();
  let updated_date_header_value = updated_request.request.headers.get("Date").unwrap();
  assert!(updated_date_header_value.clone() == current_date_header_value);
}</Rust>