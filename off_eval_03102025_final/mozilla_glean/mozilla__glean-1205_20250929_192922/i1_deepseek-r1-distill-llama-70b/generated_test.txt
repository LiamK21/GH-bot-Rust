#[test]
fn test_non_deletion_pings_not_uploaded_when_upload_disabled() {
    let (mut glean, _) = new_glean(None);

    // Disable upload
    glean.set_upload_enabled(false);

    // Create a test ping
    let ping_id = Uuid::new_v4().to_string();
    let ping = Ping::new(
        "test-ping".into(),
        "1".into(),
        ping_id,
    );

    // Enqueue the ping
    glean.submit_ping(&ping, None).unwrap();

    // Simulate upload process
    let upload_manager = PingUploadManager::no_policy(glean.data_path());
    while upload_manager.get_upload_task(&glean, false) == PingUploadTask::Wait {
        thread::sleep(Duration::from_millis(10));
    }

    // Verify no pings were uploaded
    assert_eq!(PingUploadTask::Done, upload_manager.get_upload_task(&glean, false));
}