#[test]
fn test_object_metric_string_set() {
    let temp_dir = tempdir().unwrap();
    let glean = launch_with_glean(|g| {
        let storage_dir = PathBuf::from(temp_dir.path());
        g.set_storage(storage_dir.clone());
        g
    });

    let metric = ObjectMetric::new(
        "test_object",
        "test_object",
        "test_object",
        "object".to_string(),
        None,
    );

    // Test valid JSON
    let valid_json = json!({"key": "value"});
    let json_str = serde_json::to_string(&valid_json).unwrap();
    metric.set_string(json_str.clone());

    let stored_value = glean.storage().get(&glean, &metric.meta).unwrap();
    let stored_json: Value = serde_json::from_str(&stored_value.value.object().unwrap()).unwrap();
    assert_eq!(stored_json, valid_json);

    // Test invalid JSON
    let invalid_json = "{\"invalid\": missing}".to_string();
    metric.set_string(invalid_json);

    let error = glean.storage().get_error(&glean, &metric.meta).unwrap();
    assert_eq!(error.error_type, ErrorType::InvalidValue);
    assert!(error.message.contains("Value did not match predefined schema"));
}