#[test]
fn test_glean_initialize_triggers_callbacks() {
    struct TestCallbacks {
        initialize_finished: Arc<Mutex<bool>>,
        upload_triggered: Arc<Mutex<bool>>,
        metric_ping_scheduled: Arc<Mutex<bool>>,
    }

    impl OnGleanEvents for TestCallbacks {
        fn on_initialize_finished(&self) {
            let mut finished = self.initialize_finished.lock().unwrap();
            *finished = true;
        }

        fn trigger_upload(&self) {
            let mut upload = self.upload_triggered.lock().unwrap();
            *upload = true;
        }

        fn start_metric_ping_scheduler(&self) {
            let mut scheduled = self.metric_ping_scheduled.lock().unwrap();
            *scheduled = true;
        }
    }

    let initialize_finished = Arc::new(Mutex::new(false));
    let upload_triggered = Arc::new(Mutex::new(false));
    let metric_ping_scheduled = Arc::new(Mutex::new(false));

    let callbacks = TestCallbacks {
        initialize_finished: Arc::clone(&initialize_finished),
        upload_triggered: Arc::clone(&upload_triggered),
        metric_ping_scheduled: Arc::clone(&metric_ping_scheduled),
    };

    let client_info = ClientInfoMetrics::unknown();
    let cfg = InternalConfiguration {
        upload_enabled: true,
        // other necessary fields
    };

    glean_initialize(cfg, client_info, Box::new(callbacks));

    assert!(*initialize_finished.lock().unwrap());
    assert!(*upload_triggered.lock().unwrap());
    assert!(*metric_ping_scheduled.lock().unwrap());
}