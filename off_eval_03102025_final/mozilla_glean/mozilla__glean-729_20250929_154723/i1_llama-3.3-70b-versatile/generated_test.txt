#[test]
fn test_clearing_queue_leaves_deletion_requests() {
  let upload_manager = Arc::new(PingUploadManager::new());
  let uuid = "123e4567-e89b-12d3-a456-426614174000";
  let path = "/submit/app_id/ping_name/schema_version/doc_id";
  let json = serde_json::json!({});

  // Add two regular pings
  upload_manager.enqueue_ping(uuid, path, json.clone());
  upload_manager.enqueue_ping(uuid, path, json.clone());

  // Add a deletion request ping
  let deletion_request_path = "/submit/app_id/deletion-request/schema_version/doc_id";
  upload_manager.enqueue_ping(uuid, deletion_request_path, json.clone());

  // Clear the queue
  let _lock = upload_manager.clear_ping_queue();

  // Get the next task
  let next_task = upload_manager.get_upload_task();

  match next_task {
    PingUploadTask::Upload(request) => assert!(request.is_deletion_request()),
    _ => panic!("Expected upload manager to return the next request!"),
  }

  // Verify there really isn't any other pings in the queue
  assert_eq!(upload_manager.get_upload_task(), PingUploadTask::Done);
}