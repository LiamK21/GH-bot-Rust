<Filename>glean-core/rlb/src/test.rs</Filename>
<imports>
use super::initialize_core_metrics;
use crate::core_metrics::ClientInfoMetrics;
use crate::Glean;
use crate::Configuration;
use crate::GLOBAL_APPLICATION_ID;
use crate::test_reset_glean;
use crate::lock_test;
use crate::set_upload_enabled;
use crate::private::StringMetric;
use crate::Lifetime;
use crate::CommonMetricData;
</imports>
<Rust>
#[test]
fn test_reset_glean_singleton_state() {
    let _lock = lock_test();

    let dir = tempfile::tempdir().unwrap();
    let tmpname = dir.path().display().to_string();

    let glean = Glean::new(
        Configuration {
            data_path: tmpname.clone(),
            application_id: GLOBAL_APPLICATION_ID.into(),
            upload_enabled: true,
            max_events: None,
            delay_ping_lifetime_io: false,
            channel: Some("test-channel".into()),
            server_endpoint: Some("invalid-test-host".into()),
            uploader: None,
        },
        ClientInfoMetrics::unknown(),
    );

    let metric = StringMetric::new(CommonMetricData {
        name: "test_metric".into(),
        category: "telemetry".into(),
        send_in_pings: vec!["default".into()],
        lifetime: Lifetime::Ping,
        disabled: false,
        ..Default::default()
    });

    metric.set_sync(&glean, "initial_value");
    assert_eq!(metric.test_get_value(None).unwrap(), "initial_value");

    test_reset_glean(
        Configuration {
            data_path: tmpname,
            application_id: GLOBAL_APPLICATION_ID.into(),
            upload_enabled: true,
            max_events: None,
            delay_ping_lifetime_io: false,
            channel: Some("test-channel".into()),
            server_endpoint: Some("invalid-test-host".into()),
            uploader: None,
        },
        ClientInfoMetrics::unknown(),
        true,
    );

    assert!(metric.test_get_value(None).is_none());
}
</Rust>