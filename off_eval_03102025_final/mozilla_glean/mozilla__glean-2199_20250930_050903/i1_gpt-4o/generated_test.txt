#[test]
fn test_url_truncation() {
    let glean = Glean::new_temporary();
    let metric = UrlMetric::new(CommonMetricData {
        name: "test_url".into(),
        category: "test".into(),
        send_in_pings: vec!["store1".into()],
        lifetime: crate::metrics::Lifetime::Ping,
        disabled: false,
        dynamic_label: None,
    });

    let long_path_base = "abcdefgh";
    let test_url = format!("glean://{}", long_path_base.repeat(2000));
    metric.set_sync(&glean, test_url);

    let expected = format!("glean://{}", long_path_base.repeat(1023));
    assert_eq!(metric.get_value(&glean, "store1").unwrap(), expected);
    assert_eq!(
        1,
        test_get_num_recorded_errors(&glean, metric.meta(), ErrorType::InvalidOverflow)
    );
}