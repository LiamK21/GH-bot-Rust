<Filename> glean-core/src/metrics/experiment.rs </Filename>
<imports> 
use crate::metrics::ExperimentMetric;
use std::collections::HashMap;
</imports>
<Rust>
#[test]
fn test_experiments_extra_limits() {
  let experiment_id = "test-experiment_id";
  let branch_id = "test-branch-id";
  let mut extras = HashMap::new();
  let too_long_key = "0123456789".repeat(5);
  let too_long_value = "0123456789".repeat(6);

  for n in 0..21 {
    extras.insert(format!("{}-{}", n, too_long_key), too_long_value.clone());
  }

  let experiment = ExperimentMetric::new(experiment_id.to_string(), branch_id.to_string(), Some(extras));
  let result = experiment;

  assert!(result.extra.unwrap().len() <= 20);
  for (key, value) in result.extra.unwrap().iter() {
    assert!(key.len() <= 30);
    assert!(value.len() <= 50);
  }
}
</Rust>