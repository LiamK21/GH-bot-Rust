#[test]
fn test_deletion_request_ping_upload() {
    // Initialize the upload manager
    let manager = PingUploadManager::new();

    // Enable logging for the test
    let _ = env_logger::builder()
        .is_test(true)
        .filter_level(LevelFilter::Trace)
        .try_init();

    // Enqueue some test pings
    manager.enqueue_ping("1", "path1", json!({"data": "test1"}));
    manager.enqueue_ping("2", "path2", json!({"data": "test2"}));
    // Enqueue a deletion-request ping
    manager.enqueue_ping("delete", "delete/path", json!({"deletion": true}));

    // Clear the queue, which should remove non-deletion pings
    let queue = manager.clear_ping_queue();

    // Verify only deletion-request pings remain
    assert_eq!(queue.len(), 1);
    assert_eq!(queue[0].uuid, "delete");

    // Try to upload the next ping
    let task = manager.upload_next_ping();
    match task {
        Some(PingUploadTask::Upload(request)) => {
            assert_eq!(request.uuid, "delete");
            assert_eq!(request.path, "delete/path");
        },
        _ => panic!("Expected deletion-request ping to be uploaded next"),
    }
}