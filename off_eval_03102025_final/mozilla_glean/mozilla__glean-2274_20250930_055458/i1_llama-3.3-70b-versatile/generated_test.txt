#[test]
fn test_schedule_internal_sets_last_sent_build_and_sends_overdue_ping() {
  let glean = super::new_glean(None).0;
  glean.app_build = "a build".into();
  let fake_now = FixedOffset::east(0)
    .ymd(2022, 11, 15)
    .and_hms(1, 0, 1);
  let submitter = Arc::new.MockSubmitter::new();
  let scheduler = super::new_scheduler();
  schedule_internal(&glean, submitter.clone(), scheduler, fake_now);
  let lsb_metric = get_last_sent_build_metric();
  assert_eq!(Some(glean.app_build.to_string()), lsb_metric.get_value(&glean, None));
  assert_eq!(1, submitter.submitted_pings.len());
  assert_eq!("overdue", submitter.submitted_pings[0].reason);
}