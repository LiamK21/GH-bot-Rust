#[test]
fn test_persist_ping_lifetime_data() {
    let dir = tempdir().unwrap();
    let str_dir = dir.path().display().to_string();
    let db = Database::new(&str_dir, true).unwrap();
    let test_storage = "test-storage";
    let test_value = "test-value";
    let test_metric_id = "telemetry_test.test_name";

    db.record_per_lifetime(
        Lifetime::Ping,
        test_storage,
        test_metric_id,
        &Metric::String(test_value.to_string()),
    )
    .unwrap();

    db.persist_ping_lifetime_data().unwrap();

    let store: SingleStore = db
        .rkv
        .open_single(Lifetime::Ping.as_str(), StoreOptions::create())
        .unwrap();
    let reader = db.rkv.read().unwrap();
    assert!(store
        .get(&reader, format!("{}#{}", test_storage, test_metric_id))
        .unwrap_or(None)
        .is_some());
}