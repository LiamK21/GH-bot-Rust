<Filename> glean-core/src/upload/request.rs </Filename>
<imports> 
use glean_core::src::upload::request::PingRequest;
use std::io::Cursor;
use flate2::read::GzDecoder;
use serde_json::json;
use serde_json::Value as JsonValue;
</imports>
<Rust>
#[test]
fn test_pretty_body_decompresses_and_formats_payload() {
  // Create a test ping request with a gzip compressed payload
  let json_payload = json!({"key": "value"});
  let json_string = json_payload.to_string();
  let mut gzipper = flate2::write::GzEncoder::new(Vec::new(), flate2::Compression::default());
  gzipper.write_all(json_string.as_bytes()).unwrap();
  let compressed_payload = gzipper.finish().unwrap();

  let ping_request = PingRequest {
    document_id: "document_id".to_string(),
    path: "path".to_string(),
    body: compressed_payload,
  };

  // Test that pretty_body decompresses and formats the payload correctly
  let pretty_body = ping_request.pretty_body().unwrap();
  let expected_body = json_payload.to_string_pretty().unwrap();
  assert_eq!(pretty_body, expected_body);
}
</Rust>