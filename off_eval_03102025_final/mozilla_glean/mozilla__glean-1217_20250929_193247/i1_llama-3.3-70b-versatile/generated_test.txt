#[test]
fn test_pending_pings_metric_updates() {
    let (mut glean, _) = new_glean(None);
    let dir = PathBuf::from("/tmp/test-upload-manager");
    let mut upload_manager = PingUploadManager::new(dir.clone(), Arc::new(Policy::default()), &glean);
    upload_manager.upload_metrics.pending_pings.set(0);
    let ping_type = PingType::new("test", true, /* send_if_empty */ true, vec![]);
    glean.register_ping_type(&ping_type);
    glean.submit_ping(&ping_type, None).unwrap();
    let directory_manager = PingDirectoryManager::new(dir.path());
    let pending_pings = directory_manager.process_dirs().pending_pings;
    let mut pending_pings_count: u64 = 0;
    for _ in pending_pings {
        pending_pings_count += 1;
    }
    upload_manager.process_pending_pings(&glean).unwrap();
    assert_eq!(upload_manager.upload_metrics.pending_pings.get(), Some(pending_pings_count));
}