#[test]
fn test_attribution_and_distribution_updates_before_glean_inits() {
    let dir = tempdir().unwrap();
    let tmpname = dir.path().to_path_buf();

    // No Glean, let's set and update some attribution + distribution.
    let mut attribution = AttributionMetrics {
        source: Some("source".into()),
        medium: Some("medium".into()),
        campaign: Some("campaign".into()),
        term: Some("term".into()),
        content: Some("content".into()),
    };
    let distribution = DistributionMetrics {
        name: Some("name".into()),
    };
    glean_update_attribution(attribution.clone());
    glean_update_distribution(distribution);

    let attribution_update = AttributionMetrics {
        term: Some("new term".into()),
        ..Default::default()
    };
    let distribution_update = DistributionMetrics {
        name: Some("different name".into()),
    };
    glean_update_attribution(attribution_update);
    glean_update_distribution(distribution_update.clone());

    initialize_inner(
        InternalConfiguration::new(true, tmpname, GLOBAL_APPLICATION_ID),
        ClientInfoMetrics::unknown(),
        Box::new(|_| {}),
    );

    // Ensure the updated attribution + distribution are correctly stored.
    attribution.term = Some("new term".into());
    assert_eq!(attribution, glean_test_get_attribution());
    assert_eq!(distribution_update, glean_test_get_distribution());
}