#[test]
fn test_trigger_upload_error_handling() {
  let callbacks = Arc::new(Mutex::new(TriggerUploadCallbacks));
  let state = State { callbacks };
  setup_state(state);
  let _ = initialize_inner(InternalConfiguration {}, ClientInfoMetrics {}, Box::new(TriggerUploadCallbacks));
  let state = global_state().lock().unwrap();
  let err = state.callbacks.trigger_upload();
  assert!(err.is_err());
}
struct TriggerUploadCallbacks;
impl OnGleanEvents for TriggerUploadCallbacks {
    fn trigger_upload(&self) -> Result<(), CallbackError> {
        Err(CallbackError::UnexpectedError)
    }
    fn start_metrics_ping_scheduler(&self) -> bool {
        false
    }
    fn cancel_uploads(&self) -> Result<(), CallbackError> {
        Ok(())
    }
}
struct State<'a> {
    callbacks: Arc<Mutex<dyn OnGleanEvents + 'a>>,
}
fn global_state<'a>() -> Arc<Mutex<State<'a>>> {
    Arc::new(Mutex::new(State { callbacks: Arc::new(Mutex::new(TriggerUploadCallbacks)) }))
}
struct InternalConfiguration {}
struct ClientInfoMetrics {}