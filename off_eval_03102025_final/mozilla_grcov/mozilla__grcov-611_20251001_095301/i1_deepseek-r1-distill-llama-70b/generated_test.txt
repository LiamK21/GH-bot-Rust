#[test]
fn test_execution_count_overflow_logging() {
    let mut results = Vec::new();
    let data = vec![b"test".to_vec()];
    let cov_result = CovResult {
        lines: btree_map::from_iter([(0, 0), (0, 1)]),
        functions: hash_map::from_iter([("test".to_string(), (0, 0))]),
        branches: hash_map::from_iter([("test".to_string(), (0, 0, 0, 0))]),
    };
    let warn_overflow = true;

    add_results(&mut results, "test".to_string(), cov_result, warn_overflow);

    let (logs, _) = test_log::capture().unwrap();
    let mut error_logged = false;
    let mut warning_logged = false;

    for log in logs {
        if log.level() == Level::Error && log.message() == "Execution count overflow detected." {
            error_logged = true;
        }
        if log.level() == Level::Warn && log.message() == "Execution count overflow detected." {
            warning_logged = true;
        }
    }

    assert!(
        warning_logged && !error_logged,
        "Expected a warning instead of an error for overflow"
    );
}