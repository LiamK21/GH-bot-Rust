#[test]
fn test_rewrite_paths_correctly_handles_multiple_lib_rs_files() {
    let mut result_map = std::collections::HashMap::new();
    result_map.insert("src/lib.rs".to_string(), empty_result!());
    result_map.insert("rustc/lib.rs".to_string(), empty_result!());

    let results = rewrite_paths(
        result_map,
        None,
        Some(PathBuf::from("src")),
        None,
        true,
        Vec::new(),
        None,
    );

    let mut results: Vec<(PathBuf, PathBuf, CovResult)> = results.collect();
    assert_eq!(results.len(), 2);

    let (abs_path1, rel_path1, _result1) = results.remove(0);
    let (abs_path2, rel_path2, _result2) = results.remove(0);

    assert!(abs_path1.is_absolute());
    assert!(abs_path2.is_absolute());
    assert_eq!(rel_path1, PathBuf::from("src/lib.rs"));
    assert_eq!(rel_path2, PathBuf::from("rustc/lib.rs"));
}