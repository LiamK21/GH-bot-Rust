<Filename>src/html.rs</Filename>
<imports>
use super::gen_index;
use super::HtmlGlobalStats;
use super::Config;
use std::path::Path;
use tera::Tera;
use std::collections::BTreeMap;
</imports>
<Rust>
#[test]
fn test_gen_index_includes_subdirectories() {
    let tera = Tera::default();
    let global_json = r#"
    {
        "dirs": {
            "": {
                "files": {
                    "main.rs": {
                        "stats": {"total_lines": 10, "covered_lines": 5, "total_funs": 1, "covered_funs": 1, "total_branches": 2, "covered_branches": 1},
                        "abs_prefix": null
                    }
                },
                "stats": {"total_lines": 10, "covered_lines": 5, "total_funs": 1, "covered_funs": 1, "total_branches": 2, "covered_branches": 1},
                "abs_prefix": null
            },
            "src": {
                "files": {
                    "lib.rs": {
                        "stats": {"total_lines": 20, "covered_lines": 15, "total_funs": 2, "covered_funs": 2, "total_branches": 4, "covered_branches": 3},
                        "abs_prefix": null
                    }
                },
                "stats": {"total_lines": 20, "covered_lines": 15, "total_funs": 2, "covered_funs": 2, "total_branches": 4, "covered_branches": 3},
                "abs_prefix": null
            }
        },
        "stats": {"total_lines": 30, "covered_lines": 20, "total_funs": 3, "covered_funs": 3, "total_branches": 6, "covered_branches": 4},
        "abs_prefix": null
    }
    "#;
    let global: HtmlGlobalStats = serde_json::from_str(global_json).unwrap();
    let conf = Config::default();
    let output = Path::new("/tmp/coverage_output");

    gen_index(&tera, &global, &conf, &output);

    let index_path = output.join("index.html");
    let index_content = std::fs::read_to_string(index_path).expect("Failed to read index.html");

    assert!(index_content.contains("main.rs"));
    assert!(index_content.contains("src"));
}
</Rust>