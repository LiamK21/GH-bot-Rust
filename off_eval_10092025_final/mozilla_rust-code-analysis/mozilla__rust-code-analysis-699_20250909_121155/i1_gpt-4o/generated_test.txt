#[test]
fn test_finalize_updates_minmax() {
    struct DummyParser;
    impl ParserTrait for DummyParser {}

    let mut state_stack = vec![
        State {
            space: Space {
                metrics: Metrics {
                    cyclomatic: Stats {
                        cyclomatic: 3.0,
                        cyclomatic_sum: 0.0,
                        cyclomatic_max: 0.0,
                        cyclomatic_min: f64::MAX,
                        n: 1,
                    },
                    ..Default::default()
                },
                ..Default::default()
            },
            ..Default::default()
        },
        State {
            space: Space {
                metrics: Metrics {
                    cyclomatic: Stats {
                        cyclomatic: 5.0,
                        cyclomatic_sum: 0.0,
                        cyclomatic_max: 0.0,
                        cyclomatic_min: f64::MAX,
                        n: 1,
                    },
                    ..Default::default()
                },
                ..Default::default()
            },
            ..Default::default()
        },
    ];

    finalize::<DummyParser>(&mut state_stack, 1);

    let last_state = state_stack.last().unwrap();
    let cyclomatic_stats = &last_state.space.metrics.cyclomatic;

    assert_eq!(cyclomatic_stats.cyclomatic_max, 5.0);
    assert_eq!(cyclomatic_stats.cyclomatic_min, 3.0);
    assert_eq!(cyclomatic_stats.cyclomatic_sum, 8.0);
}