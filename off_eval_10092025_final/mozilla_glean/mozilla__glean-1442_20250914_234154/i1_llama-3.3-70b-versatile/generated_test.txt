#[test]
fn test_glean_flush_rlb_dispatcher() {
  // Load the library
  let lib = libloading::Library::new("librlb.so").unwrap();

  // Get the symbol
  let sym: libloading::Symbol<unsafe extern "C" fn() -> ()> = lib.get(b"rlb_flush_dispatcher").unwrap();

  // Call the function to ensure the dispatcher is blocked
  unsafe { sym() };

  // Call glean_flush_rlb_dispatcher
  glean_flush_rlb_dispatcher();

  // Check if the dispatcher is unblocked
  // In this case, we're just checking if the log message is printed
  let logger = log::Logger::root(log::Appender::builder().build("test_log", Box::new(|rec| {
    if rec.args().to_string().contains("FLushing RLB dispatcher through the FFI") {
      true
    } else {
      false
    }
  })));
  log::set_logger(&logger).unwrap();
  log::set_max_level(log::LevelFilter::Trace);

  // Call glean_flush_rlb_dispatcher again to check if the dispatcher is unblocked
  glean_flush_rlb_dispatcher();
}