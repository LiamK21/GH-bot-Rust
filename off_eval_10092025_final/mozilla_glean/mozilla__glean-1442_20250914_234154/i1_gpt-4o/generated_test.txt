#[test]
fn test_glean_flush_rlb_dispatcher() {
    static WAS_CALLED: AtomicBool = AtomicBool::new(false);

    extern "C" fn mock_rlb_flush_dispatcher() {
        WAS_CALLED.store(true, Ordering::SeqCst);
    }

    unsafe {
        let original = rlb_flush_dispatcher.get();
        rlb_flush_dispatcher.set(Some(mock_rlb_flush_dispatcher));
        glean_flush_rlb_dispatcher();
        rlb_flush_dispatcher.set(original);
    }

    assert!(WAS_CALLED.load(Ordering::SeqCst));
}