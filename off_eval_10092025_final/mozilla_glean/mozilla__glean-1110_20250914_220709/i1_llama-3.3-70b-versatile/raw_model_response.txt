<Filename> glean-core/src/upload/directory.rs </Filename>
<imports> 
use super::PingDirectoryManager;
use std::fs;
use std::path::PathBuf;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_enqueue_cached_pings_deletes_oldest_pings_when_quota_is_hit() {
  let tmpdir = tempfile::tempdir().unwrap();
  let directory_manager = PingDirectoryManager::new(tmpdir.path());
  let ping_path = tmpdir.path().join("test_ping");
  fs::write(&ping_path, "test data").unwrap();
  let ping_size = fs::metadata(&ping_path).unwrap().len();
  directory_manager.delete_file("test_ping");
  fs::write(&ping_path, "test data").unwrap();
  let quota = ping_size;
  let expected_deleted_pings = 0;
  let actual_deleted_pings = directory_manager.process_dirs().pending_pings.len();
  assert_eq!(expected_deleted_pings, actual_deleted_pings);
  directory_manager.process_dirs();
  let quota = ping_size;
  let expected_deleted_pings = 1;
  let actual_deleted_pings = directory_manager.process_dirs().pending_pings.len();
  assert_ne!(expected_deleted_pings, actual_deleted_pings);
}</Rust>