#[test]
fn test_reset_glean_clears_stores() {
    let _lock = lock_test();
    let dir = tempdir().unwrap();
    let tmpname = dir.path().to_path_buf();

    // Create a test file in the data directory
    let test_file = tmpname.join("test_file");
    let mut file = File::create(&test_file).unwrap();
    file.write_all(b"test_data").unwrap();

    // Initialize Glean and record some data
    let cfg = Configuration {
        data_path: tmpname,
        application_id: GLOBAL_APPLICATION_ID.into(),
        upload_enabled: true,
        max_events: None,
        delay_ping_lifetime_io: false,
        server_endpoint: Some("invalid-test-host".into()),
        uploader: None,
        use_core_mps: false,
    };
    let _t = new_glean(Some(cfg), false);

    // Reset Glean with clear_stores = true
    test_reset_glean(cfg, ClientInfoMetrics::default(), true);

    // Attempt to read the test file which should have been removed
    let result = File::open(&test_file);
    assert!(result.is_err(), "Data directory was not cleared");
}