#[test]
fn test_in_flight_pings_dropped_metric() {
    let (mut storage, mut clock) = MockStorage::new(), MockClock::new();
    let metrics = UploadMetrics::new();
    let mut upload_manager = PingUploadManagerBuilder::new(&mut storage, &mut clock, metrics)
        .build();

    let ping = upload_manager.create_ping("test-ping", "1");

    // First enqueue: should succeed and mark as in-flight
    upload_manager.enqueue_ping(&ping).unwrap();

    // Second enqueue: should be rejected and increment the metric
    upload_manager.enqueue_ping(&ping).unwrap();

    assert_eq!(upload_manager.metrics().in_flight_pings_dropped.get(), 1);
}