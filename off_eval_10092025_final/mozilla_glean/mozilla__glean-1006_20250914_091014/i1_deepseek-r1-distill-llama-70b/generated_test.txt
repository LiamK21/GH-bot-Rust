#[test]
fn test_rate_limiter_set() {
    let mock_upload_manager = MockPingUploadManager::new();

    let data_dir = PathBuf::from("test_data");
    let result = glean_initialize_standalone_uploader(FfiStr::from(data_dir).into());

    assert!(result.is_ok());
    mock_upload_manager.expect_set_rate_limiter()
        .with(60, 10)
        .times(1)
        .verify();
}

mockall::mock! {
    pub struct MockPingUploadManager {
        pub(super) inner: PingUploadManager,
    }

    impl MockPingUploadManager {
        pub fn new() -> Self {
            Self {
                inner: PingUploadManager::new("test".to_string(), true),
            }
        }
    }

    pub trait UploadManagerTrait {
        fn set_rate_limiter(&mut self, seconds: u64, max_tasks: usize);
    }

    impl UploadManagerTrait for MockPingUploadManager {
        fn set_rate_limiter(&mut self, seconds: u64, max_tasks: usize) {
            self.inner.set_rate_limiter(seconds, max_tasks);
        }
    }
}