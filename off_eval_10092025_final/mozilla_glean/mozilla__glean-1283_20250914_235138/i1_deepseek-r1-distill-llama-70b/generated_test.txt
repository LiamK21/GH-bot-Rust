#[tokio::test]
async fn test_recoverable_upload_failure_logs_info() {
    let _guard = LogCapture::capture();

    let mock_server = mockito::Server::new();
    let _m = mock("POST", "/upload").with_status(500).create();

    let manager = PingUploadManager::new(&mock_server.url());

    let document_id = "test-doc-id";

    manager.upload(document_id).await.unwrap();

    tokio::task::yield_now().await;

    let logs = LogCapture::logs();

    assert!(logs.iter().any(|log| {
        log.level() == log::Level::Info && 
        log.message() == format!("Recoverable upload failure while attempting to send ping {}, will retry. Error was HttpStatus(500)", document_id)
    }));
}