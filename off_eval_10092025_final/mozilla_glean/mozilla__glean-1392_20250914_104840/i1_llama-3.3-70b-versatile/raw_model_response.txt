<Filename> glean-core/rlb/src/test.rs </Filename>
<imports> 
use super::block_on_dispatcher;
use super::BooleanMetric;
use super::CommonMetricData;
use super::Lifetime;
use super::was_initialize_called;
use std::panic::catch_unwind;
</imports>
<Rust>
#[test]
fn test_blocking_before_init_panics() {
  let _lock = std::sync::Mutex::new(());
  let _ = std::sync::Mutex::lock(_lock);
  destroy_glean(true);
  assert!(!was_initialize_called());
  let metric = BooleanMetric::new/CommonMetricData {
    name: "bool_metric".into(),
    category: "test".into(),
    send_in_pings: vec!["store1".into()],
    lifetime: Lifetime::Application,
    disabled: false,
    dynamic_label: None,
  };
  let result = catch_unwind(|| {
    let _ = metric.test_get_value("store1");
  });
  let err = result.unwrap_err();
  assert!(err.is::<&str>());
  let err = err.downcast_ref::<&str>().unwrap();
  assert!(err.contains("initialize was never called"));
}
</Rust>