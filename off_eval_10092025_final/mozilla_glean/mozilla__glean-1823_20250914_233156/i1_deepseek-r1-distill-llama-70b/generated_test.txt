#[test]
fn test_concurrent_labeled_metric_get() {
    let handle = 1;
    let label = "test_label";
    let num_threads = 10;

    let mut handles = vec![];

    let mut threads = vec![];
    for _ in 0..num_threads {
        let handle_clone = handle;
        let label_clone = label.to_string();
        let thread = thread::spawn(move || {
            let handle = unsafe { glean_labeled_counter_metric_get(handle_clone, FfiStr::from(&label_clone)) };
            handles.push(handle as usize);
        });
        threads.push(thread);
    }

    for thread in threads {
        thread.join().unwrap();
    }

    let first = handles[0];
    assert!(
        handles.iter().all(|x| *x == first),
        "All handles must be the same"
    );
}