<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use super::create_date_header_value;
use super::PingUploadManager;
use super::PingRequest;
use chrono::Utc;
use std::collections::HashMap;
</imports>
<Rust>
#[test]
fn test_date_header_set_at_upload_time() {
  let mut request = PingRequest {
    headers: HashMap::new(),
    ..Default::default()
  };
  let old_date = create_date_header_value(Utc::now());
  request.headers.insert("Date".to_string(), old_date);
  let mut manager = PingUploadManager::new();
  let mut queue = Vec::new();
  queue.push(request);
  manager.queue = queue;
  let task = manager.get_upload_task().unwrap();
  let new_date = task.request.headers.get("Date").unwrap();
  assert_ne!(old_date, *new_date);
}</Rust>