#[test]
fn test_maximum_wait_attempts_enforced() {
    let (glean, dir) = new_glean(None);

    let mut upload_manager = PingUploadManager::no_policy(dir.path(), /* sync_scan */ true);

    let max_wait_attempts = 3;
    upload_manager.policy.set_max_wait_attempts(Some(max_wait_attempts));

    for _ in 0..max_wait_attempts {
        assert_eq!(
            upload_manager.get_upload_task(&glean, false),
            PingUploadTask::Wait
        );
    }

    assert_eq!(
        upload_manager.get_upload_task(&glean, false),
        PingUploadTask::Done
    );
}