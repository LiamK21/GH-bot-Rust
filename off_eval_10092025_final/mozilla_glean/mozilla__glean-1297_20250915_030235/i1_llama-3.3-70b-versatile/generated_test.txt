#[test]
fn test_tasks_after_shutdown_are_not_processed() {
  let dispatcher = Dispatcher::new();
  let result = Arc::new(Mutex::new(Vec::new()));
  let result_clone = Arc::clone(&result);
  dispatcher.guard().launch(move || {
    result_clone.lock().unwrap().push(0);
  }).unwrap();
  dispatcher.guard().shutdown().unwrap();
  let result_clone = Arc::clone(&result);
  let handle = thread::spawn(move || {
    let _ = dispatcher.guard().launch(move || {
      result_clone.lock().unwrap().push(0);
    });
  });
  dispatcher.join().unwrap();
  handle.join().unwrap();
  assert_eq!(result.lock().unwrap().len(), 1);
}