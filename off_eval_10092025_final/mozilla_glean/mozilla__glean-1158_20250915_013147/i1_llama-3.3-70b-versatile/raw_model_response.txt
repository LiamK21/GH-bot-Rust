<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use super::PingUploadManager;
use super::PingUploadTask;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_max_wait_attempts() {
  let mut upload_manager = PingUploadManager::new("/tmp/glean-upload-manager", "Testing", true);
  upload_manager.set_rate_limiter(5, 1);
  upload_manager.enqueue_ping(&"glean", &"uuid1", &"/path", &"body", None);
  upload_manager.enqueue_ping(&"glean", &"uuid2", &"/path", &"body", None);
  assert_eq!(upload_manager.get_upload_task(&"glean", false), PingUploadTask::Upload(()));
  for _ in 0..3 {
    assert_eq!(upload_manager.get_upload_task(&"glean", false), PingUploadTask::Wait);
  }
  assert_eq!(upload_manager.get_upload_task(&"glean", false), PingUploadTask::Done);
  thread::sleep(Duration::from_secs(5));
  assert_eq!(upload_manager.get_upload_task(&"glean", false), PingUploadTask::Upload(()));
}
</Rust>