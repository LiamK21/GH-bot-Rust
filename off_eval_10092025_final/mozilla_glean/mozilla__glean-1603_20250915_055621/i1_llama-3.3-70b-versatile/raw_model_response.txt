<Filename> glean-core/rlb/src/private/event.rs </Filename>
<imports> 
use glean_core::traits::{Event, ExtraKeys};
use std::collections::HashMap;
use glean_core::traits::NoExtraKeys;
</imports>
<Rust>
#[test]
fn test_event_extra_keys() {
  #[derive(Default, Debug, Clone, Hash, Eq, PartialEq)]
  struct SomeExtra {
    key1: Option<String>,
    key2: Option<String>,
  }

  impl ExtraKeys for SomeExtra {
    const ALLOWED_KEYS: &'static [&'static str] = &["key1", "key2"];
    fn into_ffi_extra(self) -> HashMap<i32, String> {
      let mut map = HashMap::new();
      self.key1.and_then(|key1| map.insert(0, key1));
      self.key2.and_then(|key2| map.insert(1, key2));
      map
    }
  }

  struct EventMetric<K> {
    inner: K,
  }

  impl<K: ExtraKeys> Event for EventMetric<K> {
    type Extra = K;
    fn record<M: Into<Option<K>>>(&self, extra: M) {
      let extra = extra.into().map(|e| e.into_ffi_extra());
      assert_eq!(extra.unwrap().len(), 2);
    }
  }

  let metric = EventMetric { inner: () };
  let extra = SomeExtra {
    key1: Some("1".into()),
    key2: Some("2".into()),
  };
  metric.record(extra);
}
</Rust>