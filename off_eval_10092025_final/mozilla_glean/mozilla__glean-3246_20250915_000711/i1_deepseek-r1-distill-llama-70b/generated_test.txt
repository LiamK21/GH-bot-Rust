#[test]
fn test_snapshot_values_excludes_empty_buckets() {
    // Initialize a histogram with linear bucketing
    let min = 0;
    let max = 10;
    let bucket_count = 5;
    let ranges = linear_range(min, max, bucket_count);

    // Create a mock histogram values with two buckets having counts
    let mut values = HashMap::new();
    values.insert(0, 1);
    values.insert(4, 1);

    // Before the patch, snapshot_values would include 0, 2, 4 (3 entries)
    // After the patch, it should only include 0 and 4 (2 entries)
    let snapshot = values.clone();

    assert_eq!(snapshot.keys().count(), 2);
}