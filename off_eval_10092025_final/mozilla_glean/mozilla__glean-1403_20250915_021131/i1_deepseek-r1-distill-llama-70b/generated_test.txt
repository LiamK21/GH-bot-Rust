#[test]
fn test_first_run_hour_persistence_when_toggling_upload_enabled() {
    let (mut glean, _) = new_glean(None);

    // Initialize the first_run_hour by enabling upload once
    glean.set_upload_enabled(true);

    // Store the initial first_run_hour value
    let initial_first_run_hour = glean.core_metrics.first_run_hour.get_value(&glean, "metrics");

    // Disable upload and assert the value remains the same
    glean.set_upload_enabled(false);
    assert_eq!(
        initial_first_run_hour,
        glean.core_metrics.first_run_hour.get_value(&glean, "metrics")
    );

    // Re-enable upload and assert the value is still preserved
    glean.set_upload_enabled(true);
    assert_eq!(
        initial_first_run_hour,
        glean.core_metrics.first_run_hour.get_value(&glean, "metrics")
    );
}