#[test]
fn test_snapshot_metric_correct_lifetime() {
    let storage = Database::new_in_memory();
    let metric_id = "test_metric";
    let store_name = "test_store";
    let lifetime = Lifetime::Application;

    // Setup: Store a test metric in the application store
    storage.iter_store_from(lifetime, store_name, None, &mut |mut store| {
        store.put(metric_id, Metric::Boolean(true));
    });

    // Test snapshot_metric with the correct lifetime
    let result = StorageManager::snapshot_metric(
        storage,
        store_name,
        metric_id,
        lifetime,
    );

    // Assert that the metric is correctly retrieved from the specified lifetime
    match result {
        Some(Metric::Boolean(b)) => assert!(b),
        _ => panic!("Failed to retrieve metric"),
    };
}