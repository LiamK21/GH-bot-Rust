#[test]
fn test_glean_initialize_triggers_callbacks() {
    struct TestCallbacks {
        initialize_finished_called: std::sync::Mutex<bool>,
        trigger_upload_called: std::sync::Mutex<bool>,
        start_metric_ping_scheduler_called: std::sync::Mutex<bool>,
    }

    impl OnGleanEvents for TestCallbacks {
        fn on_initialize_finished(&self) {
            let mut called = self.initialize_finished_called.lock().unwrap();
            *called = true;
        }

        fn trigger_upload(&self) {
            let mut called = self.trigger_upload_called.lock().unwrap();
            *called = true;
        }

        fn start_metric_ping_scheduler(&self) {
            let mut called = self.start_metric_ping_scheduler_called.lock().unwrap();
            *called = true;
        }
    }

    let callbacks = Box::new(TestCallbacks {
        initialize_finished_called: std::sync::Mutex::new(false),
        trigger_upload_called: std::sync::Mutex::new(false),
        start_metric_ping_scheduler_called: std::sync::Mutex::new(false),
    });

    let client_info = ClientInfoMetrics::unknown();
    let cfg = InternalConfiguration {
        upload_enabled: true,
        // other necessary fields
    };

    glean_initialize(cfg, client_info, callbacks.clone());

    assert!(*callbacks.initialize_finished_called.lock().unwrap());
    assert!(*callbacks.trigger_upload_called.lock().unwrap());
    assert!(*callbacks.start_metric_ping_scheduler_called.lock().unwrap());
}