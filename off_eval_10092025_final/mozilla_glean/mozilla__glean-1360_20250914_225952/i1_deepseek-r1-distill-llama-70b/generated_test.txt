#[test]
fn test_thread_names() -> Result<(), Box<dyn Error>> {
    // Create dummy configuration and client info
    let cfg = Configuration {
        upload_enabled: false,
        data_path: "".to_string(),
        application_id: "".to_string(),
        language_binding_name: "".to_string(),
        max_events: 0,
        delay_ping_lifetime_io: 0,
        server_endpoint: Some("".to_string()),
        uploader: None,
        channel: None,
    };
    let client_info = ClientInfoMetrics {
        // Populate with dummy metrics if necessary
        ..Default::default()
    };

    initialize(cfg, client_info);

    // Wait for threads to spawn
    std::thread::sleep(std::time::Duration::from_millis(100));

    let mut expected_names = vec![
        "glean.dispatcher".to_string(),
        "glean.init".to_string(),
        "glean.upload".to_string(),
    ];

    let mut found_names = Vec::new();

    for entry in read_dir("/proc/self/task")? {
        let entry = entry?;
        let path = entry.path();
        if path.is_dir() {
            let comm_path = path.join("comm");
            let mut file = File::open(&comm_path)?;
            let mut buf = String::new();
            file.read_to_string(&mut buf)?;
            let name = buf.trim().to_string();
            if expected_names.contains(&name) {
                found_names.push(name);
            }
        }
    }

    assert!(found_names.contains(&"glean.dispatcher"));
    assert!(found_names.contains(&"glean.init"));
    assert!(found_names.contains(&"glean.upload"));

    Ok(())
}