<Filename>glean-core/src/database/mod.rs</Filename>
<imports>
use super::Database;
use super::Metric;
use super::Lifetime;
use tempfile::tempdir;
</imports>
<Rust>
#[test]
fn test_persist_ping_lifetime_data() {
    // Init the database in a temporary directory.
    let dir = tempdir().unwrap();
    let str_dir = dir.path().display().to_string();
    let db = Database::new(&str_dir, true).unwrap();
    let test_storage = "test-storage";
    let test_value = "test-value";
    let test_metric_id = "telemetry_test.test_name";

    // Record a known value.
    db.record_per_lifetime(
        Lifetime::Ping,
        test_storage,
        test_metric_id,
        &Metric::String(test_value.to_string()),
    )
    .unwrap();

    // Persist data.
    db.persist_ping_lifetime_data().unwrap();

    // Verify that the data is persisted in rkv.
    let store = db
        .rkv
        .open_single(Lifetime::Ping.as_str(), rkv::StoreOptions::create())
        .unwrap();
    let reader = db.rkv.read().unwrap();
    assert!(store
        .get(&reader, format!("{}#{}", test_storage, test_metric_id))
        .unwrap_or(None)
        .is_some());
}
</Rust>