<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use super::directory::PingDirectoryManager;
use super::request::PingRequest;
use uuid::Uuid;
use std::sync::Arc;
use std::sync::RwLock;
use std::thread;
use std::collections::VecDeque;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_process_ping_upload_response_reenqueue_on_server_error() {
  let directory_manager = PingDirectoryManager::new("/tmp");
  let uuid = Uuid::new_v4().to_string();
  let request = PingRequest::new(&uuid, "https://example.com", serde_json::json!({}));
  let mut queue: Arc<RwLock<VecDeque<PingRequest>>> = Arc::new(RwLock::new(VecDeque::new()));
  queue.write().unwrap().push_back(request);
  let upload_manager = PingUploadManager { queue, directory_manager, processed_pending_pings: Arc::new(std::sync::atomic::AtomicBool::new(false)) };
  upload_manager.process_ping_upload_response(&uuid, 500);
  let result = upload_manager.get_upload_task();
  match result {
    PingUploadTask::Upload(request) => assert_eq!(request.uuid, uuid),
    _ => assert!(false),
  }
}
</Rust>