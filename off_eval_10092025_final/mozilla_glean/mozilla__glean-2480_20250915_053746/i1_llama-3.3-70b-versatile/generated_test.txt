#[test]
fn test_merge_metrics_enabled_config() {
  let (glean, _t) = new_glean(None);
  let metric = StringMetric::new(CommonMetricData {
      category: "category".to_string(),
      name: "string_metric".to_string(),
      send_in_pings: vec!["baseline".to_string()],
      ..Default::default()
  });
  let another_metric = StringMetric::new(CommonMetricData {
      category: "category".to_string(),
      name: "labeled_string_metric".to_string(),
      send_in_pings: vec!["baseline".to_string()],
      ..Default::default()
  });

  let metrics_enabled_config = json!(
      {
          "category.string_metric": true,
      }
  ).to_string();
  glean.set_metrics_enabled_config(
      MetricsEnabledConfig::try_from(metrics_enabled_config).unwrap(),
  );

  let metrics_enabled_config = json!(
      {
          "category.labeled_string_metric": true,
      }
  ).to_string();
  glean.set_metrics_enabled_config(
      MetricsEnabledConfig::try_from(metrics_enabled_config).unwrap(),
  );

  metric.set_sync(&glean, "VALUE");
  another_metric.get("label1").set_sync(&glean, "VALUE");
  assert_eq!(
      "VALUE",
      metric.get_value(&glean, "baseline").unwrap(),
  );
  assert_eq!(
      "VALUE",
      another_metric.get("label1").get_value(&glean, "baseline").unwrap(),
  );
}