#[test]
fn test_merge_relative_paths() {
    let f = File::open("./test/relative_path/relative_path.info").expect("Failed to open lcov file");
    let file = BufReader::new(&f);
    let results = parse_lcov(file, false).unwrap();
    let result_map: Arc<Mutex<HashMap<String, CovResult>>> = Arc::new(Mutex::new(HashMap::new()));

    add_results(results, &result_map, &Some(PathBuf::from("./test/relative_path")));

    let result_map = result_map.into_inner().unwrap();
    assert_eq!(result_map.len(), 1);

    let expected_path = fs::canonicalize(PathBuf::from("./test/relative_path/foo/bar/oof.cpp")).unwrap().to_str().unwrap();
    let cov_result = result_map.get(expected_path).unwrap();

    assert_eq!(cov_result.lines, [(1,63), (2,63), (3,84), (4,42)].iter().cloned().collect());
    assert!(cov_result.functions.contains_key("myfun"));
}