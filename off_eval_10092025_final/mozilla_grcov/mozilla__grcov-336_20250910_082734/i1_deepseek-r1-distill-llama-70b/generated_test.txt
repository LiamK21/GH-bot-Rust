#[test]
fn test_parallel_flag() {
    let temp_dir = TempDir::new("grcov_test").unwrap();
    let test_path = Path::new(env!("CARGO_MANIFEST_DIR")).join("tests/fixtures/parallel_test.rs");

    // Test with --parallel flag
    let output_parallel = File::create(temp_dir.path().join("parallel.json")).unwrap();
    let args = &[
        "grcov", 
        "--format", "coveralls+", 
        "--parallel", 
        "--output", &format!("{}", output_parallel.display()),
        &format!("{}", test_path.display())
    ];
    std::process::Command::new(args[0])
        .args(&args[1..])
        .output()
        .unwrap();

    let parallel_output = std::fs::read_to_string(output_parallel).unwrap();
    let parallel_json: Value = serde_json::from_str(&parallel_output).unwrap();
    assert!(parallel_json["parallel"].as_bool().unwrap());

    // Test without --parallel flag
    let output_non_parallel = File::create(temp_dir.path().join("non_parallel.json")).unwrap();
    let args = &[
        "grcov", 
        "--format", "coveralls+", 
        "--output", &format!("{}", output_non_parallel.display()),
        &format!("{}", test_path.display())
    ];
    std::process::Command::new(args[0])
        .args(&args[1..])
        .output()
        .unwrap();

    let non_parallel_output = std::fs::read_to_string(output_non_parallel).unwrap();
    let non_parallel_json: Value = serde_json::from_str(&non_parallel_output).unwrap();
    assert!(!non_parallel_json["parallel"].as_bool().unwrap());
}