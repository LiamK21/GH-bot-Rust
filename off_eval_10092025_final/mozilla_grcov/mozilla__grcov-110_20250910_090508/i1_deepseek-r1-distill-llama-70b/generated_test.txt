#[test]
fn test_llvm_gcno_buffers() {
    let queue: Arc<MsQueue<Option<WorkItem>>> = Arc::new(MsQueue::new());
    let tmp_dir = TempDir::new("grcov").expect("Failed to create temporary directory");
    let tmp_path = tmp_dir.path().to_owned();

    // Simulate ZIP files containing LLVM coverage data
    let zip_files = vec![
        "test/llvm/gcno.zip".to_string(),
        "test/llvm/gcda1.zip".to_string(),
        "test/llvm/gcda2.zip".to_string(),
    ];

    producer(&tmp_path, &zip_files, &queue, true, true);

    // Verify that the producer correctly adds GcnoBuffers items to the queue
    let mut received = 0;
    while let Some(work_item) = queue.try_pop() {
        if let Some(item) = work_item {
            match item.item {
                ItemType::Buffers(_) => {
                    received += 1;
                }
                _ => panic!("Expected ItemType::Buffers"),
            }
        } else {
            break;
        }
    }

    assert_eq!(received, 2, "Expected 2 GcnoBuffers items");
}