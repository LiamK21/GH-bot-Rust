#[test]
fn test_globset_ignores_unsorted_dirs() {
    let mut result_map = HashMap::new();
    let path_mapping = None;
    let source_dir = None;
    let prefix_dir = None;
    let ignore_not_existing = false;
    let mut to_ignore_dirs = vec!["b/*".to_string(), "a/*".to_string()];
    let filter_option = None;

    let _ = rewrite_paths(
        result_map,
        path_mapping,
        source_dir,
        prefix_dir,
        ignore_not_existing,
        to_ignore_dirs,
        filter_option,
    );

    let mut glob_builder = GlobSetBuilder::new();
    for dir in &["a/*", "b/*"] {
        glob_builder.add(Glob::new(dir).unwrap());
    }
    let expected_globs = glob_builder.build().unwrap();

    // After the patch, the order of adding globs shouldn't matter
    let actual_globs = rewrite_paths(
        result_map,
        path_mapping,
        source_dir,
        prefix_dir,
        ignore_not_existing,
        vec!["b/*".to_string(), "a/*".to_string()],
        filter_option,
    )
    .0
    .globs
    .build()
    .unwrap();

    assert_eq!(expected_globs, actual_globs);
}