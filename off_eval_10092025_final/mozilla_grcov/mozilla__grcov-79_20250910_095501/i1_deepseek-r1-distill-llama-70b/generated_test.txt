#[test]
fn test_lcov_output_includes_branch_coverage() {
    let mut result = CovResult {
        functions: Default::default(),
        branches: Default::default(),
        lines: Default::default(),
    };

    // Add a sample branch
    result.branches.insert(
        (0, 5),
        true, // taken
    );

    let mut output = Vec::new();
    output_lcov(&mut result.iter());

    let output_str = String::from_utf8(output).unwrap();

    // Verify BRDA line
    assert!(output_str.contains("BRDA:0,0,5,1\n"));
    // Verify BRF line
    assert!(output_str.contains("BRF:1\n"));
    // Verify BRH line
    assert!(output_str.contains("BRH:1\n"));
}