#[test]
fn test_dir_producer_ignore_orphan_gcno() {
    let queue = Arc::new(test::MsQueue::new());
    let tmp_dir = TempDir::new("grcov").expect("Failed to create temporary directory");
    let test_dir = tmp_dir.path().join("test_dir");

    // Create test files
    std::fs::create_dir_all(&test_dir).unwrap();
    std::fs::File::create(&test_dir.join("file.gcno")).unwrap();
    std::fs::File::create(&test_dir.join("file.gcda")).unwrap();
    std::fs::File::create(&test_dir.join("orphan.gcno")).unwrap();

    let directories = vec![&test_dir.to_str().unwrap().to_string()];

    // Test with ignore_orphan_gcno = true
    dir_producer(&directories, &queue, true);

    // Check that only the gcno with gcda is processed
    let expected = vec![
        (ItemFormat::GCNO, true, "file.gcno", true),
    ];

    test::check_produced(tmp_dir.path(), &queue, expected);
}