<Filename> src/output.rs </Filename>
<imports> 
use super::output_markdown;
use std::io::Read;
use tempfile::tempdir;
use std::fs::File;
use std::io::BufReader;
use std::path::PathBuf;
use std::path::Path;
</imports>
<Rust>
#[test]
fn test_markdown_output() {
  let tmp_dir = tempdir().expect("Failed to create temporary directory");
  let file_name = "test_markdown";
  let file_path = tmp_dir.path().join(&file_name);

  let results = vec![
    (
      PathBuf::from("foo/bar/a.cpp"),
      PathBuf::from("foo/bar/a.cpp"),
      super::CovResult {
        lines: [(1, 10), (2, 11)].iter().cloned().collect(),
        branches: std::collections::BTreeMap::new(),
        functions: std::collections::HashMap::new(),
      },
    ),
    (
      PathBuf::from("foo/bar/b.cpp"),
      PathBuf::from("foo/bar/b.cpp"),
      super::CovResult {
        lines: [(1, 0), (2, 10), (4, 10), (5, 0), (7, 0)]
          .iter()
          .cloned()
          .collect(),
        branches: std::collections::BTreeMap::new(),
        functions: std::collections::HashMap::new(),
      },
    ),
  ];

  let results = Box::new(results.into_iter());
  output_markdown(results, Some(&file_path));

  let file = File::open(file_path).unwrap();
  let mut buf_reader = BufReader::new(file);
  let mut actual = String::new();
  buf_reader.read_to_string(&mut actual).unwrap();

  let expected = "| file          | coverage | covered | missed_lines |
|---------------|----------|---------|--------------|
| foo/bar/a.cpp | 100%     | 2 / 2   |              |
| foo/bar/b.cpp | 40%      | 2 / 5   | 1, 5-7       |
Total coverage: 57%";
  assert_eq!(actual, expected);
}
</Rust>