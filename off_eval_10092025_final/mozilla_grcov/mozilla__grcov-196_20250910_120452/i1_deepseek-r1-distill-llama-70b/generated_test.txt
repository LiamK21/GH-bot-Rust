#[test]
fn test_rewrite_partial_paths_to_full_paths() {
    let temp_dir = TempDir::new("grcov_test").unwrap();
    let source_dir = temp_dir.path().join("src");

    // Create directory structure:
    // src/a/b/file.txt and src/a/b/file.txt
    create_dir_all(&source_dir.join("a/b")).unwrap();
    File::create(&source_dir.join("a/b/file.txt")).unwrap();
    create_dir_all(&source_dir.join("a/b")).unwrap();
    File::create(&source_dir.join("a/b/file.txt")).unwrap();

    let mut result_map = HashMap::new();
    result_map.insert("b/file.txt".to_string(), ());

    let results = rewrite_paths(
        result_map,
        None,
        Some(source_dir),
        None,
        true,
        Vec::new(),
        None,
    );

    let mut count = 0;
    for (abs_path, rel_path, _) in results {
        count += 1;
        assert!(abs_path.is_absolute());
        assert_eq!(rel_path, source_dir.join("a/b/file.txt").strip_prefix(&source_dir).unwrap());
    }
    assert_eq!(count, 1);
}