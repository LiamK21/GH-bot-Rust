#[test]
fn test_activedata_output_format() {
    let stdout = stdout();
    let handle = stdout.lock();
    let mut writer = BufWriter::new(handle);

    // Simulate some coverage data
    let covered: Vec<u32> = vec![1, 2, 3];
    let uncovered: Vec<u32> = vec![4, 5];

    // Define a dummy CovResultIter implementation
    struct DummyCovResultIter;
    impl Iterator for DummyCovResultIter {
        type Item = (String, Vec<u32>, Vec<u32>);
        fn next(&mut self) -> Option<Self::Item> {
            Some((String::from("test_file"), covered.clone(), uncovered.clone()))
        }
        fn size_hint(&self) -> (usize, Option<usize>) {
            (1, Some(1))
        }
    }
    let results = DummyCovResultIter;

    // Call the function under test
    output_activedata_etl(results);

    // Capture the output and parse it
    let output = writer.get_ref().get_mut().as_mut().unwrap().get_mut().as_mut().unwrap();
    let mut actual = String::new();
    output.read_to_string(&mut actual).unwrap();
    let actual_json: Value = serde_json::from_str(&actual).unwrap();

    // Verify the structure
    let file = actual_json.as_object().unwrap()["file"].as_object().unwrap();
    assert!(file.contains_key("covered"));
    assert!(file.contains_key("uncovered"));

    let covered_array = file["covered"].as_array().unwrap();
    for item in covered_array {
        assert!(item.as_u32().is_some());
    }
}