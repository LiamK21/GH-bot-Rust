#[test]
fn test_clear_pending_pings_handles_readonly_dir() {
    let dir = tempdir().unwrap();
    let pings_dir = dir.path().join("pings");
    fs::create_dir_all(&pings_dir).unwrap();
    let readonly_dir = pings_dir.join("readonly");
    fs::create_dir(&readonly_dir).unwrap();

    #[cfg(target_os = "windows")]
    {
        let metadata = fs::metadata(&readonly_dir).unwrap();
        let mut permissions = metadata.permissions();
        permissions.set_readonly(true);
        fs::set_permissions(&readonly_dir, permissions).unwrap();
    }

    let ping_maker = PingMaker::default();

    let result = ping_maker.clear_pending_pings(dir.path());

    assert!(result.is_ok());
}