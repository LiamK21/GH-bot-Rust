#[test]
fn test_clear_pending_pings_handles_readonly_dir() {
    let dir = tempdir().unwrap();
    let pings_dir = dir.path().join("pings");
    fs::create_dir_all(&pings_dir).unwrap();
    let test_file = pings_dir.join("readonly.txt");
    fs::File::create(&test_file).unwrap();

    #[cfg(target_os = "windows")]
    {
        let metadata = fs::metadata(&test_file).unwrap();
        let mut permissions = metadata.permissions();
        permissions.set_readonly(true);
        fs::set_permissions(&test_file, permissions).unwrap();
    }

    let ping_maker = PingMaker {
        data_dir_prefix: "".to_string(),
        ..Default::default()
    };

    let result = ping_maker.clear_pending_pings(dir.path());

    assert!(result.is_ok());
}