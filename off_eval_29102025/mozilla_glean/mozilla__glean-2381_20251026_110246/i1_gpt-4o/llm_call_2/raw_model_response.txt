<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use crate::internal_metrics::UploadMetrics;
use crate::Glean;
use crate::metrics::CounterMetric;
use std::sync::Arc;
use super::PingUploadManager;
use crate::core::InternalConfiguration;
use std::collections::HashSet;
</imports>
<Rust>
#[test]
fn test_in_flight_pings_dropped_metric() {
    let glean = Arc::new(Glean::new(InternalConfiguration::default()).unwrap());
    let upload_metrics = UploadMetrics::new();
    let mut manager = PingUploadManager {
        upload_metrics,
        queue: Vec::new(),
        directory_manager: None,
        processed_pending_pings: HashSet::new(),
        cached_pings: HashSet::new(),
        recoverable_failure_count: 0,
        in_flight: HashSet::new(),
        last_upload_attempt: None,
        last_upload_success: None,
        last_upload_failure: None,
    };

    let document_id = "test_doc_id".to_string();
    let path = "test_path".to_string();

    manager.in_flight.insert(document_id.clone());

    manager.handle_ping_upload(glean.clone(), document_id, path);

    let expected = Some(1);
    let actual = manager.upload_metrics.in_flight_pings_dropped.test_get_value(Some("metrics".into()));
    assert_eq!(expected, actual);
}
</Rust>