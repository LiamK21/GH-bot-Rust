#[test]
fn test_pretty_body() {
    let tempdir = TempDir::new().unwrap();
    let upload_manager = PingUploadManager::new(tempdir.path());

    let json = r#"{"a":true,"b":0}"#;
    let value: JsonValue = serde_json::from_str(json).unwrap();
    upload_manager.enqueue_ping("test-doc", "test-path", value);

    while upload_manager.get_upload_task(false) == PingUploadTask::Wait {
        thread::sleep(Duration::from_millis(10));
    }

    let upload_task = upload_manager.get_upload_task(false);
    let request = match upload_task {
        PingUploadTask::Upload(req) => req,
        _ => panic!("Expected Upload task"),
    };

    let pretty = request.pretty_body().unwrap();
    let expected = r#"
{
  "a": true,
  "b": 0
}"#;
    assert_eq!(pretty, expected.trim());
}