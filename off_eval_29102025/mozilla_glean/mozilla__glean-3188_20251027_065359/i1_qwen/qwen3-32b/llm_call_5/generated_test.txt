#[test]
fn test_uploader_capabilities_instrumented() {
    let ping = Ping {
        name: "test_ping",
        url_path: "/test",
        content: json!({}),
        includes_client_id: true,
        includes_glean_pings: false,
        includes_info_sections: true,
        include_experiments: false,
        send_if_empty: false,
        uploader_capabilities: &["test_cap", "another_cap"],
    };

    let mut metrics_data = None;
    let mut events_data = None;

    PingMaker::new().build_ping_data(&ping, &mut metrics_data, &mut events_data);

    let metrics_obj = metrics_data.unwrap().as_object().unwrap();
    let string_list = metrics_obj
        .get("string_list")
        .unwrap()
        .as_object()
        .unwrap();
    let caps = string_list
        .get("glean.ping.uploader_capabilities")
        .unwrap()
        .as_array()
        .unwrap();

    assert_eq!(caps.len(), 2);
    assert!(caps.contains(&json!("test_cap")));
    assert!(caps.contains(&json!("another_cap")));
}