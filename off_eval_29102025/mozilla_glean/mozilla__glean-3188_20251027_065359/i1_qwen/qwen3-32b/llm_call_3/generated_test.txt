#[test]
fn test_uploader_capabilities_instrumented() {
    let ping = Ping {
        name: "test_ping".to_string(),
        url_path: "/test".to_string(),
        content: serde_json::Value::Object(HashMap::new()),
        includes_info_sections: true,
        schedules_pings: Vec::new(),
        send_if_empty: true,
        uploader_capabilities: vec!["test_cap".to_string(), "another_cap".to_string()],
        ..Default::default()
    };

    let mut metrics_data = None;
    let mut events_data = None;

    PingMaker::new().build_ping_data(&ping, &mut metrics_data, &mut events_data);

    let metrics_obj = metrics_data.unwrap().as_object().unwrap();
    let string_list = metrics_obj
        .get("string_list")
        .unwrap()
        .as_object()
        .unwrap();
    let caps = string_list
        .get("glean.ping.uploader_capabilities")
        .unwrap()
        .as_array()
        .unwrap();

    assert_eq!(caps.len(), 2);
    assert!(caps.contains(&json!("test_cap")));
    assert!(caps.contains(&json!("another_cap")));
}