<Filename>glean-core/rlb/src/test.rs</Filename>
<imports>
use super::shutdown;
use super::with_glean_mut;
use crate::block_on_dispatcher;
use crossbeam_channel::bounded;
use crossbeam_channel::TryRecvError;
use std::path::Path;
use std::fs;
use std::thread;
use super::dispatcher;
use crossbeam_channel::Sender;
use crossbeam_channel::Receiver;
</imports>
<Rust>
#[test]
fn test_shutdown_clears_dirty_bit() {
  let (s, _) = bounded::<String>(1);
  let data_dir = Path::new("/tmp/glean_test");
  fs::create_dir_all(data_dir).unwrap();
  dispatcher::launch(move || {
    with_glean_mut(|glean| {
      glean.set_dirty_flag(true);
    })
  });
  crate::block_on_dispatcher();
  shutdown();
  let is_dirty = {
    let mut is_dirty = false;
    dispatcher::launch(move || {
      with_glean_mut(|glean| {
        is_dirty = glean.get_dirty_flag();
      })
    });
    crate::block_on_dispatcher();
    is_dirty
  };
  assert_eq!(is_dirty, false);
}
</Rust>