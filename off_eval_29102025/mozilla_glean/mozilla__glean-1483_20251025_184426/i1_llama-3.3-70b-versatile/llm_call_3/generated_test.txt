#[test]
fn test_shutdown_clears_dirty_bit() {
  let (s, _) = bounded::<String>(1);
  let data_dir = Path::new("/tmp/glean_test");
  fs::create_dir_all(data_dir).unwrap();
  dispatcher::launch(move || {
    with_glean_mut(|glean| {
      glean.set_dirty_flag(true);
    })
  });
  crate::block_on_dispatcher();
  shutdown();
  dispatcher::launch(move || {
    with_glean_mut(|glean| {
      assert_eq!(glean.get_dirty_flag(), false);
    })
  });
  crate::block_on_dispatcher();
}