#[test]
fn test_memory_distribution_accumulates_values() {
    let tmpdir = tempdir().unwrap();
    let path = tmpdir.path().join("glean.sqlite");
    let glean = Arc::new(Glean::new(path, "test".into(), true, false).unwrap());
    let metric = MemoryDistributionMetric::new(
        CommonMetricData {
            category: "test".to_string(),
            name: "metric".to_string(),
            send_in_pings: vec!["default".to_string()],
            ..Default::default()
        },
        MemoryUnit::Byte,
    );

    metric.accumulate(42);

    let value = metric.test_get_value(None).unwrap();
    assert_eq!(value.sum, Some(42), "Sum should be 42");
    let values = value.values.unwrap();
    assert_eq!(values.get(&0), Some(&1), "0-128 bucket should have 1 sample");
}