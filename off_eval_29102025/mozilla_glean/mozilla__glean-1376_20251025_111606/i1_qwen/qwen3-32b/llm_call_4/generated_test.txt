#[test]
fn test_memory_distribution_accumulates_values() {
    let dir = tempdir().unwrap();
    with_glean(|glean| {
        let metric = MemoryDistributionMetric::new(
            CommonMetricData {
                category: "test".to_string(),
                name: "metric".to_string(),
                send_in_pings: vec!["default".to_string()],
                ..Default::default()
            },
            MemoryUnit::Byte,
        );

        metric.accumulate(42);

        let value = metric.test_get_value(None);
        assert!(value.is_some(), "Value should be recorded");
        let data = value.unwrap();
        assert_eq!(data.sum, Some(42), "Sum should be 42");
        let values = data.values.unwrap();
        assert_eq!(values.get(&0), Some(&1), "0-128 bucket should have 1 sample");
        dir.close().unwrap();
    });
}