<Filename>glean-core/ffi/src/upload.rs</Filename>
<imports>
use std::ffi::CString;
use std::os::raw::c_char;
use ffi_support::ByteBuffer;
use crate::glean_str_free;
use glean_core::upload::PingUploadTask;
use serde_json::json;
use serde_json::Value;
use serde_json::to_vec;
</imports>
<Rust>
#[test]
fn test_gzip_ping_upload() {
  let request = PingUploadTask::Upload(glean_core::upload::Request {
    document_id: "document_id".to_string(),
    path: "path".to_string(),
    body: json!(vec![1, 2, 3]), 
    headers: json!({"header": "value"}),
  });
  let ffi_task: FfiPingUploadTask = request.into();
  match ffi_task {
    FfiPingUploadTask::Upload { body, .. } => {
      let vec_body: Vec<u8> = to_vec(&request.body).unwrap();
      let byte_buffer = ByteBuffer::from_vec(vec_body);
      assert_eq!(body.len(), byte_buffer.len());
    },
    _ => assert!(false),
  }
}
</Rust>