#[test]
fn test_record_error() {
  let glean = Glean::new(Default::default()).unwrap();
  let metric = CounterMetric::new(glean.storage()).unwrap();
  let error = crate::ErrorType::InvalidValue;
  let count = 1;
  let recorded_error = AtomicBool::new(false);
  metric.record_error(error, count);
  std::thread::sleep(std::time::Duration::from_millis(100));
  let meta = metric.meta().clone();
  let expected_error = (meta, error, "external error", count);
  glean.launch_with_glean(move |g| {
    let errors = error_recording::get_recorded_errors(g);
    for error in errors {
      if error == expected_error {
        recorded_error.store(true, Ordering::SeqCst);
      }
    }
  });
  assert!(recorded_error.load(Ordering::SeqCst));
}