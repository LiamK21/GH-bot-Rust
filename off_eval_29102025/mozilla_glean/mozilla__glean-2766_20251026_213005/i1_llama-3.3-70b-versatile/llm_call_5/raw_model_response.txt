<Filename>glean-core/src/metrics/mod.rs</Filename>
<imports>
use super::error_recording;
use super::MetricType;
use crate::core::Glean;
use crate::metrics::counter::CounterMetric;
use std::sync::atomic::{AtomicBool, Ordering};
use crate::metrics::CommonMetricData;
use crate::metrics::Database;
use crate::ErrorType;
</imports>
<Rust>
#[test]
fn test_record_error() {
  let glean = Glean::new(InternalConfiguration::default()).unwrap();
  let meta = CommonMetricData::new("test", "test");
  let metric = CounterMetric::new(meta.clone()).unwrap();
  let error = ErrorType::InvalidValue;
  let count = 1;
  let recorded_error = AtomicBool::new(false);
  metric.record_error(error, count);
  std::thread::sleep(std::time::Duration::from_millis(100));
  let expected_error = (meta, error, "external error", count);
  glean.launch_with_glean(move |g| {
    let errors = error_recording::get_recorded_errors(g);
    for error in errors {
      if error == expected_error {
        recorded_error.store(true, Ordering::SeqCst);
      }
    }
  });
  assert!(recorded_error.load(Ordering::SeqCst));
}
</Rust>