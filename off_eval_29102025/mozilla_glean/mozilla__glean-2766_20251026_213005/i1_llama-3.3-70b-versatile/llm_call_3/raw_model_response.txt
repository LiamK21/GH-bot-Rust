<Filename>glean-core/src/metrics/mod.rs</Filename>
<imports>
use super::Glean;
use super::error_recording;
use super::MetricType;
use std::sync::atomic::{AtomicBool, Ordering};
use crate::core::InternalConfiguration;
use crate::metrics::counter::CounterMetric;
use crate::metrics::MetricType;
</imports>
<Rust>
#[test]
fn test_record_error() {
  let config = InternalConfiguration::default();
  let glean = Glean::new(config).unwrap();
  let metric = CounterMetric::new("test_counter", glean.storage()).unwrap();
  let error = crate::ErrorType::InvalidValue;
  let count = 1;
  let recorded_error = AtomicBool::new(false);
  metric.record_error(error, count);
  std::thread::sleep(std::time::Duration::from_millis(100));
  let meta = metric.meta().clone();
  let expected_error = (meta, error, "external error", count);
  glean.launch_with_glean(move |g| {
    let errors = error_recording::get_recorded_errors(g);
    for error in errors {
      if error == expected_error {
        recorded_error.store(true, Ordering::SeqCst);
      }
    }
  });
  assert!(recorded_error.load(Ordering::SeqCst));
}
</Rust>