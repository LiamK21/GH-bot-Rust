<Filename>glean-core/ffi/src/lib.rs</Filename>
<imports>
use super::glean_enable_logging;
use log::{Level, Metadata, Record};
use log::LevelFilter;
use std::sync::{Once, Arc};
</imports>
<Rust>
#[test]
fn test_logging_filter_for_glean_modules() {
    static INIT: Once = Once::new();
    INIT.call_once(|| {
        glean_enable_logging();
    });

    struct TestLogger;
    impl log::Log for TestLogger {
        fn enabled(&self, metadata: &Metadata) -> bool {
            metadata.level() <= Level::Debug
        }

        fn log(&self, record: &Record) {
            if self.enabled(record.metadata()) {
                assert!(record.target().starts_with("glean"));
            }
        }

        fn flush(&self) {}
    }

    let test_logger = Arc::new(TestLogger);
    log::set_logger(Box::leak(Box::new(test_logger.clone()))).unwrap();
    log::set_max_level(LevelFilter::Debug);

    log::debug!(target: "glean_core", "This should be logged");
    log::debug!(target: "neqo", "This should not be logged");
}
</Rust>