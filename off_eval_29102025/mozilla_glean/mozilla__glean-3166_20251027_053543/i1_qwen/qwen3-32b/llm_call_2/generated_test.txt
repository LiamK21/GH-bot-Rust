#[test]
fn test_keyed_categorical_counter_regression() {
    // Test valid usage
    let metric = glean_metrics::test_dual_labeled::dynamic_dynamic.get("valid_key", "valid_category");
    metric.add(1);
    assert_eq!(Some(1), metric.test_get_value(None));
    assert_eq!(0, metric.test_get_num_recorded_errors(ErrorType::InvalidLabel));

    // Test invalid key (but valid category)
    let invalid_metric = glean_metrics::test_dual_labeled::dynamic_dynamic.get("invalid_key", "valid_category");
    invalid_metric.add(1);

    // Confirm "__other__" accumulates invalid keys correctly
    let other_metric = glean_metrics::test_dual_labeled::dynamic_dynamic.get("__other__", "valid_category");
    assert_eq!(Some(1), other_metric.test_get_value(None));

    // Error should be recorded because first label is invalid
    assert_eq!(1, metric.test_get_num_recorded_errors(ErrorType::InvalidLabel));
}