#[test]
fn test_memory_distribution_no_database() {
    let glean = Glean::new(
        Database::new(Path::new("/tmp"), false).unwrap(),
        false,
        "test_app_id",
        "test_app_version",
        "test_channel",
        "test_os",
        "test_os_version",
        "test_device",
        "test_manufacturer",
        "test_architecture",
    );
    let metric = MemoryDistributionMetric::new(
        CommonMetricData {
            name: "name".into(),
            category: "category".into(),
            send_in_pings: vec!["ping".into()],
            disabled: false,
            lifetime: Default::default(),
            ..Default::default()
        },
        MemoryUnit::Byte,
    );

    glean.storage_opt().unwrap().clear_all();

    metric.accumulate(50);

    let recorded = glean.storage_opt().and_then(|storage| {
        storage.get_metric::<MemoryDistributionMetric>("category.name")
    });

    assert!(recorded.is_none());
}