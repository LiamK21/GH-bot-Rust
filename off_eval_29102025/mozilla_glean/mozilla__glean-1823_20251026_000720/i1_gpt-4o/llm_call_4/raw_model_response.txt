<Filename>glean-core/ffi/src/labeled.rs</Filename>
<imports>
use super::glean_labeled_counter_metric_get;
use ffi_support::FfiStr;
use std::collections::HashMap;
use std::sync::Mutex;
use once_cell::sync::Lazy;
use std::ffi::CString;
</imports>
<Rust>
#[test]
fn test_labeled_metric_handle_reuse() {
    static TEST_LABEL_MAP: Lazy<Mutex<HashMap<String, u64>>> = Lazy::new(|| Mutex::new(HashMap::new()));

    let handle = 1;
    let label_cstr = CString::new("test_label").unwrap();
    let label = FfiStr::from_cstr(&label_cstr);
    let id = format!("{}/{}", handle, label.as_str());

    let mut map = TEST_LABEL_MAP.lock().unwrap();
    map.insert(id.clone(), 42);

    let expected = 42;
    let actual = glean_labeled_counter_metric_get(handle, label);

    assert_eq!(expected, actual);
}
</Rust>