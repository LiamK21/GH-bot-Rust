#[test]
fn test_label_cache_prevents_multiple_insertions() {
    static GLOBAL_LABELED: OnceCell<LabeledMetric<CounterMetric>> = OnceCell::new();
    static GLOBAL_HANDLE: u64 = 1;

    // Assuming CounterMetric can be created with default values
    let counter_metric = CounterMetric::new();
    let labeled_metric = LabeledMetric::new(counter_metric, Some(vec!["test_label".to_string()]));

    GLOBAL_LABELED.set(labeled_metric).unwrap();

    let label = "test_label";
    let c_label = CString::new(label).unwrap();
    let ffi_label = FfiStr {
        ptr: c_label.as_ptr() as *const c_char,
        len: label.len(),
    };

    unsafe {
        let first = glean_labeled_counter_metric_get(GLOBAL_HANDLE, ffi_label);
        let second = glean_labeled_counter_metric_get(GLOBAL_HANDLE, ffi_label);
        assert_eq!(first, second);
    }
}