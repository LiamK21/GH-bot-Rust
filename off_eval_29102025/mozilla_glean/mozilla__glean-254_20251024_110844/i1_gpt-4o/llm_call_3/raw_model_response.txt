<Filename>glean-core/src/storage/mod.rs</Filename>
<imports>
use crate::Glean;
use crate::metrics::experiment::ExperimentMetric;
use crate::storage::StorageManager;
use std::collections::HashMap;
</imports>
<Rust>
#[test]
fn test_experiment_metric_error_reporting() {
    let glean = Glean::new(Default::default()).unwrap();
    let extra: HashMap<String, String> = [("key".repeat(31), "value".repeat(31))]
        .iter()
        .cloned()
        .collect();

    let metric = ExperimentMetric::new(&glean, "some-experiment".repeat(31));

    metric.set_active(&glean, "test-branch".repeat(31), Some(extra));
    let snapshot = StorageManager.snapshot_as_json(&glean.storage(), "experiments", false);

    let snapshot_str = snapshot.unwrap().to_string();
    assert!(snapshot_str.contains("Value length 372 for experiment id exceeds maximum of 30"));
    assert!(snapshot_str.contains("Value length 341 for branch exceeds maximum of 30"));
    assert!(snapshot_str.contains("Extra key length 93 exceeds maximum of 30"));
    assert!(snapshot_str.contains("Extra value length 155 exceeds maximum of 100"));
}
</Rust>