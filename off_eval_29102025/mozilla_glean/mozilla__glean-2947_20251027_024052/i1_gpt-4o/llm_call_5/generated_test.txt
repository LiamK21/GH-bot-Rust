#[test]
fn test_builder_generates_correct_rust_code() {
    let temp_dir = tempfile::tempdir().expect("Failed to create temp dir");
    let yaml_content = r#"
autotrack.fafo:
  event:
    type: "event"
    description: >
      Look, they did a thing!
    metadata:
      tags:
        - "test"
    expires: "never"
    bugs:
      - "https://example.com/bugs/"
    data_reviews:
      - "https://example.com/reviews/"
    notification_emails:
      - "alert+ignore@example.com"
"#;
    let yaml_path = temp_dir.path().join("metrics.yaml");
    fs::write(&yaml_path, yaml_content).expect("Failed to write YAML file");

    let output = Command::new("glean_parser")
        .arg("translate")
        .arg("--input")
        .arg(yaml_path.to_str().unwrap())
        .arg("--output")
        .arg(temp_dir.path().to_str().unwrap())
        .arg("--language")
        .arg("rust")
        .output()
        .expect("Failed to execute command");

    assert!(output.status.success(), "Command did not execute successfully");

    let rust_file_path = temp_dir.path().join("autotrack.fafo.rs");
    let rust_code = fs::read_to_string(&rust_file_path).expect("Failed to read Rust file");

    let expected_substring = "NoExtraKeys";
    assert!(
        rust_code.contains(expected_substring),
        "Generated Rust code does not contain expected substring"
    );
}