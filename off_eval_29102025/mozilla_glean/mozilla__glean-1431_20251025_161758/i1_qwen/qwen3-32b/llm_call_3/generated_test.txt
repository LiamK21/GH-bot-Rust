#[test]
fn test_get_value_lock_order_regression() {
    with_glean(|glean| {
        let meta = CommonMetricData {
            name: "test".into(),
            category: "category".into(),
            send_in_pings: vec!["ping".into()],
            ..Default::default()
        };
        let metric = TimingDistributionMetric::new(meta, TimeUnit::Millisecond);
        metric.record(glean, 100);
        block_on_dispatcher();
        let value = metric.test_get_value(Some("ping"));
        assert!(value.is_some());
        let data = value.unwrap();
        assert_eq!(data.values.len(), 1);
        assert!(data.values.values().all(|&count| count == 1));
        assert_eq!(data.sum, 100);
    });
}