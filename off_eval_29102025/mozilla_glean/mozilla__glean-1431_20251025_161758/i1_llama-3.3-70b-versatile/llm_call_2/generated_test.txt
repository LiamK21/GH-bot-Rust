#[test]
fn test_lock_order_inversion() {
  let metric = Arc::new(RwLock::new(TimingDistributionMetric::new()));
  let metric_clone = Arc::clone(&metric);
  let handle = thread::spawn(move || {
    let _ = metric_clone.read().unwrap();
    crate::block_on_dispatcher();
  });
  let _ = metric.read().unwrap();
  let result = std::panic::catch_unwind(|| {
    crate::with_glean(|glean| {
      let _ = metric.read().unwrap();
    });
  });
  handle.join().unwrap();
  assert!(result.is_err());
}