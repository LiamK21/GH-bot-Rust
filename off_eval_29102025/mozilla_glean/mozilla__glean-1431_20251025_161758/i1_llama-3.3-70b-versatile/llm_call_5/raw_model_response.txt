<Filename>glean-core/rlb/src/private/timing_distribution.rs</Filename>
<imports>
use std::sync::Arc;
use std::sync::RwLock;
use std::thread;
use super::TimingDistributionMetric;
use super::with_glean;
use std::panic::catch_unwind;
use std::sync::RwLockReadGuard;
</imports>
<Rust>
#[test]
fn test_lock_order_inversion() {
  let metric = Arc::new(RwLock::new(TimingDistributionMetric::new()));
  let metric_clone: Arc<RwLock<TimingDistributionMetric>> = Arc::clone(&metric);
  let handle = thread::spawn(move || {
    let _ = metric_clone.read().unwrap();
    with_glean(|_| ());
  });
  let _ = metric.read().unwrap();
  let result = catch_unwind(|| {
    let inner = metric.read().unwrap();
    with_glean(|_| {
      let _ = metric.read().unwrap();
    });
  });
  handle.join().unwrap();
  assert!(result.is_err());
}
</Rust>