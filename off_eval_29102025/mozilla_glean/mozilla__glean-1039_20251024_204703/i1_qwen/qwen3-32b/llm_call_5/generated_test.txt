#[test]
fn test_subprocess_upload_handling() {
    let c_data_dir = CString::new("/tmp/glean-test").unwrap();
    let c_package_name = CString::new("test-app").unwrap();
    let c_language_binding = CString::new("python").unwrap();

    let config = FfiConfiguration {
        data_dir: unsafe { FfiStr::from_cstr(c_data_dir.as_c_str()) },
        package_name: unsafe { FfiStr::from_cstr(c_package_name.as_c_str()) },
        language_binding_name: unsafe { FfiStr::from_cstr(c_language_binding.as_c_str()) },
        upload_enabled: 1,
        max_events: Some(&100),
        delay_ping_lifetime_io: 0,
    };

    unsafe {
        let init_result = glean_initialize_for_subprocess(&config);
        assert_eq!(init_result, 1);

        let mut task: *mut FfiPingUploadTask = ptr::null_mut();
        glean_get_upload_task(&mut task, 1);

        if !task.is_null() {
            glean_process_ping_upload_response(task, 200);
        }
    }
}