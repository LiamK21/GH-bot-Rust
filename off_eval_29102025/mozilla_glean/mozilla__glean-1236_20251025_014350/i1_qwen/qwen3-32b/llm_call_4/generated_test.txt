#[test]
fn test_pending_pings_directory_size_in_kilobytes() {
    let (glean, _) = glean::private::with_glean("test").unwrap();

    let mut upload_manager = PingUploadManager::no_policy(&_.path());
    let metric = &upload_manager.upload_metrics.pending_pings_directory_size;

    // Simulate a 2048-byte pings directory size before the patch would record 2048,
    // but the patch divides by 1024, so it should record 2
    metric.accumulate(&glean, 2048);

    let value = glean::Testing::with(|glean| {
        glean.get_value("upload.metrics.pending_pings_directory_size", &[])
    }).unwrap();

    assert_eq!(value, Value::Distribution(Distribution { sum: 2048, min: None, max: None, count: 1, ... } into ()));
}