#[test]
fn test_pending_pings_directory_size_in_kilobytes() {
    let (glean, temp_dir) = crate::glean::private::with_glean("test").unwrap();

    let mut upload_manager = PingUploadManager::no_policy(&temp_dir.path());
    let metric = upload_manager.upload_metrics.pending_pings_directory_size;

    // Simulate 2048 bytes (2 KiB). After the patch, this should be recorded as 2 KiB.
    metric.accumulate(&glean, 2048);

    let value = Testing::with(|glean| {
        glean.get_value("upload.metrics.pending_pings_directory_size", &[])
    }).unwrap();

    let expected = Value::Distribution(Distribution {
        sum: 2,
        min: Some(2),
        max: Some(2),
        count: 1,
        ..Distribution::default()
    });
    assert_eq!(value, expected);
}