#[test]
fn test_upload_custom_deletion_request_ping() {
    let (glean, dir) = new_glean(None);
    let ping_type = PingType::new("deletion-request", None, true, vec!["https://example.com"]);
    glean.register_ping_type(&ping_type).unwrap();
    glean.submit_ping(&ping_type, None).unwrap();
    let upload_manager = PingUploadManager::new(&dir.path().to_str().unwrap());
    let mut upload_task = upload_manager.get_upload_task().unwrap();
    assert!(upload_task.is_some(), "No upload task created despite deletion request ping");
    assert!(upload_task
        .as_ref()
        .unwrap()
        .0
        .url
        .split('/')
        .nth(3)
        .map(|s| s == "deletion-request")
        .unwrap_or(false),
        "Ping processed is not a deletion request",
    );
}