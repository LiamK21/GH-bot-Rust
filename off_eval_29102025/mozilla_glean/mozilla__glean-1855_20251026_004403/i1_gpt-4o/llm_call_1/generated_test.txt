#[test]
fn test_glean_initialize_triggers_callbacks() {
    struct TestCallbacks {
        initialize_finished: Arc<Mutex<bool>>,
        upload_triggered: Arc<Mutex<bool>>,
        scheduler_started: Arc<Mutex<bool>>,
    }

    impl OnGleanEvents for TestCallbacks {
        fn on_initialize_finished(&self) {
            let mut finished = self.initialize_finished.lock().unwrap();
            *finished = true;
        }

        fn trigger_upload(&self) {
            let mut upload = self.upload_triggered.lock().unwrap();
            *upload = true;
        }

        fn start_metric_ping_scheduler(&self) {
            let mut scheduler = self.scheduler_started.lock().unwrap();
            *scheduler = true;
        }
    }

    let initialize_finished = Arc::new(Mutex::new(false));
    let upload_triggered = Arc::new(Mutex::new(false));
    let scheduler_started = Arc::new(Mutex::new(false));

    let callbacks = TestCallbacks {
        initialize_finished: Arc::clone(&initialize_finished),
        upload_triggered: Arc::clone(&upload_triggered),
        scheduler_started: Arc::clone(&scheduler_started),
    };

    let client_info = ClientInfoMetrics::unknown();
    let cfg = InternalConfiguration {
        upload_enabled: true,
        // other necessary fields
    };

    glean_initialize(cfg, client_info, Box::new(callbacks));

    assert_eq!(*initialize_finished.lock().unwrap(), true);
    assert_eq!(*upload_triggered.lock().unwrap(), true);
    assert_eq!(*scheduler_started.lock().unwrap(), true);
}