<Filename>glean-core/src/database/mod.rs</Filename>
<imports>
use std::collections::BTreeMap;
use rkv::{SingleStore, StoreOptions};
use crate::database::{Database, Lifetime, Metric};
use bincode;
use super::persist_ping_lifetime_data;
</imports>
<Rust>
#[test]
fn test_persist_ping_lifetime_data() {
    let dir = tempdir().unwrap();
    let str_dir = dir.path().display().to_string();
    let db = Database::new(&str_dir, true).unwrap();
    let test_storage = "test-storage";
    let test_metric_id = "telemetry_test.test_name";
    let test_value = "test-value";

    db.record_per_lifetime(
        Lifetime::Ping,
        test_storage,
        test_metric_id,
        &Metric::String(test_value.to_string()),
    )
    .unwrap();

    db.persist_ping_lifetime_data().unwrap();

    let store: SingleStore = db
        .rkv
        .open_single(Lifetime::Ping.as_str(), StoreOptions::create())
        .unwrap();
    let reader = db.rkv.read().unwrap();
    let key = format!("{}#{}", test_storage, test_metric_id);
    let value = store.get(&reader, key.as_bytes()).unwrap().unwrap();

    let expected = Metric::String(test_value.to_string());
    let actual: Metric = bincode::deserialize(value.as_blob().unwrap()).unwrap();

    assert_eq!(expected, actual);
}
</Rust>