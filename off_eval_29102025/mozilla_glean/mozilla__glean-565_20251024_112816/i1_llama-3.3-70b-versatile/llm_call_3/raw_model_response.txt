<Filename>glean-core/src/database/mod.rs</Filename>
<imports>
use std::collections::BTreeMap;
use std::sync::RwLock;
use super::persist_ping_lifetime_data;
use super::Database;
use super::Lifetime;
use super::Metric;
use super::StoreOptions;
use bincode;
use rkv::Value;
</imports>
<Rust>
#[test]
fn test_persist_ping_lifetime_data() {
  let db = Database::new("test_dir", true).unwrap();
  let mut ping_lifetime_data = BTreeMap::new();
  ping_lifetime_data.insert("test_key".to_string(), Metric::String("test_value".to_string()));
  let mut db_ping_lifetime_data = db.ping_lifetime_data.unwrap();
  *db_ping_lifetime_data.write().unwrap() = ping_lifetime_data;
  persist_ping_lifetime_data(&db).unwrap();
  let store = db.rkv.open_single(Lifetime::Ping.as_str(), StoreOptions::create()).unwrap();
  let reader = db.rkv.read().unwrap();
  let value = store.get(&reader, "test_key").unwrap().unwrap();
  let metric: Metric = bincode::deserialize(value.as_blob().unwrap()).unwrap();
  assert_eq!(metric, Metric::String("test_value".to_string()));
}
</Rust>