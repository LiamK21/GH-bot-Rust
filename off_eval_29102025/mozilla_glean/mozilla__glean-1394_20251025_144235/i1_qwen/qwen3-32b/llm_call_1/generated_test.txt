#[test]
fn test_custom_distribution_invalid_value_error_count() {
    let tmpdir = tempfile::tempdir().unwrap();
    setup_glean(tmpdir.path()).unwrap();

    let metric = CustomDistributionMetric::new(
        CommonMetricData {
            category: "testing".into(),
            name: "custom_dist".into(),
            send_in_pings: vec!["test_ping".into()],
            ..Default::default()
        },
        0,
        100,
        10,
        HistogramType::Linear,
    );

    // Trigger an error by adding invalid negative values
    let metric_cast = &metric as &dyn CustomDistribution;
    metric_cast.accumulate_samples_signed(vec![5, -5, -10]);

    // Ensure dispatcher has processed the error recording
    block_on_dispatcher();

    // Validate that InvalidValue errors were recorded
    let error_count = metric.test_get_num_recorded_errors(ErrorType::InvalidValue, None);
    assert_eq!(error_count, 2);
}