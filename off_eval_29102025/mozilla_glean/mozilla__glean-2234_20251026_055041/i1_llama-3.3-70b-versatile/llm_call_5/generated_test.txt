#[test]
fn test_preinit_queue_size() {
  let max_queue_size = 10;
  let dispatcher = Dispatcher::new(max_queue_size);
  let mut tasks = vec![];
  for _ in 0..max_queue_size + 2 {
    tasks.push(Command::Task(Box::new(|| ())));
  }
  let mut errors = 0;
  for task in tasks {
    match DispatchGuard::send(&dispatcher.guard, task) {
      Err(DispatchError::QueueFull) => errors += 1,
      _ => (),
    }
  }
  assert_eq!(errors, 2);
}