#[test]
#[cfg(unix)]
fn test_glean_flush_rlb_dispatcher_calls_symbol() {
    #[no_mangle]
    pub extern "C" fn rlb_flush_dispatcher() {
        static mut FLAG: AtomicUsize = AtomicUsize::new(0);
        unsafe { FLAG.store(1, Ordering::SeqCst); }
    }

    static EXPECTED_FLAG: AtomicUsize = AtomicUsize::new(0);

    // Hook weak symbol resolution to test symbol.
    // For this test, override the default `weak::fetch()` behavior.
    // SAFETY: Only used in test, and only for test duration.
    unsafe {
        extern "C" {
            fn __dlerror() -> *const std::os::raw::c_char;
        }
    }

    // Call the function under test
    unsafe { glean_flush_rlb_dispatcher() };

    // Verify that the function called the test symbol.
    // In real usage, this would be done via dynamic lookup.
    assert_eq!(EXPECTED_FLAG.load(Ordering::SeqCst), 1);
}