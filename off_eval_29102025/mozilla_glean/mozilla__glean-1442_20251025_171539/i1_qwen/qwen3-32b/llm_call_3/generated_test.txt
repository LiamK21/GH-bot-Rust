#[test]
#[cfg(unix)]
fn test_glean_flush_rlb_dispatcher_calls_symbol() {
    mod mock {
        static mut MOCK_FLAG: usize = 0;

        #[no_mangle]
        pub extern "C" fn rlb_flush_dispatcher() {
            unsafe {
                MOCK_FLAG = 1;
            }
        }

        pub fn reset_flag() {
            unsafe {
                MOCK_FLAG = 0;
            }
        }

        pub fn get_flag() -> usize {
            unsafe { MOCK_FLAG }
        }
    }

    unsafe {
        mock::reset_flag();
        super::glean_flush_rlb_dispatcher();
        assert_eq!(mock::get_flag(), 1);
    }
}