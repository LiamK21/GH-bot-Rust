<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use crate::upload::PingUploadManager;
use crate::upload::UploadResult;
use crate::tests::new_glean;
use crate::PingType;
use std::thread;
use std::time::Duration;
use tempfile::TempDir;
</imports>
<Rust>
#[test]
fn test_process_ping_upload_response_with_no_status() {
  let (mut glean, dir) = new_glean(None);
  let ping_type = PingType::new("test", true, /* send_if_empty */ true, vec![]);
  glean.register_ping_type(&ping_type);
  glean.submit_ping(&ping_type, None).unwrap();
  let upload_manager = PingUploadManager::new(&dir.path());
  let mut upload_task = upload_manager.get_upload_task();
  while upload_task == crate::upload::PingUploadTask::Wait {
    thread::sleep(Duration::from_millis(10));
    upload_task = upload_manager.get_upload_task();
  }
  match upload_task {
    crate::upload::PingUploadTask::Upload(request) => {
      let uuid = request.uuid;
      upload_manager.process_ping_upload_response(&uuid, UploadResult::UnrecoverableFailure);
      assert!(upload_manager.get_upload_task() == crate::upload::PingUploadTask::Done);
    }
    _ => panic!("Expected upload manager to return the next request!"),
  }
}
</Rust>