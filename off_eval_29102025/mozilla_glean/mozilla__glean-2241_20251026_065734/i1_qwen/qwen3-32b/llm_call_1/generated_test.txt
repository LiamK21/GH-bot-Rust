#[test]
fn test_trigger_upload_error_handling() {
    struct ErrorCallback;

    impl OnGleanEvents for ErrorCallback {
        fn trigger_upload(&self) -> Result<(), CallbackError> {
            Err(CallbackError::UnexpectedError)
        }

        fn start_metrics_ping_scheduler(&self) -> bool {
            false
        }

        fn cancel_uploads(&self) -> Result<(), CallbackError> {
            Ok(())
        }
    }

    let callbacks: Box<dyn OnGleanEvents> = Box::new(ErrorCallback);
    let state = State {
        callbacks,
        // Other fields omitted for brevity
    };
    setup_state(state);

    // This would normally be triggered by Glean's initialization code
    let sent = true;
    let reason = Some("dirty_startup".into());
    let ping_name = "baseline".into();

    // This call would normally be made by Glean's internal code
    if sent {
        let state = global_state().lock().unwrap();
        if let Err(e) = state.callbacks.trigger_upload() {
            error!("Triggering upload failed. Error: {}", e);
        }
    }
}