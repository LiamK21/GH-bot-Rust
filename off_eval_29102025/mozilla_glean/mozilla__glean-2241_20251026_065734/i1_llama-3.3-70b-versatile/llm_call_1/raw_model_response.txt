<Filename> glean-core/src/lib.rs </Filename>
<imports> 
use glean_core::OnGleanEvents;
use glean_core::CallbackError;
use std::sync::Arc;
use std::sync::Mutex;
use std::error::Error;
</imports>
<Rust>
#[test]
fn test_trigger_upload_error_handling() {
  let mock_callbacks = Arc::new(Mutex::new(MockCallbacks));
  let state = State { callbacks: mock_callbacks };
  let result = state.callbacks.lock().unwrap().trigger_upload();
  assert!(result.is_err());
  assert_eq!(result.unwrap_err(), CallbackError::UnexpectedError);
}
struct MockCallbacks {}
impl OnGleanEvents for MockCallbacks {
  fn trigger_upload(&self) -> Result<(), CallbackError> {
    Err(CallbackError::UnexpectedError)
  }
  fn start_metrics_ping_scheduler(&self) -> bool {
    false
  }
  fn cancel_uploads(&self) -> Result<(), CallbackError> {
    Ok(())
  }
}
struct State {
  callbacks: Arc<Mutex<dyn OnGleanEvents>>,
}
</Rust>