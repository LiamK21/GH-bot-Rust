<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use chrono::Utc;
use chrono::Duration;
use crate::upload::request::create_date_header_value;
use crate::upload::PingUploadManager;
use std::collections::HashMap;
use crate::Glean;
use std::path::PathBuf;
use crate::error::Error;
use crate::config::InternalConfiguration;
</imports>
<Rust>
#[test]
fn test_date_header_set_at_upload_time() {
  let mut manager = PingUploadManager::new(PathBuf::from("/tmp"), "test");
  let glean = Glean::new(InternalConfiguration::default()).unwrap();
  let request = manager.get_upload_task(&glean, true);
  match request {
    crate::upload::PingUploadTask::Upload { request: req } => {
      let actual_date = req.headers.get("Date").unwrap().to_string();
      let expected_date = create_date_header_value(Utc::now());
      assert!(actual_date != create_date_header_value(Utc::now() - Duration::seconds(1)));
    },
    _ => assert!(false, "Expected PingUploadTask::Upload"),
  }
}
</Rust>