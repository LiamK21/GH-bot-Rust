<Filename>glean-core/src/database/mod.rs</Filename>
<imports>
use super::migrate;
use rkv::Rkv;
use rkv::backend::Lmdb;
use rkv::backend::SafeMode;
use std::fs;
use std::path::Path;
use tempfile::tempdir;
</imports>
<Rust>
#[test]
fn test_migrate_lmdb_to_safe_mode() {
    let dir = tempdir().unwrap();
    let database_dir = dir.path().join("db");
    fs::create_dir_all(&database_dir).expect("create dir");

    let datamdb = database_dir.join("data.mdb");
    let lockmdb = database_dir.join("lock.mdb");

    fs::write(&datamdb, "bogus").expect("dbfile created");
    fs::write(&lockmdb, "bogus").expect("lockfile created");

    let rkv_db = Rkv::new::<SafeMode>(&database_dir).expect("rkv env");
    migrate(&database_dir, &rkv_db);

    assert!(!datamdb.exists(), "LMDB data should be deleted");
    assert!(!lockmdb.exists(), "LMDB lock should be deleted");
}
</Rust>