#[test]
fn test_merge_saturating_addition() {
    let precomputed_bucketing1 = PrecomputedLinear {
        bucket_ranges: OnceCell::from([0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100].to_vec()),
        bucket_count: 11,
        min: 0,
        max: 100,
    };
    let bucketing1 = LinearOrExponential::Linear(precomputed_bucketing1);
    let mut h1 = Histogram {
        bucketing: bucketing1,
        sum: u64::MAX,
        count: u64::MAX,
        values: Default::default(),
    };

    let precomputed_bucketing2 = PrecomputedLinear {
        bucket_ranges: OnceCell::from([0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100].to_vec()),
        bucket_count: 11,
        min: 0,
        max: 100,
    };
    let bucketing2 = LinearOrExponential::Linear(precomputed_bucketing2);
    let h2 = Histogram {
        bucketing: bucketing2,
        sum: 1,
        count: 1,
        values: [(10, 1)].iter().cloned().collect(),
    };

    h1.merge(&h2);
    assert_eq!(h1.sum, u64::MAX);
    assert_eq!(h1.count, u64::MAX);
    assert_eq!(h1.values.get(&10).copied(), Some(1));
}