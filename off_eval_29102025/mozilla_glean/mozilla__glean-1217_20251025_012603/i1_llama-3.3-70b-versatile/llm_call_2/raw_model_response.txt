<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use std::path::PathBuf;
use std::fs;
use std::io;
use tempfile::TempDir;
use super::PingUploadManager;
use super::PingDirectoryManager;
use super::Policy;
use super::new_glean;
use super::PingType;
use super::Glean;
</imports>
<Rust>
#[test]
fn test_pending_pings_count_quota() {
  let temp_dir = TempDir::new().unwrap();
  let (mut glean, _) = new_glean(Some(temp_dir.path()));
  let ping_type = PingType::new("test", true, /* send_if_empty */ true, vec![]);
  glean.register_ping_type(&ping_type);
  let mut upload_manager = PingUploadManager::no_policy(temp_dir.path());
  upload_manager.policy.set_max_pending_pings_count(Some(5));
  for _ in 0..10 {
    glean.submit_ping(&ping_type, None).unwrap();
  }
  let directory_manager = PingDirectoryManager::new(temp_dir.path());
  let pending_pings = directory_manager.process_dirs().pending_pings;
  assert!(pending_pings.len() <= 5);
}
</Rust>