<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use std::path::PathBuf;
use std::thread;
use std::time::Duration;
use crate::Glean;
use crate::Configuration;
use crate::PingUploadManager;
use crate::PingUploadTask;
</imports>
<Rust>
#[test]
fn test_non_deletion_pings_are_not_uploaded_when_upload_disabled() {
  let data_path = PathBuf::from("/tmp/test");
  let mut glean = Glean::new(Configuration {
    data_path,
    upload_enabled: false,
    ..Default::default()
  }).unwrap();
  let upload_manager = PingUploadManager::no_policy(data_path);
  upload_manager.set_rate_limiter(60, 15);
  let doc_id = "test_doc_id";
  let path = format!("/submit/app_id/test-ping/1/{}", doc_id);
  upload_manager.enqueue_ping(&glean, &doc_id, &path, "", None);
  thread::sleep(Duration::from_millis(100));
  assert_eq!(PingUploadTask::Done, upload_manager.get_upload_task(&glean, false));
}
</Rust>