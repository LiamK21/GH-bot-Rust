#[test]
fn test_set_dispatches_off_main_thread() {
    let main_thread_id = thread::current().id();
    let metric = BooleanMetric::new(glean_core::CommonMetricData {
        category: "test".into(),
        name: "main_thread_set".into(),
        send_in_pings: vec![],
        lifetime: glean_core::Lifetime::Application,
        disabled: false,
        dynamic_label: None,
    });

    let captured_thread = Arc::new(Mutex::new(None));
    let captured_thread_clone = Arc::clone(&captured_thread);

    metric.set(true);

    dispatcher::block_on_queue();

    let captured_id = captured_thread.lock().unwrap().as_ref().unwrap();
    assert_ne!(*captured_id, main_thread_id);
}