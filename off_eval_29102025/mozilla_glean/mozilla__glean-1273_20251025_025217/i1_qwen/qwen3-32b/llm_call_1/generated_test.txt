#[test]
fn test_set_dispatches_off_main_thread() {
    let main_thread_id = thread::current().id();
    let metric = BooleanMetric::new(glean_core::CommonMetricData {
        category: "test".into(),
        name: "main_thread_set".into(),
        send_in_pings: vec![],
        time_unit: None,
    });

    // Capture thread ID inside a task launched by the BooleanMetric's set
    let captured_thread = Arc::new(Mutex::new(None));
    let captured_thread_clone = Arc::clone(&captured_thread);

    metric.set(true);

    // Ensure the task has a chance to run
    dispatcher::block_on_queue();

    // Check that the task was executed on a different thread
    let captured_id = captured_thread.lock().unwrap().as_ref().unwrap();
    assert_ne!(*captured_id, main_thread_id);
}