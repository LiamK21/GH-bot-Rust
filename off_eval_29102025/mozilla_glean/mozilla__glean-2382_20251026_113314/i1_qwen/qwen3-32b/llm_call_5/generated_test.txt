#[test]
fn test_missing_send_ids_counter_incremented() {
    let glean = TestGlean::new();
    let document_id = "untracked_doc";
    let data_path = PathBuf::from("/tmp/test_upload_metrics");
    let manager = PingUploadManager::no_policy(data_path);
    let upload_metrics = UploadMetrics::new();

    // Create a ping to be handled
    let ping = Arc::new(PingDescriptor {
        name: "event".to_string(),
        reason: None,
        include_client_id: false,
        ..PingDescriptor::default()
    });

    // Add it to pending pings to create a document_id
    manager.cached_pings.lock().unwrap().insert(document_id.to_string(), PingContent { ping, ..Default::default() });

    // Handle upload for an unknown ID
    manager.handle_upload(document_id, &UploadResult::HttpStatus { code: 500 });

    assert_eq!(glean.get_metric::<_, u32>("glean.upload.missing_send_ids", None).unwrap(), 1);
}