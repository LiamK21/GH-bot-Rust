#[test]
fn test_missing_send_ids_increments_counter() {
    let glean = Glean::new(Default::default()).unwrap();
    let upload_metrics = UploadMetrics {
        send_success: TimingDistributionMetric::new(CommonMetricData::default(), crate::TimeUnit::Second),
        send_failure: TimingDistributionMetric::new(CommonMetricData::default(), crate::TimeUnit::Second),
        in_flight_pings_dropped: CounterMetric::new(CommonMetricData::default()),
        missing_send_ids: CounterMetric::new(CommonMetricData {
            name: "missing_send_ids".into(),
            category: "glean.upload".into(),
            send_in_pings: vec!["metrics".into()],
            lifetime: Lifetime::Ping,
            disabled: false,
            dynamic_label: None,
        }),
    };
    let mut ping_upload_manager = PingUploadManager {
        upload_metrics,
        cached_pings: Default::default(),
        directory_manager: Default::default(),
        in_flight: Default::default(),
        queue: Default::default(),
        processed_pending_pings: Default::default(),
        recoverable_failure_count: Default::default(),
        wait_attempt_count: Default::default(),
        rate_limiter: Default::default(),
    };
    let document_id = "test_doc_id";
    let status = UploadResult::HttpStatus { code: 404 };
    let mut lock = HashMap::new();

    ping_upload_manager.handle_upload_status(&glean, document_id, status, &mut lock);

    let expected = Some(1);
    let actual = ping_upload_manager.upload_metrics.missing_send_ids.test_get_value(Some("metrics".into()));
    assert_eq!(expected, actual);
}