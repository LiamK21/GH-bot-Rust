#[test]
fn async_ping_scanning_sets_upload_task() {
    let (mut glean, dir) = new_glean(None);

    // Register and submit a test ping
    let ping_type = crate::PingType::new("test", true, /* send_if_empty */ true, vec![]);
    glean.register_ping_type(&ping_type);
    glean.submit_ping(&ping_type, None).unwrap();

    // Wait for the async scan to process the ping
    let mut task;
    loop {
        task = glean.get_upload_task();
        match task {
            PingUploadTask::Upload(_) => break,
            PingUploadTask::Wait => {
                sleep(Duration::from_millis(10));
            },
            _ => break,
        }
    }

    // Verify the task is not `Done` (there's a ping to upload)
    assert_ne!(task, PingUploadTask::Done);
}