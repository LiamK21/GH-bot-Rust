#[test]
fn test_metrics_enabled_inversion() {
    with_glean(|glean| {
        let category = "category";
        let name = "enabled_metric";

        let metric = StringMetric::new(
            &glean,
            category,
            name,
            "test string metric",
            true, // Metric is disabled by default
        );

        let base_identifier = metric.meta().base_identifier();

        // Before config update, metric is disabled
        metric.set("test_value");
        assert_eq!(metric.test_get_value(&glean, None), None);

        // Set config to enable the metric
        let mut enabled_config = json!({base_identifier: true}).to_string();
        unsafe { glean_set_metrics_enabled_config(enabled_config) };

        // Metric should now be enabled
        metric.set("test_value");
        assert_eq!(metric.test_get_value(&glean, None), Some("test_value"));
    });
}