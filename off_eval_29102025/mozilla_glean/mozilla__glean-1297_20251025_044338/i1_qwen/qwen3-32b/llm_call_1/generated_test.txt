#[test]
fn test_tasks_after_shutdown_do_not_execute() {
    let (dispatcher, _guard) = new_dispatcher();
    let result = Arc::new(Mutex::new(Vec::new()));
    let result_cloned = Arc::clone(&result);

    // Spawn a background thread to attempt task submission after shutdown
    let handle = thread::spawn(move || {
        let guard = dispatcher.guard();
        guard.shutdown().unwrap();
        let _ = guard.launch(move || {
            result_cloned.lock().unwrap().push(0);
        });
    });

    // Ensure the task is processed and dispatcher is joined
    handle.join().unwrap();

    // Verify no task was executed
    assert!(result.lock().unwrap().is_empty());
    dispatcher.join().unwrap();
}