<Filename>glean-core/src/scheduler.rs</Filename>
<imports>
use chrono::FixedOffset;
use chrono::DateTime;
use std::sync::atomic::Ordering;
use std::sync::atomic::AtomicUsize;
use std::sync::Arc;
use super::schedule_internal;
use super::new_glean;
use super::new_proxies;
use super::get_last_sent_build_metric;
</imports>
<Rust>
#[test]
fn test_schedule_internal_first_run() {
  let (mut glean, _t) = new_glean(None);
  glean.app_build = "a build".into();
  let lsb_metric = get_last_sent_build_metric();
  let submitter_count = Arc::new(AtomicUsize::new(0));
  let scheduler_count = Arc::new(AtomicUsize::new(0));
  let (submitter, submitter_count_clone, scheduler, scheduler_count_clone) = new_proxies(
            |_, reason| assert_eq!(reason, Some("overdue")),
            |_, when| assert_eq!(when, super::When::Reschedule),
        );
  let fake_now = FixedOffset::east(0)
            .ymd(2022, 11, 15)
            .and_hms(1, 0, 1);
  schedule_internal(&glean, submitter, scheduler, fake_now);
  assert_eq!(1, submitter_count_clone.swap(0, Ordering::Relaxed));
  assert_eq!(1, scheduler_count_clone.swap(0, Ordering::Relaxed));
  assert_eq!(
            Some(glean.app_build.to_string()),
            lsb_metric.get_value(&glean, Some("internal_storage"))
        );
}
</Rust>