<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use log::Level;
use log::LevelFilter;
use log::log_enabled;
use std::io::Cursor;
use env_logger::builder;
use env_logger::Env;
use super::PingUploadManager;
use super::RecoverableFailure;
</imports>
<Rust>
#[test]
fn test_recoverable_upload_failure_logging() {
  let document_id = "957090b3-4e26-4cfc-bfd8-00cbbac42524";
  let status = RecoverableFailure;
  let original_log_level = log::max_level();
  log::set_max_level(LevelFilter::Trace);
  let mut cursor = Cursor::new(Vec::new());
  let _ = builder().filter_level(LevelFilter::Info).try_init();
  let _ = log::set_boxed_logger(Box::new(builder().filter_level(LevelFilter::Info).build()));
  let ping_upload_manager = PingUploadManager::new("test", "test");
  ping_upload_manager.upload(document_id, status);
  let actual_log = String::from_utf8(cursor.into_inner()).unwrap();
  let expected_log = format!("Recoverable upload failure while attempting to send ping {}, will retry. Error was {:?}", document_id, status);
  assert!(actual_log.contains(&expected_log));
  log::set_max_level(original_log_level);
}
</Rust>