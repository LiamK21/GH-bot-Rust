#[test]
fn test_recoverable_failure_logs_info_level() {
    log::set_max_level(log::LevelFilter::Info);
    let logs = log::capture::CapturedLogs::new();

    // Create a valid PingUploadManager and force a recoverable error by invoking the code path
    let manager = PingUploadManager::new(/* dummy parameters */);
    let document_id = "test_document_id";
    let status = glean_core::upload::RecoverableFailure;

    // Manually invoke the code path that matches on the status (simulate upload error handling)
    manager.handle_upload(document_id, &status).unwrap_err();

    let expected_message = format!(
        "Recoverable upload failure while attempting to send ping {}, will retry. Error was {:?}",
        document_id, status
    );

    // Ensure only one log message was generated at the correct level
    assert_eq!(logs.len(), 1);
    let log = &logs[0];
    assert_eq!(log.level(), Level::Info);
    assert_eq!(log.args().to_string(), expected_message);
}