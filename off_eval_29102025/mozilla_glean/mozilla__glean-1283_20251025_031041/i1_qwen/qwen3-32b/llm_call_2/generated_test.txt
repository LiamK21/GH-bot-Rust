#[test]
fn test_recoverable_failure_logs_info_level() {
    // Initialize test logger
    let _ = std::fs::TempDir::new("glean-test").unwrap();
    let logs = log::capture::CapturedLogs::new();

    log::set_max_level(log::LevelFilter::Info);
    env_logger::builder()
        .format(|buf, record| {
            writeln!(buf, "{}", record.args())
        })
        .is_test(true)
        .try_init()
        .unwrap();

    let data_path = PathBuf::from(std::env::temp_dir()).join("glean-test");
    let manager = PingUploadManager::new(data_path, "test-frontend");

    // Simulate upload failure via mock HTTP response
    let response = Response::builder()
        .status(StatusCode::TOO_MANY_REQUESTS)
        .body(vec![])
        .unwrap();

    // Use existing ping to trigger upload
    let document_id = "test_document_id";
    let result = block_on(manager.upload(document_id, &response));

    logs.assert_any(|log| {
        assert_eq!(log.level, Level::Info);
        assert!(log.args.to_string().contains(&format!(
            "Recoverable upload failure while attempting to send ping {}, will retry. Error was RecoverableFailure",
            document_id
        )));
    });
}