<Filename>glean-core/rlb/src/lib.rs</Filename>
<imports>
use super::initialize_core_metrics;
use crate::core_metrics::ClientInfoMetrics;
use crate::Glean;
use crate::Configuration;
use crate::GLOBAL_APPLICATION_ID;
use crate::test_reset_glean;
use crate::core_metrics::internal_metrics;
use tempfile::tempdir;
</imports>
<Rust>
#[test]
fn test_initialize_core_metrics_resets_state() {
    let dir = tempdir().unwrap();
    let tmpname = dir.path().display().to_string();

    let glean = Glean::new(Configuration {
        data_path: tmpname.clone(),
        application_id: GLOBAL_APPLICATION_ID.into(),
        upload_enabled: true,
        max_events: None,
        delay_ping_lifetime_io: false,
        channel: Some("test_channel".into()),
        server_endpoint: Some("invalid-test-host".into()),
        uploader: None,
    });

    let client_info = ClientInfoMetrics::unknown();
    initialize_core_metrics(&glean, &client_info, Some("test_channel".into()));

    let expected_channel = Some("test_channel".to_string());
    let actual_channel = internal_metrics::app_channel.test_get_value(None);

    assert_eq!(expected_channel, actual_channel);
}
</Rust>