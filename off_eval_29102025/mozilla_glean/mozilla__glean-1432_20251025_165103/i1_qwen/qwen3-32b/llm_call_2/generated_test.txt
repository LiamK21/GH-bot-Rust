#[test]
fn test_core_metrics_cleared_after_reset() {
    let _lock = lock_test();
    let tmpdir = tempdir().unwrap();
    let tmpname = tmpdir.path().display().to_string();

    // First initialization
    test_reset_glean(
        Configuration {
            data_path: tmpname.clone(),
            application_id: "test_app".into(),
            upload_enabled: true,
            server_endpoint: Some("https://example.com/upload".into()),
            max_events: None,
            delay_ping_lifetime_io: false,
            channel: None,
        },
        ClientInfoMetrics::unknown(),
        true,
    );

    // Initialize Glean singleton
    let glean = new_glean(None, true);

    // Set a value in the internal metric
    app_channel.set_sync(&glean, "test_channel");

    // Verify value is set
    assert_eq!(Some("test_channel".to_string()), app_channel.test_get_value(None));

    // Reset Glean state
    test_reset_glean(
        Configuration {
            data_path: tmpname,
            application_id: "test_app".into(),
            upload_enabled: true,
            server_endpoint: Some("https://example.com/upload".into()),
            max_events: None,
            delay_ping_lifetime_io: false,
            channel: None,
        },
        ClientInfoMetrics::unknown(),
        false,
    );

    // Expect value to be cleared after reset
    assert!(app_channel.test_get_value(None).is_none());
}