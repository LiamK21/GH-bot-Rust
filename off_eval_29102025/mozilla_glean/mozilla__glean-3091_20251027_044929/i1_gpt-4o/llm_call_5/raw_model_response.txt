<Filename>glean-core/src/lib_unit_tests.rs</Filename>
<imports>
use super::initialize_inner;
use super::glean_test_get_attribution;
use super::glean_test_get_distribution;
use super::glean_update_attribution;
use super::glean_update_distribution;
use super::AttributionMetrics;
use super::DistributionMetrics;
use super::ClientInfoMetrics;
use super::GLOBAL_APPLICATION_ID;
use super::InternalConfiguration;
use tempfile::tempdir;
</imports>
<Rust>
#[test]
fn test_attribution_and_distribution_persist_after_initialization() {
    let dir = tempdir().unwrap();
    let tmpname = dir.path().display().to_string();

    let attribution = AttributionMetrics {
        source: Some("source".into()),
        medium: Some("medium".into()),
        campaign: Some("campaign".into()),
        term: Some("term".into()),
        content: Some("content".into()),
    };
    let distribution = DistributionMetrics {
        name: Some("name".into()),
    };

    glean_update_attribution(attribution.clone());
    glean_update_distribution(distribution.clone());

    initialize_inner(
        InternalConfiguration {
            language_binding_name: "test".to_string(),
            app_build: "1.0".to_string(),
            use_core_mps: false,
            trim_data_to_registered_pings: false,
            log_level: None,
            upload_enabled: true,
            data_path: tmpname,
            application_id: GLOBAL_APPLICATION_ID.to_string(),
            max_events: None,
            delay_ping_lifetime_io: false,
        },
        ClientInfoMetrics::unknown(),
        Box::new(|_| {}),
    );

    assert_eq!(attribution, glean_test_get_attribution());
    assert_eq!(distribution, glean_test_get_distribution());
}
</Rust>