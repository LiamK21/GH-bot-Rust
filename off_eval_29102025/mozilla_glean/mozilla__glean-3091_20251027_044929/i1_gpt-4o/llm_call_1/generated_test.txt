#[test]
fn test_attribution_and_distribution_persist_after_initialization() {
    let _lock = lock_test();
    let dir = tempdir().unwrap();
    let tmpname = dir.path().to_path_buf();

    destroy_glean(true, &tmpname);

    let attribution = AttributionMetrics {
        source: Some("source".into()),
        medium: Some("medium".into()),
        campaign: Some("campaign".into()),
        term: Some("term".into()),
        content: Some("content".into()),
    };
    let distribution = DistributionMetrics {
        name: Some("name".into()),
    };

    glean_update_attribution(attribution.clone());
    glean_update_distribution(distribution.clone());

    initialize_inner(
        ConfigurationBuilder::new(true, tmpname, GLOBAL_APPLICATION_ID)
            .with_server_endpoint("invalid-test-host")
            .build(),
        ClientInfoMetrics::unknown(),
        Box::new(|_| {}),
    );

    assert_eq!(attribution, glean_test_get_attribution());
    assert_eq!(distribution, glean_test_get_distribution());
}