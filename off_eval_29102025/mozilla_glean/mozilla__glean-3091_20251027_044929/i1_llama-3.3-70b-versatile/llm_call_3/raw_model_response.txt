<Filename>glean-core/src/lib_unit_tests.rs</Filename>
<imports>
use super::glean_update_attribution;
use super::glean_update_distribution;
use super::glean_test_get_attribution;
use super::glean_test_get_distribution;
use std::path::PathBuf;
use tempfile::tempdir;
use crate::core::Glean;
use crate::core_metrics::AttributionMetrics;
use crate::core_metrics::DistributionMetrics;
</imports>
<Rust>
#[test]
fn test_attribution_and_distribution_persistence() {
  let dir = tempdir().unwrap();
  let tmpname = dir.path().to_path_buf().display().to_string();
  let glean = Glean::with_options(&tmpname, "test_app", true, true);

  let mut attribution = AttributionMetrics {
    source: Some("source".into()),
    medium: Some("medium".into()),
    campaign: Some("campaign".into()),
    term: Some("term".into()),
    content: Some("content".into()),
  };
  let distribution = DistributionMetrics {
    name: Some("name".into()),
  };

  glean_update_attribution(attribution.clone());
  glean_update_distribution(distribution.clone());

  let updated_attribution = glean_test_get_attribution();
  let updated_distribution = glean_test_get_distribution();

  assert_eq!(attribution, updated_attribution);
  assert_eq!(distribution, updated_distribution);
}
</Rust>