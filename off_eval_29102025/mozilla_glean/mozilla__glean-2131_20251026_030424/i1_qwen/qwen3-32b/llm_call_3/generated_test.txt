#[test]
fn test_client_info_metrics_set_correctly() {
    let mut glean = Glean::new(&Configuration {
        upload_enabled: true,
        data_dir: std::path::PathBuf::from("/tmp/glean_test"),
        application_id: "test".to_string(),
        application_version: "1".to_string(),
        developer_identity: None,
        upload_to_glean: std::collections::HashSet::new(),
    })
    .unwrap();
    let client_info = ClientInfoMetrics {
        android_sdk_version: Some("30".to_string()),
        device_manufacturer: Some("Samsung".to_string()),
        device_model: Some("Galaxy S23".to_string()),
        locale: Some("en-US".to_string()),
        ..Default::default()
    };
    initialize_core_metrics(&glean, &client_info);
    let pings = glean.dispatcher().take_queued_pings();
    let client_info_ping = pings.iter()
        .find(|p| p.body.contains("glean_client_info"))
        .unwrap();
    assert!(client_info_ping.body.contains(r#""android_sdk_version":"30""#));
    assert!(client_info_ping.body.contains(r#""device_manufacturer":"Samsung""#));
    assert!(client_info_ping.body.contains(r#""device_model":"Galaxy S23""#));
    assert!(client_info_ping.body.contains(r#""locale":"en-US""#));
}