<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use super::PingUploadManager;
use super::PingUploadTask;
use super::Glean;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_maximum_wait_attempts() {
  let mut upload_manager = PingUploadManager::new("/tmp", "Testing", true);
  let secs_per_interval = 5;
  let max_pings_per_interval = 1;
  upload_manager.set_rate_limiter(secs_per_interval, max_pings_per_interval);
  upload_manager.enqueue_ping(&Glean::new(Default::default()).unwrap(), &"id".to_string(), &"/path".to_string(), &"".to_string(), None);
  upload_manager.enqueue_ping(&Glean::new(Default::default()).unwrap(), &"id2".to_string(), &"/path2".to_string(), &"".to_string(), None);
  let mut wait_count = 0;
  loop {
    match upload_manager.get_upload_task(&Glean::new(Default::default()).unwrap(), false) {
      PingUploadTask::Wait => {
        wait_count += 1;
        if wait_count > 3 {
          break;
        }
      },
      _ => break,
    }
  }
  assert_eq!(wait_count, 3);
}
</Rust>