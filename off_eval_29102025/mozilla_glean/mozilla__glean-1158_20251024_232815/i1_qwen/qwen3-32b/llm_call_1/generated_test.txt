#[test]
fn maximum_wait_attempts_is_enforced() {
    let dir = tempdir().unwrap();
    let mut manager = PingUploadManager::new(dir.path(), "Testing", true);
    manager.set_rate_limiter(5, 1);
    manager.enqueue_ping(&Glean::new_with_dir(dir.path()), &Uuid::new_v4().to_string(), "test", "", None);
    manager.enqueue_ping(&Glean::new_with_dir(dir.path()), &Uuid::new_v4().to_string(), "test", "", None);

    manager.get_upload_task(&Glean::new_with_dir(dir.path()), false);

    for _ in 0..MAX_WAIT_ATTEMPTS {
        assert_eq!(manager.get_upload_task(&Glean::new_with_dir(dir.path()), false), PingUploadTask::Wait);
    }
    assert_eq!(manager.get_upload_task(&Glean::new_with_dir(dir.path()), false), PingUploadTask::Done);
}