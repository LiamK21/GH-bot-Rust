#[test]
fn test_log_if_error_logs_error_correctly() {
    struct TestLogger {
        output: RefCell<String>,
    }

    impl TestLogger {
        fn new() -> Self {
            TestLogger {
                output: RefCell::new(String::new()),
            }
        }
    }

    impl Log for TestLogger {
        fn enabled(&self, _: &log::Metadata) -> bool {
            true
        }

        fn log(&self, record: &log::Record) {
            if record.level() == Level::Error {
                let mut output = self.output.borrow_mut();
                *output = record.args().to_string();
            }
        }

        fn flush(&self) {}
    }

    static LOGGER: TestLogger = TestLogger::new();

    fn init_logger() {
        set_max_level(Level::Error);
        set_logger(&LOGGER).unwrap();
    }

    init_logger();

    let error = super::ExternError {
        code: 1,
        message: "Test message".to_string(),
    };

    super::log_if_error(error);

    let output = LOGGER.output.borrow();
    assert!(output.contains("Glean failed (1): Test message"));
}