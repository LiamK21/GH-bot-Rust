<Filename>glean-core/ffi/src/handlemap_ext.rs</Filename>
<imports>
use super::log_if_error;
use log::LevelFilter;
use log::Level;
use std::panic;
use log::Logger;
use log::SetLoggerError;
</imports>
<Rust>
#[test]
fn test_log_if_error() {
  let error = ExternError::new(1, "Test error message");
  struct TestLogger;
  impl log::Log for TestLogger {
    fn enabled(&self, _metadata: &log::Metadata) -> bool {
      true
    }
    fn log(&self, record: &log::Record) {
      if record.level() == Level::Error && record.args().to_string().contains("Glean failed") {
        panic!("Test panic");
      }
    }
    fn flush(&self) {}
  }
  let _ = panic::catch_unwind(|| {
    log::set_max_level(LevelFilter::Error);
    log::set_logger(&TestLogger).unwrap();
    log_if_error(error);
  });
}
</Rust>