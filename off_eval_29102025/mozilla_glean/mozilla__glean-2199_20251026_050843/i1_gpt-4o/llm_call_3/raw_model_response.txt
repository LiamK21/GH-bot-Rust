<Filename>glean-core/src/metrics/url.rs</Filename>
<imports>
use super::UrlMetric;
use crate::Glean;
use crate::CommonMetricData;
use crate::metrics::Metric;
use crate::error_recording::{test_get_num_recorded_errors, ErrorType};
use crate::Lifetime;
</imports>
<Rust>
#[test]
fn test_url_truncation_to_max_length() {
    let glean = Glean::new(Default::default()).unwrap();
    let metric = UrlMetric::new(CommonMetricData {
        name: "url_metric".into(),
        category: "test".into(),
        send_in_pings: vec!["store1".into()],
        disabled: false,
        lifetime: Lifetime::Ping,
        dynamic_label: None,
    });

    let long_path_base = "abcdefgh";
    let test_url = format!("glean://{}", long_path_base.repeat(2000));
    metric.set_sync(&glean, test_url);

    let expected = format!("glean://{}", long_path_base.repeat(1023));

    assert_eq!(metric.get_value(&glean, "store1").unwrap(), expected);
    assert_eq!(
        test_get_num_recorded_errors(&glean, metric.meta(), ErrorType::InvalidOverflow),
        1
    );
}
</Rust>