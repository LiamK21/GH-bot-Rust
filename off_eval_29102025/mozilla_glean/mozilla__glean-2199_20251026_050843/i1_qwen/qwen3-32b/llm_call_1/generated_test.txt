#[test]
fn test_url_truncation_to_max_length() {
    let metric = UrlMetric::new(CommonMetricData {
        category: "test_category".to_string(),
        name: "test_url".to_string(),
        send_in_pings: vec!["store1".to_string()],
        ..Default::default()
    });
    let mut glean = Glean::new(None, None).unwrap();
    let long_url = "a".repeat(8192 + 1); // Exceeds the new max length by 1
    metric.set_sync(&glean, &long_url);
    let stored = metric.get_value(&glean, "store1").unwrap();
    assert_eq!(stored.len(), 8192);
    assert_eq!(
        test_get_num_recorded_errors(&glean, metric.meta(), ErrorType::InvalidOverflow),
        1
    );
}