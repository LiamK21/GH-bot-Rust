<Filename>glean-core/src/metrics/url.rs</Filename>
<imports>
use crate::Glean;
use crate::metrics::UrlMetric;
use crate::error::Error;
use crate::InternalConfiguration;
use std::default::Default;
</imports>
<Rust>
#[test]
fn test_url_truncation() {
  let config = InternalConfiguration { ..Default::default() };
  let glean = Glean::new(config).unwrap();
  let metric = UrlMetric::new(Default::default());
  let long_path_base = "abcdefgh";
  let test_url = format!("glean://{}", long_path_base.repeat(2000));
  let expected = if UrlMetric::MAX_URL_LENGTH == 2048 {
    None
  } else {
    let expected = format!("glean://{}", long_path_base.repeat(1023));
    Some(expected)
  };
  metric.set_sync(&glean, &test_url);
  let actual = metric.get_value(&glean, "store1");
  assert_eq!(actual, expected);
}
</Rust>