#[test]
fn test_first_run_date_is_managed_correctly_when_toggling_uploading() {
    let dir = tempdir().unwrap();
    let tmpname = dir.path().display().to_string();
    let config = InternalConfiguration {
        data_path: tmpname.clone(),
        application_id: "org.mozilla.glean.test".into(),
        upload_enabled: true,
        max_events: None,
    };
    let mut glean = Glean::new(config).unwrap();

    let original_first_run_date = glean
        .core_metrics
        .first_run_date
        .get_value(&glean, "glean_client_info");

    glean.set_upload_enabled(false);
    let first_run_date_after_disable = glean
        .core_metrics
        .first_run_date
        .get_value(&glean, "glean_client_info");
    assert_eq!(original_first_run_date, first_run_date_after_disable);

    glean.set_upload_enabled(true);
    let first_run_date_after_enable = glean
        .core_metrics
        .first_run_date
        .get_value(&glean, "glean_client_info");
    assert_eq!(original_first_run_date, first_run_date_after_enable);
}