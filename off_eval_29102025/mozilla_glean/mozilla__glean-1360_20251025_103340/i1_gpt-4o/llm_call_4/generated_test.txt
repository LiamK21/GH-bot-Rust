#[test]
fn test_thread_naming() {
    let (block_sender, block_receiver) = mpsc::channel::<()>();
    let (preinit_sender, preinit_receiver) = mpsc::channel::<()>();
    let (unbounded_sender, unbounded_receiver) = mpsc::channel::<()>();
    let queue_preinit = Arc::new(AtomicBool::new(true));

    let worker = thread::Builder::new()
        .name("glean.dispatcher".into())
        .spawn(move || {
            if block_receiver.recv().is_err() {
                return;
            }
            let mut receiver = preinit_receiver;
            loop {
                match receiver.recv() {
                    Ok(_) => {},
                    Err(_) => return,
                }
            }
        })
        .expect("Failed to spawn thread");

    let thread_name = worker.thread().name().unwrap_or("");
    assert_eq!(thread_name, "glean.dispatcher");
}