#[test]
fn test_get_upload_task_returns_wait_before_processing_pending_pings() {
  let dir = tempdir().unwrap();
  let tmpname = dir.path().display().to_string();
  let upload_manager = PingUploadManager::new(&tmpname);
  let upload_task = upload_manager.get_upload_task();
  assert_eq!(upload_task, PingUploadTask::Wait);
}

#[test]
fn test_get_upload_task_returns_done_after_processing_pending_pings() {
  let dir = tempdir().unwrap();
  let tmpname = dir.path().display().to_string();
  let upload_manager = PingUploadManager::new(&tmpname);
  while upload_manager.get_upload_task() == PingUploadTask::Wait {
    thread::sleep(Duration::from_millis(10));
  }
  let upload_task = upload_manager.get_upload_task();
  assert_eq!(upload_task, PingUploadTask::Done);
}

#[test]
fn test_get_upload_task_returns_upload_request_after_processing_pending_pings() {
  let dir = tempdir().unwrap();
  let tmpname = dir.path().display().to_string();
  let upload_manager = PingUploadManager::new(&tmpname);
  while upload_manager.get_upload_task() == PingUploadTask::Wait {
    thread::sleep(Duration::from_millis(10));
  }
  upload_manager.enqueue_ping("uuid", "url", serde_json::json!({}));
  let upload_task = upload_manager.get_upload_task();
  match upload_task {
    PingUploadTask::Upload(_) => (),
    _ => panic!("Expected upload task to be Upload"),
  }
}