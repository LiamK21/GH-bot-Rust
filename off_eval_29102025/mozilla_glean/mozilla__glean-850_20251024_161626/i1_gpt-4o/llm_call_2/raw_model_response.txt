<Filename>glean-core/src/metrics/timing_distribution.rs</Filename>
<imports>
use super::TimingDistributionMetric;
use crate::metrics::CommonMetricData;
use crate::metrics::TimeUnit;
use crate::Glean;
use std::collections::HashSet;
use std::iter::FromIterator;
use crate::tests::new_glean;
</imports>
<Rust>
#[test]
fn test_timing_distribution_truncation_behavior() {
    let dir = tempfile::tempdir().unwrap();
    let (glean, _) = new_glean(Some(dir));
    let max_sample_time = 1000 * 1000 * 1000 * 60 * 10;

    let mut dist = TimingDistributionMetric::new(
        CommonMetricData {
            name: "test_metric".into(),
            category: "test".into(),
            send_in_pings: vec!["test_ping".into()],
            ..Default::default()
        },
        TimeUnit::Nanosecond,
    );

    let samples = vec![
        1,
        1_000,
        1_000_000,
        max_sample_time,
        max_sample_time * 1_000,
        max_sample_time * 1_000_000,
    ];

    dist.accumulate_samples_signed(&glean, samples);

    let hist = dist.test_get_value(&glean, "test_ping").unwrap();
    let expected_keys = HashSet::<u64>::from_iter(vec![1, 1_000, 1_000_000, max_sample_time]);
    let keys = HashSet::<u64>::from_iter(hist.values().keys().cloned());

    assert_eq!(keys, expected_keys);
}
</Rust>