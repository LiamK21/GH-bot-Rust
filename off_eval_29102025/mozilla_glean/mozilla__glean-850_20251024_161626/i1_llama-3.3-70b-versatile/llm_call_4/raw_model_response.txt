<Filename>glean-core/src/lib_unit_tests.rs</Filename>
<imports>
use std::collections::HashSet;
use crate::metrics::{TimingDistributionMetric, TimeUnit};
use super::*;
use crate::common_metric_data::CommonMetricData;
use tempfile::tempdir;
use crate::metrics::RecordedExperimentData;
use crate::metrics::StringMetric;
use crate::metrics::TimespanMetric;
</imports>
<Rust>
#[test]
fn test_timing_distribution_max_sample_time() {
  let dir = tempdir().unwrap();
  let (glean, _) = new_glean(Some(dir));
  let max_sample_time = 1000 * 1000 * 1000 * 60 * 10;
  let mut dist = TimingDistributionMetric::new(
    CommonMetricData {
      name: "local_metric".into(),
      category: "local".into(),
      send_in_pings: vec!["baseline".into()],
      ..Default::default()
    },
    TimeUnit::Nanosecond,
  );
  let timer_id = dist.set_start(0);
  dist.set_stop_and_accumulate(&glean, timer_id, max_sample_time * 2);
  let hist = dist.test_get_value(&glean, "baseline").unwrap();
  let max_key = hist.values().keys().max().unwrap();
  assert!(max_key <= &max_sample_time);
}
</Rust>