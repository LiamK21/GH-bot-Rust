#[test]
fn test_invalid_db_sets_error_metric() {
    let dir = tempfile::tempdir().unwrap();
    let db_path = dir.path().join("data.safe.bin");
    File::create(&db_path).unwrap(); // Empty file forces invalid db

    let glean = Glean::with_options(dir.path().to_str().unwrap(), "fake_app", true);

    let rkv_load_error = &glean.database_metrics.rkv_load_error;
    let value = rkv_load_error.get_value(&glean, "metrics");

    assert!(value.is_some());
    assert!(value.unwrap().contains("FileInvalid"));
}