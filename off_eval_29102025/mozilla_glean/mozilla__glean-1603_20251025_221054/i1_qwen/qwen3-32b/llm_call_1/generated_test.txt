#[test]
fn test_event_extra_keys_converted_correctly() {
    #[derive(Default, Debug, Clone, Hash, Eq, PartialEq)]
    struct SomeExtra {
        key1: Option<String>,
        key2: Option<String>,
    }

    impl ExtraKeys for SomeExtra {
        const ALLOWED_KEYS: &'static [&'static str] = &["key1", "key2"];
        fn into_ffi_extra(self) -> HashMap<i32, String> {
            let mut map = HashMap::new();
            self.key1.and_then(|key| { map.insert(0, key); None });
            self.key2.and_then(|key| { map.insert(1, key); None });
            map
        }
    }

    let extra = SomeExtra {
        key1: Some("value1".into()),
        key2: Some("value2".into()),
    };
    let expected: HashMap<i32, String> = [
        (0, "value1".into()),
        (1, "value2".into()),
    ].iter().cloned().collect();
    assert_eq!(extra.into_ffi_extra(), expected);
}