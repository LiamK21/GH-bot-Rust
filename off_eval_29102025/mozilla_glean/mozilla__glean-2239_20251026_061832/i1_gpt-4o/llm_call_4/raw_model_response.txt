<Filename>glean-core/src/dispatcher/global.rs</Filename>
<imports>
use std::sync::RwLock;
use once_cell::sync::Lazy;
use super::Dispatcher;
</imports>
<Rust>
#[test]
fn test_global_dispatcher_limit() {
    let dispatcher_limit = {
        #[cfg(feature = "preinit_million_queue")]
        {
            1000000
        }
        #[cfg(not(feature = "preinit_million_queue"))]
        {
            1000
        }
    };

    let global_dispatcher = Lazy::new(|| RwLock::new(Some(Dispatcher::new(dispatcher_limit))));
    let expected_limit = dispatcher_limit;
    let actual_limit = global_dispatcher.read().unwrap().as_ref().unwrap().queue_capacity();
    assert_eq!(expected_limit, actual_limit);
}
</Rust>