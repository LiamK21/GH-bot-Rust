#[test]
fn test_set_raw_records_duration_correctly() {
    let dir = tempdir().unwrap();
    let config = Configuration {
        upload_enabled: true,
        data_path: dir.path().to_path_buf(),
        ..Default::default()
    };
    let glean = Glean::new(config).unwrap();

    let metric = glean_core::metrics::Timespan::new(
        CommonMetricData {
            category: "test".into(),
            name: "metric".into(),
            send_in_pings: vec!["default".into()],
            ..Default::default()
        },
    );

    let expected = Duration::from_nanos(123456789);
    metric.set_raw(expected);

    glean_core::test::block_on_dispatcher();

    let actual = metric.test_get_value("default").unwrap();
    assert_eq!(actual, expected.as_nanos() as u64);
}