#[test]
fn test_set_raw_records_duration_correctly() {
    let dir = tempdir().unwrap();
    let storage = MemoryStorageEngine::new("test", Path::new(&dir.path().join("storage")));
    let config = Configuration::new("test.app".into(), None, dir.path().into(), None, None, None, None, None);
    let glean = Arc::new(Glean::new(config).unwrap());

    let common_data = CommonMetricData {
        category: "test".into(),
        name: "metric".into(),
        send_in_pings: vec!["default".into()],
        ..Default::default()
    };

    let metric = TimespanMetric {
        0: Arc::new(std::sync::RwLock::new(crate::private::TimespanInner {
            metric: crate::private::Metric::new(common_data, Duration::from_nanos(0)),
        })),
    };

    let expected = Duration::from_nanos(123456789);
    metric.set_raw(expected);

    glean.block_on_dispatcher();

    let actual = metric.test_get_value("default").unwrap();
    assert_eq!(actual, expected.as_nanos() as u64);
}