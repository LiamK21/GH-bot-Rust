#[test]
fn test_set_raw_records_duration_correctly() {
    let dir = tempdir().unwrap();
    let config = Configuration {
        upload_enabled: true,
        data_dir: PathBuf::from(&dir.path()),
        ..Default::default()
    };
    let glean = Arc::new(Glean::new(&config).unwrap());

    let common_data = CommonMetricData {
        category: "test".into(),
        name: "metric".into(),
        send_in_pings: vec!["default".into()],
        ..Default::default()
    };

    let metric = super::Timespan {
        0: Arc::new(std::sync::RwLock::new(super::private::timespan::TimespanInner {
            metric: glean_core::metrics::Metric::new(common_data, Duration::from_nanos(0)),
        })),
    };

    let expected = Duration::from_nanos(123456789);
    metric.set_raw(expected);

    glean_core::test::block_on_dispatcher(glean);

    let actual = metric.test_get_value("default").unwrap();
    assert_eq!(actual, expected.as_nanos() as u64);
}