#[test]
fn test_set_raw_records_duration_correctly() {
    let dir = tempfile::tempdir().unwrap();
    let storage = LocalStorageProvider::new(&dir.path().to_str().unwrap());
    let glean = Arc::new(Glean::new(storage, "test.app", true, true).unwrap());

    let metric = TimespanMetric {
        0: Arc::new(std::sync::RwLock::new(crate::private::TimespanInner {
            metric: crate::private::Metric::new(
                CommonMetricData {
                    category: "test".into(),
                    name: "metric".into(),
                    send_in_pings: vec!["default".into()],
                    ..Default::default()
                },
                Duration::from_nanos(0)
            ),
        })), 
    };

    let expected = Duration::from_nanos(123456789);
    metric.set_raw(expected);

    glean.block_on_dispatcher();

    let actual = metric.test_get_value("default").unwrap();
    assert_eq!(actual, expected.as_nanos() as u64);
}