#[test]
fn test_set_raw_records_duration_correctly() {
    let dir = tempdir().unwrap();
    let data_path = dir.path().to_str().unwrap().to_string();
    let glean = Glean::new(Configuration {
        upload_enabled: true,
        data_path,
    }).unwrap();

    let metric = TimespanMetric::new(
        CommonMetricData {
            category: "test".into(),
            name: "metric".into(),
            send_in_pings: vec!["default".into()],
            ..Default::default()
        },
    );

    let expected = Duration::from_nanos(123456789);
    metric.set_raw(expected);

    test::block_on_dispatcher();

    let actual = metric.test_get_value("default").unwrap();
    assert_eq!(actual, expected.as_nanos() as u64);
}