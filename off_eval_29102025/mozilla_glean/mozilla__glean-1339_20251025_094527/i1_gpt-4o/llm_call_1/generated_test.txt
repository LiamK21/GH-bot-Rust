#[test]
fn test_shutdown_dispatcher() {
    let shutdown_called = Arc::new(AtomicBool::new(false));
    let shutdown_called_clone = Arc::clone(&shutdown_called);

    // Mock the dispatcher::try_shutdown function
    let _mock = mockall::mock! {
        pub Dispatcher {}
        trait Dispatcher {
            fn try_shutdown() -> Result<(), String> {
                shutdown_called_clone.store(true, Ordering::SeqCst);
                Ok(())
            }
        }
    };

    shutdown();

    // Allow some time for the shutdown to be processed
    thread::sleep(Duration::from_millis(100));

    assert!(shutdown_called.load(Ordering::SeqCst));
}