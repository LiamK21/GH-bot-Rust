#[test]
fn test_accumulate_samples_signed_doesnt_record_when_should_not() {
    let dir = tempdir().unwrap();
    let glean = Glean::new(Configuration {
        data_path: dir.path().to_str().unwrap().to_string(),
        application_id: "test_app".into(),
        upload_enabled: true,
        delay_ping_lifetime_io: false,
        language_binding_name: "rust".into(),
        max_events: None,
    }).unwrap();
    let metric_data = CommonMetricData::new("category", "name", "test-storage");
    let custom_distribution = CustomDistributionMetric::new(metric_data, 1, 100, 10, HistogramType::Linear);

    glean.set_upload_enabled(false);

    custom_distribution.accumulate_samples_signed(&glean, vec![1, 2, 3]);

    let db = Database::new(dir.path().to_str().unwrap(), true).unwrap();
    let mut recorded_data = None;
    db.iter_store_from(
        crate::Lifetime::Ping,
        "test-storage",
        None,
        &mut |_, _| {
            recorded_data = Some(());
        }
    );
    assert!(recorded_data.is_none());
}