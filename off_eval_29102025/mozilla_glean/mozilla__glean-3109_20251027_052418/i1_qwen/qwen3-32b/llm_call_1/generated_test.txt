#[test]
fn test_register_ping_before_global_glean_initialized() {
    unsafe {
        let ping = PingType::new("preinit-test", true, true, false, None);
        let was_init = was_initialize_called();
        // Emulate `initialize` being called (race condition)
        crate::WAS_INITIALIZE_CALLED = true;

        register_ping_type(&ping);

        // Verify ping is stored in pre-init data
        let preinit_pings = crate::PRE_INIT_REGISTERED_PINGS.lock().unwrap();
        assert!(preinit_pings.contains(&ping));

        // Restore original state for other tests
        crate::WAS_INITIALIZE_CALLED = was_init;
    }
}