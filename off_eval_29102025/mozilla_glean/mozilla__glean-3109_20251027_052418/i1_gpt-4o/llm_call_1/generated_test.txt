#[test]
fn test_submit_ping_by_name_sync_race_condition() {
    let ping_name = "test_ping".to_string();
    let reason = Some("test_reason".to_string());

    let global_glean_initialized = Arc::new(Mutex::new(false));
    let global_glean_initialized_clone = Arc::clone(&global_glean_initialized);

    // Simulate the race condition by initializing in a separate thread
    let handle = thread::spawn(move || {
        // Simulate some delay in setting up the global Glean object
        thread::sleep(std::time::Duration::from_millis(50));
        let mut initialized = global_glean_initialized_clone.lock().unwrap();
        *initialized = true;
    });

    // Call the function under test
    let result = glean_submit_ping_by_name_sync(ping_name, reason);

    // Wait for the initialization thread to complete
    handle.join().unwrap();

    // Check if the function handled the race condition correctly
    let expected = false; // Before the patch, this would incorrectly return true
    assert_eq!(result, expected);
}