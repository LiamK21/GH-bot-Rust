#[test]
fn test_coverage_recorded_after_test_has_value_called() {
    let coverage_file = std::env::temp_dir().join("event_coverage_test.out");
    std::env::set_var("GLEAN_TEST_COVERAGE", coverage_file.clone());

    let meta = CommonMetricData {
        category: "event_category".into(),
        name: "event_metric".into(),
        send_in_pings: Vec::new(),
        lifetime: Lifetime::Application,
        disabled: false,
        logged: false,
        ..Default::default()
    };

    let db = EventDatabase {
        event_stores: RwLock::new(HashMap::new()),
        ..Default::default()
    };

    db.test_has_value(&meta, "test_store");

    let content = std::fs::read_to_string(&coverage_file).unwrap();
    assert!(content.contains("event_category.event_metric"));
}