<Filename>rust-code-analysis-cli/src/main.rs</Filename>
<imports>
use super::act_on_file;
use std::path::PathBuf;
use std::fs;
use rust_code_analysis::LANG;
use rust_code_analysis::FuncSpace;
use rust_code_analysis::metrics;
use std::sync::Arc;
use rust_code_analysis::PreprocResults;
</imports>
<Rust>
#[test]
fn test_act_on_file_with_output_format() {
    let temp_dir = tempfile::tempdir().unwrap();
    let output_path = temp_dir.path().join("output.json");
    let cfg = Config {
        function: false,
        metrics: true,
        output_format: Some(Format::Json),
        output: Some(temp_dir.path().to_path_buf()),
        pretty: false,
        line_start: None,
        line_end: None,
        in_place: false,
        comments: false,
        web: false,
    };
    let path = PathBuf::from("test.c");
    let source_code = b"int main() { return 0; }";
    let language = Some(LANG::Cpp);

    let result = act_on_file(language, path.clone(), &cfg);
    assert!(result.is_ok());

    let output_content = fs::read_to_string(output_path).unwrap();
    assert!(output_content.contains("\"name\":\"main\""));

    let space = metrics(&rust_code_analysis::CppParser::new(source_code.to_vec(), &path, None), &path).unwrap();
    let expected_output = serde_json::to_string(&space).unwrap();
    assert_eq!(output_content, expected_output);
}
</Rust>