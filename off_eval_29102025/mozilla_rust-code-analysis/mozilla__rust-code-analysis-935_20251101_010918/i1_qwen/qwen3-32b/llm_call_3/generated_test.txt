#[test]
fn test_cognitive_nesting_stack_regression() {
    struct MockParser;
    impl<'a> crate::ParserTrait for MockParser {
        type Checker = PythonCode;
        type Getter = PythonCode;
        type Cognitive = PythonCode;
        type Cyclomatic = PythonCode;
        type Halstead = PythonCode;
        type Loc = PythonCode;
        type Nom = PythonCode;
        type Mi = PythonCode;
        type NArgs = PythonCode;
        type Exit = PythonCode;
        type Wmc = PythonCode;
        type Abc = PythonCode;
        type Npm = PythonCode;
        type Npa = PythonCode;

        fn new(
            _code: Vec<u8>,
            _path: &Path,
            _pr: Option<std::sync::Arc<crate::preprocessor::PreprocResults>>,
        ) -> Self {
            Self
        }

        fn get_language(&self) -> LANG {
            LANG::Python
        }

        fn get_root(&self) -> Node {
            Node::default()
        }

        fn get_code(&self) -> &[u8] {
            unreachable!()
        }

        fn get_filters(&self, _filters: &[String]) -> crate::Filter {
            unreachable!()
        }
    }

    let parser = MockParser::new(Vec::new(), &Path::new(""), None);
    let path = Path::new("dummy.rs");

    if let Some(func) = metrics(&parser, &path) {
        assert!(
            func.metrics.cognitive.structural > 0,
            "Stack-based nesting analysis not reflected in cognitive complexity"
        );
    } else {
        panic!("Metrics computation failed");
    }
}