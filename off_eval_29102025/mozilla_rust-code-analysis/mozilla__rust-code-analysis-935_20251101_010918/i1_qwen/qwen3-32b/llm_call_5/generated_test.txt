#[test]
fn test_cognitive_nesting_regression() {
    struct MockParser;
    impl<'a> ParserTrait for MockParser {
        type Checker = PythonCode;
        type Getter = Self;
        type Cognitive = Self;
        type Cyclomatic = Self;
        type Halstead = Self;
        type Loc = Self;
        type Nom = Self;
        type Mi = Self;
        type NArgs = Self;
        type Exit = Self;
        type Wmc = Self;
        type Abc = Self;
        type Npm = Self;
        type Npa = Self;

        fn new(_code: Vec<u8>, _path: &Path, _pr: Option<std::sync::Arc<preprocessor::PreprocResults>>) -> Self {
            Self
        }

        fn get_language(&self) -> LANG {
            LANG::Python
        }

        fn get_root(&self) -> node::Node {
            node::Node::default()
        }

        fn get_code(&self) -> &[u8] {
            unreachable!()
        }

        fn get_filters(&self, _filters: &[String]) -> crate::Filter {
            unreachable!()
        }
    }

    impl MockParser {
        pub fn dummy_new() -> Self {
            Self
        }
    }

    let parser = MockParser::dummy_new();
    let path = Path::new("dummy");
    let mock_code = b"def f():\n    if True:\n        if True:\n            pass\n".to_vec();

    if let Some(func) = metrics(&parser, &path) {
        assert!(
            func.metrics.cognitive.complexity() > 2,
            "Stack-based approach not detected (expected 3+ complexity for 2 nested ifs)"
        );
    } else {
        panic!("Metrics computation failed");
    }
}