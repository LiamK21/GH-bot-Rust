#[test]
fn test_cognitive_nesting_stack_regression() {
    struct MockParser;
    impl<'a> crate::ParserTrait for MockParser {
        type Checker = PythonCode;
        type Getter = PythonCode;
        type Cognitive = PythonCode;
        type Cyclomatic = PythonCode;
        type Halstead = PythonCode;
        type Loc = PythonCode;
        type Nom = PythonCode;
        type Mi = PythonCode;
        type NArgs = PythonCode;
        type Exit = PythonCode;
        type Wmc = PythonCode;
        type Abc = PythonCode;
        type Npm = PythonCode;
        type Npa = PythonCode;

        fn new(_code: Vec<u8>, _path: &Path, _pr: Option<std::sync::Arc<crate::preprocessor::PreprocResults>>) -> Self {
            Self
        }

        fn get_language(&self) -> LANG {
            LANG::Python
        }

        fn get_root(&self) -> Node {
            Node::default()
        }

        fn get_code(&self) -> &[u8] {
            unreachable!()
        }

        fn get_filters(&self, _filters: &[String]) -> crate::Filter {
            unreachable!()
        }
    }

    impl MockParser {
        pub fn dummy_new() -> Self {
            Self
        }
    }

    let parser = MockParser::dummy_new();
    let path = Path::new("dummy");
    let mock_code = b"def f():\n    if True:\n        if True:\n            pass\n".to_vec();

    if let Some(func) = metrics(&parser, &path) {
        assert!(
            func.metrics.cognitive.structural > 2,
            "Stack-based approach not detected (expected 3+ complexity for 2 nested ifs)"
        );
    } else {
        panic!("Metrics computation failed");
    }
}