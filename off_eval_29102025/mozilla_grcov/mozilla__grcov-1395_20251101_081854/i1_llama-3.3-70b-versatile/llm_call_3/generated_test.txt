#[test]
fn test_gen_index_with_subdirectories() {
  let tera = Tera::default();
  let mut global = HtmlGlobalStats {
    dirs: BTreeMap::new(),
    stats: super::HtmlStats {
      total_lines: 0,
      covered_lines: 0,
      total_funs: 0,
      covered_funs: 0,
      total_branches: 0,
      covered_branches: 0,
    },
    abs_prefix: None,
  };
  let mut dir_stats = HtmlDirStats {
    files: BTreeMap::new(),
    stats: super::HtmlStats {
      total_lines: 0,
      covered_lines: 0,
      total_funs: 0,
      covered_funs: 0,
      total_branches: 0,
      covered_branches: 0,
    },
    abs_prefix: None,
  };
  let file_stats = HtmlFileStats {
    stats: super::HtmlStats {
      total_lines: 10,
      covered_lines: 5,
      total_funs: 2,
      covered_funs: 1,
      total_branches: 3,
      covered_branches: 2,
    },
    abs_prefix: None,
  };
  dir_stats.files.insert("file.rs".to_string(), file_stats);
  global.dirs.insert("src".to_string(), dir_stats);
  let conf = Config {
    hi_limit: 100,
    med_limit: 50,
    fn_hi_limit: 100,
    fn_med_limit: 50,
    branch_hi_limit: 100,
    branch_med_limit: 50,
    html_resources: super::HtmlResources::default(),
  };
  let output = Path::new("output");
  fs::create_dir_all(output).unwrap();
  super::gen_index(&tera, &global, &conf, output);
  assert!(output.join("index.html").exists());
  assert!(output.join("src").exists());
  assert!(output.join("src/index.html").exists());
}