#[test]
fn test_thread_failure_exit_code() {
  let (tx, rx) = mpsc::channel();
  let handle = std::thread::spawn(move || {
    panic!("Test panic");
    tx.send(()).unwrap();
  });
  let result = handle.join();
  let exit_status;
  match result {
    Ok(_) => {
      exit_status = 0;
    },
    Err(_) => {
      exit_status = 1;
    }
  }
  let output = process::Command::new("bash")
    .arg("-c")
    .arg("echo $?")
    .output()
    .expect("failed to execute process");
  let actual_exit_code = String::from_utf8_lossy(&output.stdout).trim().parse::<i32>().unwrap();
  assert_ne!(actual_exit_code, 0);
}