#[test]
fn test_thread_failure_exit_code() {
  let handle = std::thread::spawn(|| {
    panic!("Test panic");
  });
  let result = handle.join();
  let exit_status = process::exit(1);
  let output = process::Command::new("bash")
    .arg("-c")
    .arg("echo $?")
    .output()
    .expect("failed to execute process");
  let actual_exit_code = String::from_utf8_lossy(&output.stdout).trim().parse::<i32>().unwrap();
  assert_ne!(actual_exit_code, 0);
}