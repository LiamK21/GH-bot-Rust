#[test]
fn test_output_coveralls_branch() {
    let temp_dir = tempdir().unwrap();
    let output_path = temp_dir.path().join("coveralls.json");

    let mut mock_result = HashMap::new();
    mock_result.insert("line1".to_string(), 1);
    let fake_path = PathBuf::from("fake.rs");
    let cov_result = CovResult {
        coverage: mock_result,
        hits: 1,
        misses: 1,
        partials: 0,
    };
    let cov_results = Box::new(iter::once((PathBuf::from("fake.rs"), PathBuf::from("fake.rs"), cov_result)));

    super::output_coveralls(
        cov_results,
        "test_token",
        "",
        "",
        "",
        "test_sha",
        false,
        Some(output_path.to_str().unwrap()),
        "dev_branch",
    );

    let content = fs::read_to_string(&output_path).unwrap();
    let json_value: Value = serde_json::from_str(&content).unwrap();

    assert_eq!(json_value["branch"], "dev_branch");
}