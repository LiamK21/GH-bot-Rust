#[test]
fn test_mapping_overrides_prefix() {
    let mut result_map = HashMap::new();
    result_map.insert("lib/old_path.c".to_string(), ());

    let path_mapping = Some(json!({ "lib/old_path.c": "lib/new_path.c" }));
    let prefix_dir = Some(PathBuf::from("lib"));

    let results: Vec<_> = rewrite_paths(
        result_map,
        path_mapping,
        None,
        prefix_dir,
        false,
        Vec::new(),
        None,
    )
    .collect();

    assert_eq!(results.len(), 1);
    let (_, rel_path, _) = &results[0];
    assert_eq!(rel_path.to_str(), Some("new_path.c"));
}