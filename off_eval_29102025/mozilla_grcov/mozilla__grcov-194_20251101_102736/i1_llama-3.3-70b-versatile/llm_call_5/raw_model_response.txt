<Filename>src/path_rewriting.rs</Filename>
<imports>
use std::path::PathBuf;
use serde_json::json;
use super::rewrite_paths;
use defs::CovResult;
use defs::CovResultMap;
use defs::CovResultIter;
</imports>
<Rust>
#[test]
fn test_rewrite_paths_with_mapping() {
  let result_map: CovResultMap = [("path1".to_string(), CovResult { branches: 0, functions: 0, lines: 0 }), ("path2".to_string(), CovResult { branches: 0, functions: 0, lines: 0 })].iter().cloned().collect();
  let path_mapping = Some(json!({
    "path1": "new_path1",
    "path2": "new_path2"
  }));
  let source_dir = Some(PathBuf::from("tests"));
  let prefix_dir = None;
  let ignore_not_existing = false;
  let to_ignore_dirs = vec![];
  let filter_option = None;

  let expected = vec![("new_path1".to_string(), PathBuf::from("new_path1"), CovResult { branches: 0, functions: 0, lines: 0 }), ("new_path2".to_string(), PathBuf::from("new_path2"), CovResult { branches: 0, functions: 0, lines: 0 })];
  let actual: Vec<(String, PathBuf, CovResult)> = rewrite_paths(
    result_map,
    path_mapping,
    source_dir,
    prefix_dir,
    ignore_not_existing,
    to_ignore_dirs,
    filter_option,
  ).map(|(path, abs_path, result)| (path.to_str().unwrap().to_string(), abs_path, result)).collect();

  assert_eq!(actual.len(), expected.len());
  for (actual_path, actual_abs_path, _result) in actual {
    assert!(expected.iter().any(|(expected_path, expected_abs_path, _)| expected_path == &actual_path && expected_abs_path == &actual_abs_path));
  }
}
</Rust>