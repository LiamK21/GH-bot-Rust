#[test]
fn test_output_lcov_to_file() {
    let temp_dir = tempdir().unwrap();
    let file_path = temp_dir.path().join("output.lcov");
    let output_file = Some(file_path.to_str().unwrap().to_string());

    let mut coverage_data = HashMap::new();
    coverage_data.insert(1, (1, 0));
    let results: CovResultIter = Box::new(vec![
        (PathBuf::from("source1.rs"), PathBuf::from("source1.rs"), CovResult { coverage: coverage_data.clone(), ..Default::default() }),
        (PathBuf::from("source2.rs"), PathBuf::from("source2.rs"), CovResult { coverage: coverage_data, ..Default::default() }),
    ].into_iter());

    output_lcov(results, output_file.as_ref());

    let file = File::open(file_path).unwrap();
    let reader = BufReader::new(file);
    let mut lines = reader.lines();

    assert_eq!(lines.next().unwrap().unwrap(), "TN:");
    assert!(lines.next().is_none());
}