#[test]
fn test_zip_producer_ignore_orphan() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let gcno_file = "test.gcno";
    let gcno_data = b"gcno_file_data";

    // Create .gcno file
    let gcno_path = tmp_dir.path().join(gcno_file);
    let mut file = fs::File::create(&gcno_path).unwrap();
    file.write_all(gcno_data).unwrap();

    // Create zip with only .gcno file
    let zip_path = tmp_dir.path().join("files.zip");
    let mut zip_file = zip::ZipWriter::new(fs::File::create(&zip_path).unwrap());
    let options = FileOptions::default().compression_method(zip::CompressionMethod::Deflated);
    zip_file.start_file(gcno_file, options).unwrap();
    zip_file.write_all(gcno_data).unwrap();
    zip_file.finish().unwrap();

    let queue: Arc<WorkQueue> = Arc::new(MsQueue::new());
    let producer_paths = vec![zip_path.to_string_lossy().into_owned()];
    let ignore_orphan_gcno = true;

    super::zip_producer(
        tmp_dir.path(),
        &vec![&producer_paths[0]],
        &queue,
        ignore_orphan_gcno,
    );

    let expected = vec![];
    check_produced(tmp_dir.path().to_path_buf(), &queue, expected);
    tmp_dir.close().unwrap();
}