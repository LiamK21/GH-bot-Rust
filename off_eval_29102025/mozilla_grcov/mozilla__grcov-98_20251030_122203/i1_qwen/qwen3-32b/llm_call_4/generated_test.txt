#[test]
fn test_zip_producer_ignore_orphan_gcno() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let gcno_content = b"gcno_data";
    let gcno_path = tmp_dir.path().join("test.gcno");
    let mut gcno_file = fs::File::create(&gcno_path).unwrap();
    gcno_file.write_all(gcno_content).unwrap();

    let zip_path = tmp_dir.path().join("files.zip");
    let mut zip =
        zip::ZipWriter::new(fs::File::create(&zip_path).unwrap());
    let options = FileOptions::default().compression_method(zip:: CompressionMethod::Deflated);
    zip.start_file("test.gcno", options).unwrap();
    zip.write_all(gcno_content).unwrap();
    zip.finish().unwrap();

    let queue: Arc<WorkQueue> = Arc::new(MsQueue::new());
    let paths = vec![String::from("files.zip")];
    let ignore_orphan_gcno = true;

    super::zip_producer(
        tmp_dir.path(),
        &vec![&zip_path.to_string_lossy().to_string()],
        &queue,
        ignore_orphan_gcno,
    );

    let expected = vec![];
    check_produced(tmp_dir.path().to_path_buf(), &queue, expected);
    tmp_dir.close().unwrap();
}