#[test]
fn test_cobertura_simple_coverage() {
    let lines = [(1, 1), (2, 0)].iter().cloned().collect();
    let mut functions = FxHashMap::default();
    functions.insert(
        "_ZN6simple4main17h123456789abcdef0E".to_string(),
        Function { start: 1, executed: true }
    );
    let results: Vec<(PathBuf, PathBuf, CovResult)> = vec![(
        PathBuf::from("test.rs"),
        PathBuf::from("test.rs"),
        CovResult {
            lines,
            branches: BTreeMap::new(),
            functions,
        }
    )];

    let results = Box::new(results.into_iter());
    let tmp_dir = tempdir().unwrap();
    let output_file = tmp_dir.path().join("coverage.xml");

    output_cobertura(results, Some(output_file.to_str().unwrap()), false);

    let mut file = std::fs::File::open(output_file).unwrap();
    let mut content = String::new();
    file.read_to_string(&mut content).unwrap();

    assert!(content.contains(r#"lines-covered="1""#));
    assert!(content.contains(r#"lines-valid="2""#));
    assert!(content.contains(r#"line-rate="0.5""#));
}