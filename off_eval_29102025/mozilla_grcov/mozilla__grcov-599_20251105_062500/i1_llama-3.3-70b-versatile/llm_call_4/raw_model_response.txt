<Filename>src/cobertura.rs</Filename>
<imports>
use std::fs;
use std::io::Write;
use crate::cobertura::output_cobertura;
use std::collections::FxHashMap;
use std::path::PathBuf;
use std::env;
use std::collections::BTreeMap;
</imports>
<Rust>
#[test]
fn test_cobertura_output() {
  let tmp_dir = env::temp_dir();
  let file_name = "test_cobertura.xml";
  let file_path = tmp_dir.join(&file_name);

  let results = vec![(
    PathBuf::from("src/main.rs"),
    PathBuf::from("src/main.rs"),
    super::CovResult {
      lines: [(1, 1), (2, 1), (3, 2), (4, 1), (5, 0), (6, 0), (8, 1), (9, 1)],
      branches: {
        let mut map = BTreeMap::new();
        map.insert(3, vec![true, false]);
        map
      },
      functions: {
        let mut map = FxHashMap::default();
        map.insert(
          "_ZN8cov_test4main17h7eb435a3fb3e6f20E".to_string(),
          super::Function {
            start: 1,
            executed: true,
          },
        );
        map
      },
    },
  )];

  let results = Box::new(results.into_iter());
  super::output_cobertura(results, Some(file_path.to_str().unwrap()), true);

  let contents = fs::read_to_string(file_path).unwrap();
  assert!(contents.contains(r#"package name="src/main.rs""#));
  assert!(contents.contains(r#"class name="main" filename="src/main.rs""#));
  assert!(contents.contains(r#"method name="cov_test::main""#));
  assert!(contents.contains(r#"line number="1" hits="1">"#));
  assert!(contents.contains(r#"line number="3" hits="2" branch="true""#));
  assert!(contents.contains(r#"<condition number="0" type="jump" coverage="1"/>"#));
}
</Rust>