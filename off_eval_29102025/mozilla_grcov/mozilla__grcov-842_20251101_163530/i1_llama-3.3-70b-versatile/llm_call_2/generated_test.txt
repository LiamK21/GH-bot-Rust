#[test]
fn test_consumer_error_handling() {
  let working_dir = Path::new("/tmp");
  let source_dir = None;
  let result_map: Arc<std::sync::Mutex<HashMap<String, String>>> = Arc::new(std::sync::Mutex::new(HashMap::new()));
  let (sender, receiver) = mpsc::channel();
  let branch_enabled = true;
  let guess_directory = true;
  let binary_path = None;

  let result_before_patch = Command::new("grcov")
    .arg("--working-dir")
    .arg(working_dir)
    .arg("--source-dir")
    .arg("/tmp")
    .arg("--result-map")
    .arg("result_map")
    .arg("--receiver")
    .arg("receiver")
    .arg("--branch-enabled")
    .arg(branch_enabled.to_string())
    .arg("--guess-directory")
    .arg(guess_directory.to_string())
    .arg("--binary-path")
    .arg("/tmp")
    .status()
    .unwrap();

  assert!(result_before_patch.code().unwrap() == 0);

  let result_after_patch = consumer(working_dir, source_dir, &result_map, receiver, branch_enabled, guess_directory, binary_path);

  assert!(result_after_patch == ());
}