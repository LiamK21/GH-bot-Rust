#[test]
fn test_covdir_single_file() {
    let tmp_dir = tempdir().unwrap();
    let file_path = tmp_dir.path().join("output.json");

    let results = vec![
        (
            PathBuf::from("file.cpp"),
            PathBuf::from("file.cpp"),
            CovResult {
                lines: [(1u32, 1u64), (2u32, 1u64)]
                    .iter()
                    .cloned()
                    .collect(),
                branches: BTreeMap::new(),
                functions: FxHashMap::default(),
            },
        ),
    ];
    let results = Box::new(results.into_iter());

    output_covdir(results, Some(file_path.to_str().unwrap())).unwrap();

    let json_str = fs::read_to_string(&file_path).unwrap();
    let json: Value = serde_json::from_str(&json_str).unwrap();

    let expected = json!({
        "name": "",
        "linesTotal": 2,
        "linesCovered": 2,
        "linesMissed": 0,
        "coveragePercent": 100.0,
        "children": {
            "file.cpp": {
                "name": "file.cpp",
                "linesTotal": 2,
                "linesCovered": 2,
                "linesMissed": 0,
                "coveragePercent": 100.0,
                "coverage": [1i64, 1i64],
            }
        }
    });

    assert_eq!(json, expected);
}