#[test]
fn test_profraws_to_lcov_parallel_execution() {
    let profraw_paths = vec![PathBuf::from("dummy.profraw")];
    let binary_path = PathBuf::from("dummy_binary");
    let working_dir = Path::new("dummy_dir");

    fs::create_dir_all(working_dir).unwrap();
    fs::File::create(working_dir.join("dummy.profraw")).unwrap();
    fs::File::create(&binary_path).unwrap();

    let expected: Vec<Vec<u8>> = vec![vec![]];

    let actual = Arc::new(Mutex::new(Vec::new()));
    let actual_clone = Arc::clone(&actual);

    let handle = thread::spawn(move || {
        let result = profraws_to_lcov(&profraw_paths, &binary_path, &working_dir).unwrap();
        let mut actual = actual_clone.lock().unwrap();
        *actual = result;
    });

    handle.join().unwrap();

    let actual = actual.lock().unwrap().clone();
    assert_eq!(expected, actual);

    fs::remove_file(working_dir.join("dummy.profraw")).unwrap();
    fs::remove_file(&binary_path).unwrap();
    fs::remove_dir_all(working_dir).unwrap();
}