<Filename>src/main.rs</Filename>
<imports>
use super::rewrite_paths;
use std::collections::HashMap;
use std::path::PathBuf;
use globset::{GlobSet, GlobSetBuilder};
use rustc_hash::FxHashMap;
use crate::FileFilter;
use serde_json::Value;
use crate::CovResult;
use crate::CovResultMap;
use crate::CovResultIter;
</imports>
<Rust>
#[test]
fn test_rewrite_paths_with_keep_option() {
  let mut result_map: CovResultMap = FxHashMap::default();
  result_map.insert("main.rs".to_string(), CovResult::default());
  result_map.insert("foo/keep.rs".to_string(), CovResult::default());
  result_map.insert("foo/not_keep.cpp".to_string(), CovResult::default());
  let to_keep_dirs = vec!["foo/*.rs"];
  let mut to_ignore_dirs: Vec<&str> = vec![];
  let results = rewrite_paths(
    result_map,
    None,
    None,
    None,
    false,
    &mut to_ignore_dirs,
    &to_keep_dirs,
    None,
    FileFilter::default(),
  );
  let mut count = 0;
  for (abs_path, rel_path, _) in results {
    count += 1;
    assert!(abs_path.to_str().unwrap().ends_with("keep.rs"));
    assert!(rel_path.to_str().unwrap().ends_with("keep.rs"));
  }
  assert_eq!(count, 1);
}
</Rust>