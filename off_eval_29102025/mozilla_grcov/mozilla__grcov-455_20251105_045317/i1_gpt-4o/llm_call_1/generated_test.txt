#[test]
fn test_rewrite_paths_with_keep_only_option() {
    let mut result_map: FxHashMap<String, ()> = FxHashMap::default();
    result_map.insert("main.cpp".to_string(), ());
    result_map.insert("src/lib.rs".to_string(), ());
    result_map.insert("src/main.rs".to_string(), ());

    let results: Vec<_> = rewrite_paths(
        result_map,
        None,
        None,
        None,
        false,
        &mut Vec::new(),
        &vec!["src/*"],
        None,
        Default::default(),
    ).collect();

    let expected_paths: Vec<PathBuf> = vec![
        PathBuf::from("src/lib.rs"),
        PathBuf::from("src/main.rs"),
    ];

    let actual_paths: Vec<PathBuf> = results.into_iter().map(|(_, rel_path, _)| rel_path).collect();

    assert_eq!(expected_paths, actual_paths);
}