#[test]
fn test_llvm_gcno_detection() {
    let tmp_dir = tempdir().unwrap();
    let test_file_path = tmp_dir.path().join("test.gcno");
    let mut file = File::create(&test_file_path).unwrap();
    let magic: [u8; 8] = [b'o', b'n', b'c', b'g', b'*', b'2', b'0', b'4'];
    file.write_all(&magic).unwrap();

    let mut queue = WorkQueue::new();
    producer(tmp_dir.path(), &[test_file_path.to_string_lossy().to_string()], &queue, false, true);

    let work_items = queue.borrow_items().lock().unwrap();
    let found = work_items.iter().any(|item| {
        item.format == ItemFormat::GCNO && item.name == "test"
    });
    assert!(found, "Expected GCNO item with name 'test'");
}