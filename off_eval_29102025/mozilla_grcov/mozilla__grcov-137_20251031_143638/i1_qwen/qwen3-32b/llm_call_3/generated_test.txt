#[test]
fn test_llvm_gcno_detection() {
    let tmp_dir = tempdir().unwrap();
    let test_file_path = tmp_dir.path().join("test.gcno");
    let mut file = File::create(&test_file_path).unwrap();
    let magic: [u8; 8] = [b'o', b'n', b'c', b'g', b'*', b'2', b'0', b'4'];
    file.write_all(&magic).unwrap();

    let queue = WorkQueue::new();
    producer(tmp_dir.path(), &[test_file_path.to_string_lossy().to_string()], &queue, false, true);

    assert!(!queue.has_gcno_items(), "Expected at least one GCNO item");
    let expected_file = "test";
    for item in queue.get_gcno_items() {
        let item_type = item.get_item_type();
        match item_type {
            ItemType::Path(p) => {
                assert!(p.ends_with(expected_file), "Path ends with {}", expected_file);
            },
            ItemType::Buffers(b) => {
                assert!(b.stem.ends_with(expected_file), "Buffers stem ends with {}", expected_file);
            },
            _ => panic!("Unexpected ItemType"),
        }
    }
}