#[test]
fn test_overflow_logs_warning() {
    struct TestLogger {
        overflow_logged: Cell<bool>,
    }

    impl TestLogger {
        fn new() -> Self {
            Self { overflow_logged: Cell::new(false) }
        }

        fn overflow_logged(&self) -> bool {
            self.overflow_logged.get()
        }
    }

    impl log::Logger for TestLogger {
        fn enabled(&self, metadata: &log::Metadata) -> bool {
            metadata.level() <= Level::Warn
        }

        fn log(&self, record: &log::Record) {
            if record.level() == Level::Warn && record.args().to_string().contains("Execution count overflow detected.") {
                self.overflow_logged.set(true);
            }
        }

        fn flush(&self) {}
    }

    let logger = TestLogger::new();
    let results = vec![(String::from("test_file"), CovResult { execution_count: u32::MAX })];
    let warn_overflow = true;

    unsafe {
        log::set_logger(Box::new(logger.clone())).unwrap();
        log::set_max_level(LevelFilter::Warn);
        add_results(results, warn_overflow);
    }

    assert!(logger.overflow_logged(), "Execution count overflow log not found");
}