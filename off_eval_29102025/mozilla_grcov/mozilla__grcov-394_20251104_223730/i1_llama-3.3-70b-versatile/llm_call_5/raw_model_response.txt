<Filename>src/output.rs</Filename>
<imports>
use std::io::Write;
use std::fs;
use std::path::PathBuf;
use std::collections::BTreeMap;
use super::output_lcov;
use super::CovResult;
use super::CovResultIter;
use std::iter::IntoIterator;
</imports>
<Rust>
#[test]
fn test_lcov_branch_coverage() {
  let mut results = Vec::new();
  let mut map = BTreeMap::new();
  map.insert(1, vec![true, false, false, true, false, false]);
  map.insert(2, vec![false, false, false, true]);
  let cov_result = CovResult {
    lines: [(1, 10), (2, 11)].iter().cloned().collect(),
    branches: map,
    functions: std::collections::HashMap::new(),
  };
  results.push((PathBuf::from("foo/bar/a.cpp"), PathBuf::from("foo/bar/a.cpp"), cov_result));
  let results: CovResultIter = results.into_iter();
  let mut file = fs::File::create("test_lcov.info").unwrap();
  output_lcov(results, Some("test_lcov.info"));
  let contents = fs::read_to_string("test_lcov.info").unwrap();
  assert!(contents.contains("BRF:10\n"));
  assert!(contents.contains("BRH:3\n"));
  fs::remove_file("test_lcov.info").unwrap();
}
</Rust>