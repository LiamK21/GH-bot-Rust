#[test]
fn test_llvm_profiles_to_lcov_with_threads() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let tmp_path = tmp_dir.path();

    let profdata_path = tmp_path.join("grcov.profdata");
    let binary_path = tmp_path.join("binary");
    let profile_path = tmp_path.join("default.profraw");

    fs::write(&binary_path, "binary content").unwrap();
    fs::write(&profile_path, "profile content").unwrap();

    let result = llvm_profiles_to_lcov(
        &[profile_path],
        &binary_path,
        tmp_path,
        4, // Using 4 threads
    );

    assert!(result.is_ok(), "Error: {}", result.unwrap_err());
    let lcovs = result.unwrap();
    assert!(!lcovs.is_empty());
}