#[test]
fn test_resumption_token_rtt_handling() {
    let mut conn = Connection::new(Role::Client);
    let now = Instant::now();

    // Setup primary path with RTT just below INITIAL_RTT
    let initial_rtt = Duration::from_millis(100);
    let mut path = conn.paths.primary().unwrap().borrow_mut();
    path.rtt_mut().update_estimate(initial_rtt);
    path.rtt_mut().set_guesstimate(true);

    let token = conn.make_resumption_token(now);
    assert_eq!(token.rtt(), Duration::from_millis(0));

    // Setup primary path with RTT above INITIAL_RTT
    let high_rtt = Duration::from_millis(200);
    path.rtt_mut().update_estimate(high_rtt);
    path.rtt_mut().set_guesstimate(true);

    let token = conn.make_resumption_token(now);
    assert_eq!(token.rtt(), Duration::from_millis(0));

    // Setup with actual RTT
    path.rtt_mut().set_guesstimate(false);
    let actual_rtt = Duration::from_millis(150);
    path.rtt_mut().update_estimate(actual_rtt);

    let token = conn.make_resumption_token(now);
    assert_eq!(token.rtt(), actual_rtt);
}