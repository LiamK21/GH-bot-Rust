#[test]
fn test_server_response_after_migration() {
    let args = Args::from_args();
    let mut runner = ServersRunner::new(args).unwrap();

    let server_addr = runner.sockets[0].0;
    let client_socket = UdpSocket::bind("127.0.0.0:0").unwrap();

    let test_packet = Datagram::new(
        b"GET / HTTP/1.0\r\nHost: example.com\r\n\r\n".to_vec(),
        server_addr,
    )
    .unwrap();

    client_socket.send_to(&test_packet, &test_packet.destination()).unwrap();

    let response = read_dgram(&mut client_socket, &server_addr).unwrap();

    assert!(response.is_some());
    assert_eq!(response.unwrap().data.len(), 100);
}