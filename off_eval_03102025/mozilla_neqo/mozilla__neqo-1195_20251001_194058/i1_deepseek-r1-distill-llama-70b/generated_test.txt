#[test]
fn test_stream_removal_on_fin() {
    let mut client = Http3Client::new();
    let mut handler = Handler::new();

    // Initialize a stream
    let stream_id = 1;
    handler.streams.insert(stream_id, None);

    // Simulate a HeaderReady event with fin=true
    let event = Http3ClientEvent::HeaderReady {
        stream_id,
        headers: vec![],
        fin: true,
        ..
        Default::default()
    };

    handler.handle(&mut client);

    // After the patch, the stream should be removed
    assert!(!handler.streams.contains_key(&stream_id));
}