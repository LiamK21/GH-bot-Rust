#[test]
fn test_idle_timeout_expiration() {
    let mut client = Connection::new_client(
        "example.com",
        &["alpn"],
        Rc::new(RefCell::new(FixedConnectionIdManager::new(5))),
        Rc::new(RefCell::new(EmptyConnectionIdManager::new())),
        None,
    )
    .unwrap();
    let mut server = Connection::new_server(
        &["alpn"],
        Rc::new(RefCell::new(FixedConnectionIdManager::new(5))),
        Rc::new(RefCell::new(EmptyConnectionIdManager::new())),
        None,
    )
    .unwrap();
    connect(&mut client, &mut server);

    let now = Instant::now();
    let res = client.process(None, now);
    assert_eq!(res, Output::Callback(Duration::from_secs(60)));

    client.process_timer(now + Duration::from_secs(60));
    assert!(matches!(client.state(), State::Closing { .. }));
}