#[test]
fn test_persistent_congestion_detection() {
    let mut cc = CongestionControl::default();
    let now = Instant::now();
    let pto = Duration::from_millis(100);
    let persistent_cong_thresh = 3;
    let pc_period = pto * persistent_cong_thresh;

    let lost_packets = vec![
        SentPacket::new(PacketType::Short, 1, now, true, Rc::default(), 100),
        SentPacket::new(PacketType::Short, 2, now + pc_period, true, Rc::default(), 100),
    ];

    cc.on_packets_lost(now, None, pto, &lost_packets);

    assert_eq!(cc.cwnd(), super::MIN_CONG_WINDOW);
}