#[test]
fn test_send_stream_writable_event_generation() {
  let mut conn = Connection::default();
  let stream_id = conn.stream_create(0).unwrap();
  conn.flow_mgr.borrow_mut().conn_increase_max_credit(0);
  let mut send_stream = SendStream::new(stream_id, 0, conn.flow_mgr.clone(), conn.events.clone());
  send_stream.set_max_stream_data(0);
  assert_eq!(send_stream.avail(), 0);
  conn.flow_mgr.borrow_mut().conn_increase_max_credit(10);
  let evts = conn.events.events().collect::<Vec<_>>();
  assert_eq!(evts.len(), 1);
  assert!(matches!(evts[0], ConnectionEvent::SendStreamWritable{..}));
}