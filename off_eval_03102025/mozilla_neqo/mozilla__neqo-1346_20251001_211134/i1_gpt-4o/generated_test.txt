#[test]
fn test_send_arbitrary_data() {
    let args = Args::from_iter_safe(&["test"]).unwrap();
    let anti_replay = AntiReplay::new(Instant::now(), Duration::from_secs(10)).unwrap();
    let cid_mgr = Rc::new(RefCell::new(RandomConnectionIdGenerator::new(5)));
    let mut server = SimpleServer::new(&args, anti_replay, cid_mgr);

    let dgram = Datagram::new(
        SocketAddr::from_str("127.0.0.1:4433").unwrap(),
        SocketAddr::from_str("127.0.0.1:4434").unwrap(),
        vec![0; 1200],
    );

    server.process(Some(dgram), Instant::now());

    let mut events = Vec::new();
    while let Some(event) = server.server.next_event() {
        events.push(event);
    }

    let mut data_written = false;
    for event in events {
        if let Http3ServerEvent::DataWritable { .. } = event {
            data_written = true;
            break;
        }
    }

    assert!(data_written, "Server did not write data as expected");
}