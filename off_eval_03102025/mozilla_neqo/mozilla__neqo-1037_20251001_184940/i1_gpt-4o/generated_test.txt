#[test]
fn test_stream_readable_handles_partial_data() {
    let anti_replay = AntiReplay::new(Instant::now(), std::time::Duration::from_secs(10), 7, 14).unwrap();
    let cid_manager = Rc::new(RefCell::new(neqo_transport::FixedConnectionIdManager::new(10)));
    let mut server = Http09Server::new(
        Instant::now(),
        &["key"],
        &["alpn"],
        anti_replay,
        cid_manager,
    ).unwrap();

    let mut conn = ActiveConnectionRef::default();
    let stream_id = 4;
    let args = super::Args {
        qns_test: None,
        ..Default::default()
    };

    // Simulate a partial data read
    let partial_data = b"GET /partial";
    conn.borrow_mut().stream_create(stream_id, neqo_transport::StreamType::BiDi).unwrap();
    conn.borrow_mut().stream_send(stream_id, partial_data).unwrap();
    server.stream_readable(stream_id, &mut conn, &args);

    // Check that the partial data is saved
    assert!(server.read_state.contains_key(&stream_id));
}