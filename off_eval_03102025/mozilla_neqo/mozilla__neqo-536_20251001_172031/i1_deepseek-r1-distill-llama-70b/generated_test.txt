#[test]
fn test_idle_timeout_via_process_output() {
    let mut client = default_client();
    let now = Instant::now();

    // Advance time past the idle timeout
    let timeout = Duration::from_secs(30);
    let new_now = now + timeout;

    // Process output should handle the timer and close the connection
    let _output = client.process_output(new_now);

    // Verify the connection is closed
    assert!(matches!(client.state(), State::Closed(_)));
}