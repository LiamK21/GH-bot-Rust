#[test]
fn test_version_negotiation_excludes_client_version() {
    fixture_init();
    let client_version = 0x0a0a0a0a;
    let vn = PacketBuilder::version_negotiation(
        SERVER_CID,
        CLIENT_CID,
        client_version,
        &Version::all(),
    );

    // The versions are listed after the initial bytes. The VN packet has a specific structure:
    // [Packet Byte][4 Bytes Source Connection ID][4 Bytes Destination Connection ID][Versions...]
    let version_list_start = 1 + 4 + 4; // Position after source and destination CIDs
    let mut versions = Vec::new();
    for i in (version_list_start..vn.len()).step_by(4) {
        let version_bytes = &vn[i..i+4];
        versions.push(Version::from_bytes(version_bytes).unwrap());
    }

    // Convert client_version to a Version for comparison
    let client_version = Version::from_u32(client_version);

    // Ensure the client's version is not in the list of versions
    assert!(!versions.contains(&client_version));
}