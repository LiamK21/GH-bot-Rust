#[test]
fn test_abs_link_prefix() {
    let test_dir = PathBuf::from(env!("CARGO_MANIFEST_DIR")).join("tests/test_abs_link");
    let main.rs = test_dir.join("src/main.rs");
    let test.rs = test_dir.join("src/test.rs");

    // Generate HTML without abs_link_prefix
    let output_without = Command::new("cargo")
        .args(["run", "--", "--output", "target/test_without", "--no-date"])
        .current_dir(&test_dir)
        .output()
        .unwrap();

    // Generate HTML with abs_link_prefix
    let output_with = Command::new("cargo")
        .args(["run", "--", "--output", "target/test_with", "--no-date", "--abs-link-prefix", "https://example.com"])
        .current_dir(&test_dir)
        .output()
        .unwrap();

    // Check index.html without prefix
    let index_without = test_dir.join("target/test_without/index.html");
    let mut tokens = Tokenizer::new();
    tokens.feed(&std::fs::read_to_string(index_without).unwrap(), None);
    let mut hrefs = tokens.tokens()
        .filter_map(|t| match t { Token::Tag { name, .. } => Some(name.to_string()), _ => None })
        .collect::<Vec<String>>();

    // Check index.html with prefix
    let index_with = test_dir.join("target/test_with/index.html");
    let mut tokens_with = Tokenizer::new();
    tokens_with.feed(&std::fs::read_to_string(index_with).unwrap(), None);
    let mut hrefs_with = tokens_with.tokens()
        .filter_map(|t| match t { Token::Tag { name, .. } => Some(name.to_string()), _ => None })
        .collect::<Vec<String>>();

    // Verify links
    assert!(hrefs.iter().all(|h| h.starts_with("./")));
    assert!(hrefs_with.iter().all(|h| h.starts_with("https://example.com")));

    // Clean up
    std::fs::remove_dir_all(test_dir.join("target")).unwrap();
}