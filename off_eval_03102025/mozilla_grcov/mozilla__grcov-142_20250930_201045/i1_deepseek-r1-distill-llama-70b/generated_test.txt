#[test]
fn test_producer_jacoco_xml() {
    let queue: Arc<WorkQueue> = Arc::new(MsQueue::new());
    let tmp_dir = TempDir::new("grcov").expect("Failed to create temporary directory");
    let tmp_path = tmp_dir.path().to_owned();

    producer(
        &tmp_path,
        &["test/jacoco1.zip".to_string()],
        &queue,
        false,
        false,
    );

    let expected = vec![(
        ItemFormat::JACOCO_XML,
        false,
        "jacoco/basic-jacoco.xml".to_string(),
        true,
    )];

    // Verify that the queue contains the expected work items
    let mut actual = Vec::new();
    while let Ok(work_item) = queue.try_pop() {
        if let Some(item) = work_item {
            actual.push((item.format, item.name));
        }
    }

    assert_eq!(expected.len(), actual.len());
    for (expected_format, expected_name) in &expected {
        let (actual_format, actual_name) = actual.first().unwrap();
        assert_eq!(expected_format, actual_format);
        assert_eq!(expected_name, actual_name);
    }
}