#[test]
fn test_persist_ping_lifetime_data() {
  // Create a temporary directory.
  let dir = tempdir().unwrap();
  let str_dir = dir.path().display().to_string();
  // Create a new Database instance with delay_ping_lifetime_io set to true.
  let db = Database::new(&str_dir, true).unwrap();

  // Record a metric with Lifetime::Ping.
  db.record_per_lifetime(
    super::Lifetime::Ping,
    "test-storage",
    "test-metric",
    &super::Metric::String("test-value".to_string()),
  ).unwrap();

  // Check that the metric is not persisted to disk yet.
  let store: super::SingleStore = db.rkv.open_single(super::Lifetime::Ping.as_str(), super::StoreOptions::create()).unwrap();
  let reader = db.rkv.read().unwrap();
  assert!(store.get(&reader, "test-storage#test-metric").unwrap_or(None).is_none());

  // Persist the ping lifetime data to disk.
  db.persist_ping_lifetime_data().unwrap();

  // Check that the metric is now persisted to disk.
  assert!(store.get(&reader, "test-storage#test-metric").unwrap_or(None).is_some());
}