#[test]
fn test_experiment_limits_record_errors() {
    let glean = new_glean();
    let long_id = "a".repeat(1000);
    let long_branch = "b".repeat(1000);
    let long_key = "c".repeat(1000);
    let long_value = "d".repeat(10000);

    // Test experiment ID truncation
    let metric = ExperimentMetric::new(&glean, long_id.clone());
    let errors_after_new = glean.test_get_num_errors();
    assert_eq!(errors_after_new, 1);

    // Test branch, key, and value truncation
    let mut extra = HashMap::new();
    extra.insert(long_key.clone(), long_value.clone());
    metric.set_active(&glean, long_branch.clone(), Some(extra));

    let total_errors = glean.test_get_num_errors();
    assert_eq!(total_errors, 4);
}