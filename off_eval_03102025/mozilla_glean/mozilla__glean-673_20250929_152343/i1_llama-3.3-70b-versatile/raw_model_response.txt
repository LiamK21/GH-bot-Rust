<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use super::PingUploadManager;
use tempfile::TempDir;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_get_next_ping_after_processing_pings_dir() {
  let data_dir = TempDir::new().unwrap();
  let upload_manager = PingUploadManager::new(data_dir.path().to_str().unwrap());
  
  while !upload_manager.has_processed_pending_pings() {
    thread::sleep(Duration::from_millis(10));
  }
  
  assert!(upload_manager.get_next_ping().is_none());
  
  let uuid = "c0ffeec0-ffee-c0ff-eec0-ffeec0ffeec0";
  let url = "http://example.com";
  let body = serde_json::json!({});
  upload_manager.enqueue_ping(uuid, url, body);
  
  assert!(upload_manager.get_next_ping().is_some());
}
</Rust>