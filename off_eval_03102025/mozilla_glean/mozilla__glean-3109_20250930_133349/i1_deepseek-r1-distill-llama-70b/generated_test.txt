#[test]
fn test_global_glean_init_race() {
    // Simulate the race condition where initialize was called but global_glean is not set
    let was_init_called = AtomicBool::new(true);
    let global_glean = AtomicBool::new(false);

    // Set the statics to track PRE_INIT state
    unsafe {
        PRE_INIT_COLLECTION_ENABLED = None;
    }

    // Call the function under test
    glean_set_collection_enabled(true);

    // Verify that the PRE_INIT storage was used instead of the global Glean
    let pre_init_value = unsafe { PRE_INIT_COLLECTION_ENABLED };
    assert_eq!(pre_init_value, Some(true));
}