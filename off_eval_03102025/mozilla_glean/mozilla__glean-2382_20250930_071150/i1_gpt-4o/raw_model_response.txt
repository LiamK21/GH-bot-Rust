<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use super::PingUploadManager;
use crate::internal_metrics::UploadMetrics;
use crate::glean::Glean;
use crate::glean::HttpStatus;
use crate::glean::Lifetime;
use crate::metrics::CommonMetricData;
use crate::metrics::CounterMetric;
use std::collections::HashMap;
use std::sync::{Arc, Mutex};
</imports>
<Rust>
#[test]
fn test_missing_send_ids_increments_counter() {
    let glean = Glean::new();
    let upload_metrics = UploadMetrics {
        send_success: TimingDistributionMetric::new(CommonMetricData {
            name: "send_success".into(),
            category: "glean.upload".into(),
            send_in_pings: vec!["metrics".into()],
            lifetime: Lifetime::Ping,
            disabled: false,
            dynamic_label: None,
        }),
        send_failure: TimingDistributionMetric::new(CommonMetricData {
            name: "send_failure".into(),
            category: "glean.upload".into(),
            send_in_pings: vec!["metrics".into()],
            lifetime: Lifetime::Ping,
            disabled: false,
            dynamic_label: None,
        }),
        in_flight_pings_dropped: CounterMetric::new(CommonMetricData {
            name: "in_flight_pings_dropped".into(),
            category: "glean.upload".into(),
            send_in_pings: vec!["metrics".into()],
            lifetime: Lifetime::Ping,
            disabled: false,
            dynamic_label: None,
        }),
        missing_send_ids: CounterMetric::new(CommonMetricData {
            name: "missing_send_ids".into(),
            category: "glean.upload".into(),
            send_in_pings: vec!["metrics".into()],
            lifetime: Lifetime::Ping,
            disabled: false,
            dynamic_label: None,
        }),
    };

    let mut lock = Arc::new(Mutex::new(HashMap::new()));
    let mut manager = PingUploadManager {
        upload_metrics,
        lock: lock.clone(),
    };

    let document_id = "test_doc_id".to_string();
    let status = HttpStatus { code: 200 };

    {
        let mut lock = lock.lock().unwrap();
        lock.insert(document_id.clone(), None);
    }

    manager.handle_upload_result(&glean, document_id.clone(), status);

    let missing_send_ids_count = manager.upload_metrics.missing_send_ids.test_get_value(&glean, "metrics").unwrap_or(0);
    assert_eq!(missing_send_ids_count, 1);
}
</Rust>