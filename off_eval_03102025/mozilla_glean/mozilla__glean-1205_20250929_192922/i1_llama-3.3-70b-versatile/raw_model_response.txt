<Filename> glean-core/src/test/java/mozilla/telemetry/glean/pings/DeletionPingTest.kt </Filename>
<imports> 
use super::glean_initialize_for_subprocess;
use std::thread;
use std::time::Duration;
</imports>
<Rust>
#[test]
fn test_non_deletion_pings_not_uploaded_when_upload_disabled() {
  let data_path = "/tmp/glean_test_data";
  let cfg = FfiConfiguration {
    // Set upload enabled to false
    upload_enabled: false,
    data_path: data_path.to_string(),
    ..Default::default()
  };

  // Initialize Glean for subprocess with upload disabled
  glean_initialize_for_subprocess(&cfg);

  // Create a new Glean instance with upload disabled
  let mut glean = Glean::new(cfg).unwrap();

  // Enqueue a non-deletion ping
  glean.submit_ping("non_deletion_ping", None).unwrap();

  // Wait for a short duration to allow the ping to be processed
  thread::sleep(Duration::from_millis(100));

  // Verify that the non-deletion ping is not uploaded
  assert_eq!(glean.get_upload_task(), PingUploadTask::Done);
}
</Rust>