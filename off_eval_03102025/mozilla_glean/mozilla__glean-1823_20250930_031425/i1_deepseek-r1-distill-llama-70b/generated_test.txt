#[test]
fn test_concurrent_labeled_metric_insert() {
    let handle = 1;
    let label = "test_label";
    let mut handles = vec![];

    let handle = handle as u64;

    // Spawn 10 threads to test concurrency
    let mut threads = vec![];
    for _ in 0..10 {
        let handle_clone = handle;
        let label_clone = label.to_string();
        threads.push(thread::spawn(move || {
            unsafe { glean_labeled_counter_metric_get(handle_clone, FfiStr::from(&label_clone)) }
        }));
    }

    // Collect results from all threads
    for thread in threads {
        let result = thread.join().unwrap();
        handles.push(result);
    }

    // All threads should return the same handle
    let first = handles[0];
    for h in handles {
        assert_eq!(h, first);
    }
}