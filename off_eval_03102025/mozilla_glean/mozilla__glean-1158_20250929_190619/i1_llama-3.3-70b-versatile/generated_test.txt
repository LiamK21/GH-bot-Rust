#[test]
fn test_maximum_wait_attempts_is_enforced() {
  let mut upload_manager = PingUploadManager::new("test", "Testing", /* sync */ true);
  let secs_per_interval = 5;
  let max_pings_per_interval = 1;
  upload_manager.set_rate_limiter(secs_per_interval, max_pings_per_interval);

  upload_manager.enqueue_ping(&"glean", &"1".to_string(), &"path".to_string(), &"".to_string(), None);
  upload_manager.enqueue_ping(&"glean", &"2".to_string(), &"path".to_string(), &"".to_string(), None);

  let task = upload_manager.get_upload_task(&"glean", false);
  assert_eq!(task, PingUploadTask::Upload(()));

  for _ in 0..MAX_WAIT_ATTEMPTS {
    let task = upload_manager.get_upload_task(&"glean", false);
    assert_eq!(task, PingUploadTask::Wait);
  }

  let task = upload_manager.get_upload_task(&"glean", false);
  assert_eq!(task, PingUploadTask::Done);

  thread::sleep(Duration::from_secs(secs_per_interval));

  let task = upload_manager.get_upload_task(&"glean", false);
  assert_eq!(task, PingUploadTask::Upload(()));

  let task = upload_manager.get_upload_task(&"glean", false);
  assert_eq!(task, PingUploadTask::Done);
}