#[test]
fn test_url_metric_validates_and_truncates() {
  let (glean, _) = new_glean(None);
  let metric = UrlMetric::new(crate::CommonMetricData {
    name: "url_metric".into(),
    category: "test".into(),
    send_in_pings: vec!["store1".into()],
    lifetime: crate::Lifetime::Application,
    disabled: false,
    dynamic_label: None,
  });
  let long_url = "glean://".to_string() + &"a".repeat(2049);
  metric.set(&glean, long_url);
  assert!(metric.test_get_value(&glean, "store1").is_some());
  assert!(metric.test_get_num_recorded_errors(ErrorType::InvalidOverflow, None) > 0);
}