#[test]
fn test_event_metric_uses_no_extras_keys() {
    let tmp_dir = PathBuf::from(env!("CARGO_MANIFEST_DIR")).join("tests/tmp");
    fs::create_dir_all(&tmp_dir).unwrap();

    let yaml_content = r#"
        autotrack.fafo:
          event:
            type: "event"
            description: "Test event"
            metadata:
              tags:
                - "test"
            expires: "never"
    "#;

    let mut file = fs::File::create(tmp_dir.join("test_event.yaml")).unwrap();
    file.write_all(yaml_content.as_bytes()).unwrap();

    let result = generate(
        &tmp_dir,
        Some(tmp_dir.clone()),
        None,
        None,
        None,
        None,
    ).unwrap();

    let generated = result
        .get("autotrack.fafo.event")
        .unwrap()
        .rust_code
        .unwrap();

    assert!(generated.contains("NoExtraKeys"), "Generated code should use NoExtraKeys");
    assert!(!generated.contains("NoExtra"), "Generated code should not use NoExtra");
}