#[test]
fn test_vcs_branch_setting() {
    let results = vec![CovResult::default()].into_iter();

    // Test with custom branch
    let custom_branch = "custom";
    let expected_custom = json!({
        "head": {
            "id": "test_sha"
        },
        "branch": custom_branch,
        "source_files": [],
        "service_name": "",
        "service_number": "",
        "service_job_number": ""
    });

    let mut actual_custom_file = File::create("test_output_custom.json").unwrap();
    output_coveralls(
        results.clone(),
        "token",
        "",
        "",
        "",
        "test_sha",
        false,
        Some("test_output_custom.json"),
        custom_branch,
    );
    let actual_custom: Value = serde_json::from_str(&std::fs::read_to_string("test_output_custom.json").unwrap()).unwrap();

    // Test with default branch
    let expected_default = json!({
        "head": {
            "id": "test_sha"
        },
        "branch": "master",
        "source_files": [],
        "service_name": "",
        "service_number": "",
        "service_job_number": ""
    });

    let mut actual_default_file = File::create("test_output_default.json").unwrap();
    output_coveralls(
        results,
        "token",
        "",
        "",
        "",
        "test_sha",
        false,
        Some("test_output_default.json"),
        "master", // default value
    );
    let actual_default: Value = serde_json::from_str(&std::fs::read_to_string("test_output_default.json").unwrap()).unwrap();

    // Cleanup files
    std::fs::remove_file(PathBuf::from("test_output_custom.json")).unwrap();
    std::fs::remove_file(PathBuf::from("test_output_default.json")).unwrap();

    assert_eq!(actual_custom, expected_custom);
    assert_eq!(actual_default, expected_default);
}