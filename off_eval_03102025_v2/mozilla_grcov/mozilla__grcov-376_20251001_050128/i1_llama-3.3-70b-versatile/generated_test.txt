#[test]
fn test_coveralls_service_job_id_output() {
  let tmp_dir = tempdir().expect("Failed to create temporary directory");
  let file_name = "test_coveralls_service_job_id_output.json";
  let file_path = tmp_dir.path().join(&file_name);

  let results = vec![(
    PathBuf::from("foo/bar/a.cpp"),
    PathBuf::from("foo/bar/a.cpp"),
    super::CovResult {
      lines: vec![(1, 10), (2, 11)],
      branches: std::collections::BTreeMap::new(),
      functions: std::collections::HashMap::new(),
    },
  )];
  let results = Box::new(results.into_iter());
  let expected_service_job_id: &str = "100500";
  let with_function_info: bool = true;
  let parallel: bool = true;
  output_coveralls(
    results,
    "unused",
    "unused",
    "unused",
    expected_service_job_id,
    "unused",
    "unused",
    with_function_info,
    Some(file_path.to_str().unwrap()),
    "unused",
    parallel,
  );

  let json_str = fs::read_to_string(file_path).unwrap();
  let json: Value = serde_json::from_str(&json_str).unwrap();

  assert_eq!(json["service_job_id"], expected_service_job_id);
}