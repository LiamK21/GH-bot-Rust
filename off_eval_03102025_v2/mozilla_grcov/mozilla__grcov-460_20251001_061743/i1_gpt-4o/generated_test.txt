#[test]
fn test_gen_index_with_branch_coverage() {
    let global_stats = HtmlGlobalStats {
        stats: HtmlStats {
            total_lines: 100,
            covered_lines: 80,
            total_funs: 10,
            covered_funs: 8,
            total_branches: 20,
            covered_branches: 15,
        },
        dirs: std::collections::HashMap::new(),
    };
    let config = Config {
        med_limit: 75.0,
        fn_hi_limit: 90.0,
        fn_med_limit: 75.0,
        branch_hi_limit: 90.0,
        branch_med_limit: 75.0,
        date: chrono::Utc::now(),
    };
    let output_path = PathBuf::from("test_output");
    let branch_enabled = true;

    gen_index(global_stats, config, &output_path, branch_enabled);

    let index_path = output_path.join("index.html");
    let index_content = std::fs::read_to_string(index_path).expect("Failed to read index.html");

    assert!(index_content.contains("Branches"));
    assert!(index_content.contains("15 / 20"));
    assert!(index_content.contains("75.0 %"));
}