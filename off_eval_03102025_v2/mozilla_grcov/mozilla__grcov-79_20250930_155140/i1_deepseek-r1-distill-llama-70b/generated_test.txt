#[test]
fn test_lcov_output_includes_branch_coverage() {
    struct CovResult {
        functions: std::collections::HashMap<u32, bool>,
        branches: std::collections::HashMap<(u32, u32), bool>,
        lines: Vec<(u32, u32)>,
    }

    let mut results = CovResult {
        functions: std::collections::HashMap::new(),
        branches: std::collections::HashMap::new(),
        lines: Vec::new(),
    };

    // Add some sample branch data
    results.branches.insert((1, 0), true);
    results.branches.insert((2, 0), false);

    let mut writer = Cursor::new(Vec::new());
    output_lcov(&mut results.branches.clone());

    let output = writer.into_inner().into_string().unwrap();

    // Verify BRDA records
    assert!(output.contains("BRDA:1,0,0,1\n"));
    assert!(output.contains("BRDA:2,0,0,-\n"));

    // Verify BRF and BRH
    assert!(output.contains("BRF:2\n"));
    assert!(output.contains("BRH:1\n"));
}