#[test]
fn test_markdown_output() {
    let tmp_dir = tempfile::tempdir().expect("Failed to create temporary directory");
    let file_name = "test_markdown_output";
    let file_path = tmp_dir.path().join(&file_name);

    let results = vec![
        (
            PathBuf::from("foo/bar/a.cpp"),
            PathBuf::from("foo/bar/a.cpp"),
            CovResult {
                lines: [(1, 10), (2, 11)].iter().cloned().collect(),
                branches: BTreeMap::new(),
                functions: FxHashMap::default(),
            },
        ),
        (
            PathBuf::from("foo/bar/b.cpp"),
            PathBuf::from("foo/bar/b.cpp"),
            CovResult {
                lines: [(1, 0), (2, 10), (4, 10), (5, 0), (7, 0)]
                    .iter()
                    .cloned()
                    .collect(),
                branches: BTreeMap::new(),
                functions: FxHashMap::default(),
            },
        ),
    ];

    let results = Box::new(results.into_iter());
    output_markdown(results, Some(&file_path));

    let results = &read_file(&file_path);
    let expected = "| file          | coverage | covered | missed_lines |
|---------------|----------|---------|--------------|
| foo/bar/a.cpp | 100%     | 2 / 2   |              |
| foo/bar/b.cpp | 40%      | 2 / 5   | 1, 5-7       |

Total coverage: 57%
";
    assert_eq!(results, expected);
}