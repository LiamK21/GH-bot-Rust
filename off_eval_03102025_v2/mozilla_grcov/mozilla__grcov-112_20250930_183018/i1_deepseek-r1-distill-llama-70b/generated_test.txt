#[test]
fn test_output_activedata_etl_format() {
    let mut results = CovResultIter::new();
    // Add test data
    results.add_file("test_file.rs", vec![1, 2, 3]);

    let mut buffer = Vec::new();
    {
        let stdout = Cursor::new(&mut buffer);
        let mut writer = BufWriter::new(stdout.lock());
        output_activedata_etl(results);
        writer.flush().unwrap();
    }

    let output = String::from_utf8(buffer).unwrap();
    let data: Value = serde_json::from_str(&output).unwrap();

    // Verify that the "line" key is no longer present
    let file_data = data.get("file").unwrap();
    let covered = file_data.get("covered").unwrap();
    assert!(covered.is_array());
    for item in covered.as_array().unwrap() {
        assert!(item.is_number());
    }
}