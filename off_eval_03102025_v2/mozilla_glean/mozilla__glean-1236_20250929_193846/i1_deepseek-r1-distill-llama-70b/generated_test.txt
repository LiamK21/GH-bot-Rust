#[test]
fn test_pending_pings_directory_size_in_kb() {
    let temp_dir = tempdir().unwrap();
    let mut manager = PingUploadManager::new(&temp_dir.path().join("test").join("pending"));

    // Create a test file to measure directory size
    let test_file = temp_dir.path().join("test_file.txt");
    std::fs::write(&test_file, "test content").unwrap();

    // Calculate the expected size in kilobytes
    let file_size_bytes = std::fs::metadata(&test_file).unwrap().len();
    let expected_size_kb = file_size_bytes as u64 / 1024;

    // Measure the directory size
    let pending_pings_directory_size = manager.pending_pings_directory_size().unwrap();

    // Accumulate the metric
    pending_pings_directory_size.accumulate(1);

    // Get the metric value
    let metric_value = PendingPingsDirectorySizeMetric::get().unwrap();

    assert_eq!(metric_value, expected_size_kb);
}