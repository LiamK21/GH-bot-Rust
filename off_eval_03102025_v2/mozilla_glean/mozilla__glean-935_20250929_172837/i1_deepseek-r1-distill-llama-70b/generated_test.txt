#[test]
fn test_log_if_error_uses_error_level() {
    // Create a channel to receive the log record
    let (sender, receiver) = mpsc::channel();

    // Define the expected metadata
    let expected = Metadata {
        level: Level::Error,
        module_path: Some("glean::ffi::handlemap_ext"),
        file: file!(),
        line: line!(),
    };

    // Set up a logger to capture the record
    let _ = log::Logger::root(
        log::Appender::builder()
            .build(
                Box::new(move |record| {
                    sender.send(record).unwrap();
                }),
            ),
    );

    // Call the function under test with an error
    let error = ExternError::new(1, "Test error".into());
    log_if_error(error);

    // Block until the record is received
    let record = receiver.recv().unwrap();

    // Verify the log level is error
    assert_eq!(record.level(), Level::Error);
    assert_eq!(record.metadata(), &expected);
}