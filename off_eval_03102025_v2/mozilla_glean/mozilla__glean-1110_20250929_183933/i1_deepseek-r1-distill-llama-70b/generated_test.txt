#[test]
fn test_quota_enforces_pending_pings() {
    let (mut glean, tmpdir) = new_glean(None);

    // Register a ping type for testing
    let ping_type = PingType::new("test", true, true, vec![]);
    glean.register_ping_type(&ping_type);

    // Submit a ping
    glean.submit_ping(&ping_type, None).unwrap();

    // Create an UploadManager with a small quota
    let upload_manager = PingUploadManager::new(tmpdir.path(), "Rust", true);

    // Enqueue pings with a quota that's too small
    upload_manager.enqueue_cached_pings(&glean, 1);

    // Verify that the oldest pings were deleted
    assert_eq!(
        upload_manager.get_upload_task(&glean, false),
        PingUploadTask::Done
    );
}