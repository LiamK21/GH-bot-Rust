#[test]
fn test_record_with_time() {
    let event = EventMetric::new("test_event", 1);
    let timestamp = get_timestamp_ms();
    let mut extra = HashMap::new();
    extra.insert(1, "test_extra".to_string());

    event.record_with_time(timestamp, extra);

    let db = get_db_connection();
    let result = db.query("SELECT timestamp, extra FROM events WHERE event_name = 'test_event'");

    assert_eq!(result.timestamp, timestamp);
    assert_eq!(result.extra, extra);
}