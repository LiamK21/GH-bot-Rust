#[test]
fn test_setting_a_long_string_records_an_error() {
    let (glean, _) = new_glean(None);

    let metric = StringMetric::new(CommonMetricData {
        name: "string_metric".into(),
        category: "test".into(),
        send_in_pings: vec!["store1".into()],
        lifetime: Lifetime::Application,
        disabled: false,
        dynamic_label: None,
    });

    let sample_string = "0123456789".repeat(11);
    metric.set(&glean, sample_string.clone());

    let truncated = truncate_string_at_boundary(sample_string, 100);
    assert_eq!(truncated, metric.test_get_value(&glean, "store1").unwrap());

    assert_eq!(
        1,
        test_get_num_recorded_errors(&glean, metric.meta(), ErrorType::InvalidOverflow, None)
            .unwrap()
    );
}