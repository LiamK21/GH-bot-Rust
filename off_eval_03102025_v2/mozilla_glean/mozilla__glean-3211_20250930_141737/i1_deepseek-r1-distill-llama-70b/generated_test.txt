#[test]
fn test_merge_saturating() {
    let mut a = Histogram::new(LinearOrExponential::default()).unwrap();
    let mut b = Histogram::new(LinearOrExponential::default()).unwrap();

    // Test normal case
    a.accumulate(1, 1);
    b.accumulate(1, 2);
    b.accumulate(2, 3);

    let expected_sum = 1 + 4 + 6 = 11;
    let expected_count = 1 + 2 + 3 = 6;

    a.merge(&b);

    assert_eq!(a.sum, expected_sum);
    assert_eq!(a.count, expected_count);

    // Test overflow case
    let mut a = Histogram::new(LinearOrExponential::default()).unwrap();
    let mut b = Histogram::new(LinearOrExponential::default()).unwrap();

    a.accumulate(1, usize::MAX);
    b.accumulate(1, 1);

    a.merge(&b);

    // Check that sum and count are saturated but not panicking
    assert!(a.sum >= usize::MAX);
    assert!(a.count >= 1);
}