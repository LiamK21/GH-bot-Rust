#[test]
fn test_snapshot_metric_lifetime() {
  let storage = Database::new();
  let store_name = "test_store";
  let metric_id = "test_metric";
  let metric_lifetime = Lifetime::Application;
  let metric_value = Metric::Boolean(true);

  // setup test data
  storage.set store_name, metric_id, metric_value, metric_lifetime;

  // test before patch
  let snapshotter_before = |m: Option<Metric>| {
    if m.is_some() {
      assert_ne!(m, Some(metric_value));
    }
  };
  storage.iter_store_from(Lifetime::Ping, store_name, None, &mut snapshotter_before);
  storage.iter_store_from(Lifetime::Application, store_name, None, &mut snapshotter_before);
  storage.iter_store_from(Lifetime::User, store_name, None, &mut snapshotter_before);

  // apply patch
  let actual = StorageManager::snapshot_metric(storage, store_name, metric_id, metric_lifetime);

  // test after patch
  assert_eq!(actual, Some(metric_value));
}