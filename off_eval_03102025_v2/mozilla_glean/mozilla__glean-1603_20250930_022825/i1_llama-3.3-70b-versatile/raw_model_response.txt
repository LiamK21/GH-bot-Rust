<Filename> glean-core/rlb/src/private/event.rs </Filename>
<imports> 
use glean_core::traits::ExtraKeys;
use glean_core::traits::Event;
use std::collections::HashMap;
</imports>
<Rust>
#[test]
fn test_event_metric_record() {
  #[derive(Default, Debug, Clone, Hash, Eq, PartialEq)]
  struct SomeExtra {
      key1: Option<String>,
      key2: Option<String>,
  }

  impl glean_core::traits::ExtraKeys for SomeExtra {
      const ALLOWED_KEYS: &'static [&'static str] = &["key1", "key2"];

      fn into_ffi_extra(self) -> HashMap<i32, String> {
          let mut map = HashMap::new();
          self.key1.and_then(|key1| map.insert(0, key1));
          self.key2.and_then(|key2| map.insert(1, key2));
          map
      }
  }

  let metric = super::EventMetric::new("test_metric");
  let extra = SomeExtra {
      key1: Some("value1".into()),
      key2: Some("value2".into()),
  };

  let expected = HashMap::from([(0, "value1".into()), (1, "value2".into())]);
  let actual = extra.into_ffi_extra();
  assert_eq!(expected, actual);

  metric.record(Some(extra));
}
</Rust>