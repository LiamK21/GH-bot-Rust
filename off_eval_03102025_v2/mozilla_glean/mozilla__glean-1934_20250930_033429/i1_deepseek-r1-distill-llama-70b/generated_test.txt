#[test]
fn test_destroy_glean_before_init() -> Result<(), Box<dyn std::error::Error>> {
    // Use a static atomic bool to check if initialization was called
    static INIT_CALLED: AtomicBool = AtomicBool::new(false);

    // Spawn a thread to call initialize
    let handle = thread::spawn({
        let init_called = &INIT_CALLED;
        move || {
            initialize(Configuration::default(), ClientInfoMetrics::default());
            init_called.store(true, Ordering::SeqCst);
        }
    });

    // Immediately call destroy_glean on the main thread
    destroy_glean(true);

    // Wait for the thread to finish
    handle.join().unwrap();

    // Check if initialize was actually called
    assert!(INIT_CALLED.load(Ordering::SeqCst), "initialize should have been called");

    Ok(())
}