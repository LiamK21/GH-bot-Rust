#[test]
fn test_in_flight_pings_dropped() {
    let metrics = UploadMetrics::new();
    let mut manager = PingUploadManager::new(&metrics);

    // First attempt to enqueue a ping
    manager.enqueue("test_doc".into(), "test_path".into());

    // Second attempt should trigger the metric
    manager.enqueue("test_doc".into(), "test_path".into());

    // Verify the metric was incremented
    assert_eq!(metrics.in_flight_pings_dropped.get(), 1);
}