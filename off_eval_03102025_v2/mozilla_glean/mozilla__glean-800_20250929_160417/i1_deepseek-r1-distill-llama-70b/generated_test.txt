#[test]
fn test_global_glean_initialization() {
    // Test that global_glean returns None when not initialized
    assert!(global_glean().is_none());

    // Test that with_glean returns NotInitialized error
    let result: Result<()> = with_glean(|_| {});
    assert_eq!(result.unwrap_err().kind, ErrorKind::NotInitialized);

    // Test that with_glean_mut returns NotInitialized error
    let result: Result<()> = with_glean_mut(|_| {});
    assert_eq!(result.unwrap_err().kind, ErrorKind::NotInitialized);

    // Initialize global Glean
    let glean = Glean::new();
    setup_glean(glean).unwrap();

    // Test that global_glean returns Some after initialization
    let glean_obj = global_glean().expect("Global Glean should be initialized");
    let lock = glean_obj.lock().unwrap();

    // Test that with_glean works after initialization
    let result: Result<()> = with_glean(|g| {
        assert_eq!(g, &lock);
    });
    assert!(result.is_ok());
}