#[test]
fn test_process_ping_upload_response_no_op() {
    let temp_dir = TempDir::new().unwrap();
    let (mut glean, _dir) = {
        let mut glean = Glean::new();
        glean.initialize(PendingPingsDirectory::new(temp_dir.path().join("pending")))
            .unwrap();
        (glean, temp_dir)
    };

    let ping_type = PingType::new("test", true, true, vec![]);
    glean.register_ping_type(&ping_type).unwrap();
    glean.submit_ping(&ping_type, None).unwrap();

    let upload_manager = PingUploadManager::new(temp_dir.path());
    let mut upload_task = upload_manager.get_upload_task();

    while upload_task == PingUploadTask::Wait {
        std::thread::sleep(std::time::Duration::from_millis(10));
        upload_task = upload_manager.get_upload_task();
    }

    match upload_task {
        PingUploadTask::Upload(request) => {
            let uuid = request.uuid;
            glean_process_ping_upload_response(
                PingUploadTask::Upload(request),
                UPLOAD_RESULT_RECOVERABLE,
            );
            assert!(!temp_dir.path().join(uuid).exists());
        }
        _ => panic!("Expected an upload task"),
    }
}