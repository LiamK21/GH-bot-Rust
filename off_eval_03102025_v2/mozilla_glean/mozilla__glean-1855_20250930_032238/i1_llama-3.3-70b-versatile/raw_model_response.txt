<Filename> glean-core/uniffi/src/lib.rs </Filename>
<imports> 
use super::glean_initialize;
use std::sync::Once;
use std::sync::atomic::{AtomicBool, Ordering};
use glean_core::uniffi::src::core::Glean;
static INITIALIZE_CALLED: AtomicBool = AtomicBool::new(false);
</imports>
<Rust>
#[test]
fn test_glean_initialize_not_called_twice() {
  let mut initialize_called = false;
  let client_info = super::ClientInfoMetrics{ 
    app_build: "test".to_string(), 
    app_display_version: "test".to_string(), 
    architecture: "test".to_string(), 
    os_version: "test".to_string(), 
    channel: None, 
    android_sdk_version: None, 
    device_manufacturer: None, 
    device_model: None, 
    locale: None 
  };
  let internal_config = super::InternalConfiguration { upload_enabled: true };

  let _ = std::panic::catch_unwind(|| {
    glean_initialize(internal_config.clone(), client_info, Box::new(EmptyGleanEvent {}));
  });
  initialize_called = true;
  
  let result = std::panic::catch_unwind(|| {
    glean_initialize(internal_config, client_info, Box::new(EmptyGleanEvent {}));
  });
  
  assert!(initialize_called);
  assert!(result.is_err());
}

struct EmptyGleanEvent {}

impl super::OnGleanEvents for EmptyGleanEvent {
  fn on_initialize_finished(&self) {}
  fn trigger_upload(&self) {}
  fn start_metric_ping_scheduler(&self) {}
}
</Rust>