#[test]
fn test_metrics_enabled_config_inverts_correctly() {
    // Initialize a new Glean instance
    let glean = Glean::new(
        "test_metrics_enabled_config_inverts_correctly".to_string(),
        "0".to_string(),
        false,
        None,
        None,
        None,
        None,
    );

    // Create a test metric
    let metric = StringMetric::new(
        "test_category".to_string(),
        "test_metric".to_string(),
        "test_description".to_string(),
        "test".to_string(),
        None,
        None,
        AtomicBool::new(false),
    );

    // Set the metric to be enabled by default
    let mut expected = true;
    metric.set_enabled(expected).unwrap();

    // Apply a configuration that sets the metric to false, which should disable it
    let config = json!({
        "test_category.test_metric": false
    })
    .to_string();
    glean.set_metrics_enabled_config(MetricsEnabledConfig::try_from(config).unwrap());

    // The metric should now be disabled due to inversion
    let actual = metric.enabled.load();
    assert_eq!(expected, !actual, "The metric should be disabled after inversion");
}