#[test]
fn test_uploader_capabilities_included_in_ping() {
    let mut ping = Ping::new();
    ping.uploader_capabilities = vec!["test_capability".to_string()];

    // Add some metrics to ensure metrics_data is present
    ping.add_metric("test_metric", json!(true));

    let built_ping = ping.build();

    let expected = json!({
        "string_list": {
            "glean.ping.uploader_capabilities": ["test_capability"]
        }
    });

    let actual_metrics = built_ping.metrics.as_ref().unwrap();
    assert!(
        actual_metrics.get("string_list").unwrap() == expected.as_object().unwrap(),
        "Uploader capabilities metric not found or incorrect"
    );
}