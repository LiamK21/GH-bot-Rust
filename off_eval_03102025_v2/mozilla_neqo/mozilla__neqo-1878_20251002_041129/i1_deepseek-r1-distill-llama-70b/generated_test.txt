#[test]
fn test_qns_test_response() {
    let args = Args {
        shared: SharedArgs {
            qns_test: Some("test".to_string()),
            ..Default::default()
        },
        ..Default::default()
    };

    let anti_replay = AntiReplay::new(Instant::now(), 100, 7, 14).unwrap();
    let cid_mgr = Rc::new(RefCell::new(RandomConnectionIdGenerator::new(10)));

    let mut server = http09::HttpServer::new(&args, anti_replay, cid_mgr).unwrap();

    let request = b"GET / HTTP/1.1\r\nHost: example.com\r\n\r\n";
    let mut conn = ActiveConnectionRef::new(&mut server.server);
    conn.send(request).unwrap();

    let response = conn.recv().unwrap();
    assert!(response.starts_with("HTTP/1.1 200 OK"));
}