#[test]
fn test_send_ignore_emsgsize() {
    let sender = Socket::new(UdpSocket::bind("127.0.0.1:0").unwrap()).unwrap();
    let receiver = Socket::new(UdpSocket::bind("127.0.0.1:0").unwrap()).unwrap();
    let receiver_addr: SocketAddr = receiver.inner.local_addr().unwrap();

    let oversized_datagram = Datagram::new(
        sender.inner.local_addr().unwrap(),
        receiver.inner.local_addr().unwrap(),
        vec![0u8; 65536],
    );

    // Attempt to send an oversized datagram and expect it to be ignored.
    let send_result = sender.send(&oversized_datagram);
    assert!(send_result.is_ok());

    // Now send a normal datagram to ensure that the socket is still usable.
    let normal_datagram = Datagram::new(
        sender.inner.local_addr().unwrap(),
        receiver.inner.local_addr().unwrap(),
        b"Hello World!".to_vec(),
    );
    sender.send(&normal_datagram).unwrap();

    let mut recv_buf = RecvBuf::new();
    receiver.inner.set_nonblocking(false).unwrap();
    let mut received_datagram = receiver.recv(receiver_addr, &mut recv_buf).unwrap();
    assert_eq!(
        received_datagram.next().unwrap().as_ref(),
        b"Hello World!"
    );
}