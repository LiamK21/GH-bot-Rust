#[test]
fn test_datagram_tos_non_blocking() {
  let sender = Socket::new(UdpSocket::bind("127.0.0.1:0").unwrap()).unwrap();
  let receiver = Socket::new(UdpSocket::bind("127.0.0.1:0").unwrap()).unwrap();
  let receiver_addr: SocketAddr = "127.0.0.1:0".parse().unwrap();
  let datagram = vec![1, 2, 3];
  sender.inner.set_nonblocking(true).unwrap();
  let result = std::net::UdpSocket::send_to(&sender.inner, &datagram, &receiver_addr);
  assert!(result.is_err());
  assert_eq!(result.unwrap_err().kind(), io::ErrorKind::WouldBlock);
}