#[test]
fn test_remember_sent_packets_after_loss() {
    let mut lr = LossRecovery::new(PNSpace::ApplicationData);
    let sent_packet = SentPacket {
        ack_eliciting: true,
        time_sent: Instant::now() - Duration::from_millis(100),
        tokens: Vec::new(),
        time_declared_lost: None,
    };
    let mut sent_packets = BTreeMap::new();
    sent_packets.insert(0, sent_packet);
    lr.spaces[PNSpace::ApplicationData].sent_packets = sent_packets;

    let now = Instant::now();
    let lost_pns = lr.detect_lost_packets(PNSpace::ApplicationData, now);
    assert!(lr.spaces[PNSpace::ApplicationData].sent_packets.contains_key(&0));

    // Advance time by 2 RTTs (assuming RTT is 100ms)
    let later = now + Duration::from_millis(200);
    let really_lost_pns = lr.detect_lost_packets(PNSpace::ApplicationData, later);
    assert!(!lr.spaces[PNSpace::ApplicationData].sent_packets.contains_key(&0));
}