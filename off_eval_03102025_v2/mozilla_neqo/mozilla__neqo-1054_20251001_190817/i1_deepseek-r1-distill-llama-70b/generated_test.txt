#[test]
fn test_truncate_long_close_reason() {
    let mut conn = Connection::new();
    let long_reason = String::from_utf8([0x61; 2048].to_vec()).unwrap();
    conn.close(&SystemTime::now(), Error::HttpGeneralProtocol.code(), long_reason);
    let _output = conn.process(None, &SystemTime::now());
    // The encoded reason should be truncated to 256 bytes or less.
    // Implementation-specific assertion about the output buffer.
    // (Note: Exact assertion may vary based on internal details.)
    assert!(conn.output_buffer().len() <= 2048);
}