#[test]
fn test_event_handling_after_borrow_refactor() {
    let mut conn = Http3Connection::new_client(
        Connection::default(),
        None,
        None,
        None,
        None,
        None,
    )
    .unwrap();

    let before_events = conn.events();
    assert!(before_events.is_empty());

    conn.state = Http3State::Initializing;
    let result = conn.initialize_http3_connection(Instant::now());
    assert!(result.is_ok());

    let after_events = conn.events();
    assert!(!after_events.is_empty());
}