<Filename>neqo-http3/src/connection.rs</Filename>
<imports>
use super::Http3Connection;
use crate::Http3State;
use crate::events::Http3Event;
use std::collections::BTreeSet;
use neqo_transport::State;
use std::time::Instant;
</imports>
<Rust>
#[test]
fn test_events_refcounting() {
    let mut conn = Http3Connection::new(/* parameters as needed */);
    let now = Instant::now();

    // Simulate the connection state change to trigger events
    conn.state = Http3State::Initializing;
    conn.conn.set_state(State::Connected);
    conn.process_http3(now);

    // Expected events after the state change
    let expected_events: BTreeSet<Http3Event> = vec![Http3Event::ConnectionConnected].into_iter().collect();

    // Get actual events
    let actual_events: BTreeSet<Http3Event> = conn.events().into_iter().collect();

    // Compare expected and actual events
    assert_eq!(expected_events, actual_events);
}
</Rust>