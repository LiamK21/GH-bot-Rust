#[test]
fn test_encoder_respects_pmtu() {
    let mut conn = Connection::new(1000); // PMTU set to 1000
    let mut encoder = Encoder::new();

    // Write data to encoder until it reaches PMTU
    for i in 0..100 {
        let data = format!("data{}", i).as_bytes().to_vec();
        encoder.write(&data);
        if encoder.len() >= conn.pmtu() {
            break;
        }
    }

    assert!(encoder.len() <= conn.pmtu());
}