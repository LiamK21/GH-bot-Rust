#[test]
fn test_range_tracker_extend_final_range() {
    let mut tracker = RangeTracker::default();

    // Add first range: 0-100, Marked
    tracker.add_range(0, 100, RangeState::Marked);

    // Add second range: 100-150, Marked
    tracker.add_range(100, 50, RangeState::Marked);

    // Verify that there are 2 ranges
    assert_eq!(tracker.used.len(), 2);

    // Add third range: 150-175, which should extend the second range
    tracker.add_range(150, 25, RangeState::Marked);

    // The used map should still have 2 ranges because it was extended
    assert_eq!(tracker.used.len(), 2);

    // Check the first unmarked range
    let (start, len) = tracker.first_unmarked_range();
    assert_eq!(start, 175);
    assert_eq!(len, None);
}