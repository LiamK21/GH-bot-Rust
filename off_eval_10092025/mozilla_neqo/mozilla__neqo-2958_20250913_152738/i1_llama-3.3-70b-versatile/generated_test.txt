#[test]
fn test_disable_random() {
  let grease = true;
  let mut agent = SecretAgent::new().unwrap();
  let options_before = agent.get_options().unwrap();
  let _ = agent.set_option(ssl::Opt::Grease, grease);
  let _ = agent.set_option(ssl::Opt::EnableChExtensionPermutation, true);
  let options_after_enable = agent.get_options().unwrap();

  let mut agent_disable_random = SecretAgent::new().unwrap();
  let _ = agent_disable_random.set_option(ssl::Opt::Grease, grease);
  let _ = agent_disable_random.set_option(ssl::Opt::EnableChExtensionPermutation, true);
  cfg!(feature = "disable-random");
  let options_after_disable_random = agent_disable_random.get_options().unwrap();

  assert_ne!(options_before, options_after_enable);
  assert_eq!(options_after_enable.get(ssl::Opt::Grease).unwrap(), &grease);
  assert_eq!(options_after_enable.get(ssl::Opt::EnableChExtensionPermutation).unwrap(), &true);
  assert_ne!(options_after_enable, options_after_disable_random);
  assert_eq!(options_after_disable_random.get(ssl::Opt::Grease).unwrap(), &false);
  assert_eq!(options_after_disable_random.get(ssl::Opt::EnableChExtensionPermutation).unwrap(), &false);
}