#[test]
fn test_resumption_token_handling() {
    let mut client = Connection::new();
    let mut handler = old::Handler::new();

    // Simulate processing events until handler indicates it's done
    let handler_done = handler.handle(&mut client).unwrap();
    assert!(handler_done, "Handler should indicate it's done when streams are empty and URL queue is empty");

    // Check if the client is in a closed state
    let state = client.state();
    if let State::Closed(..) = state {
        // If closed, check if the resumption token is correctly returned
        let token = handler.token.take();
        assert!(token.is_some(), "Resumption token should be present");
    } else {
        assert!(false, "Client should be in closed state");
    }
}