<Filename> neqo-server/src/old_https.rs </Filename>
<imports> 
use super::Http09Server;
use neqo_common::event::Provider;
use neqo_transport::{ActiveConnectionRef, Connection, ConnectionEvent, ConnectionIdManager, Datagram, Output, State};
use neqo_crypto::{AllowZeroRtt, AntiReplay, Cipher};
use std::time::Instant;
</imports>
<Rust>
#[test]
fn test_stream_readable() {
  let mut server = Http09Server::new(Instant::now(), &[""], &[""], AntiReplay::new(Instant::now(), std::time::Duration::from_secs(10), 7, 14).unwrap(), Rc::new(RefCell::new(ConnectionIdManager::new(10))));
  let mut conn = Connection::new_server(Instant::now(), &[""], &[""], AntiReplay::new(Instant::now(), std::time::Duration::from_secs(10), 7, 14).unwrap(), Rc::new(RefCell::new(ConnectionIdManager::new(10))));
  let data = b"GET / HTTP/1.1\r\nHost: example.com\r\n\r\n";
  let dgram = Datagram::new("127.0.0.1:443".parse().unwrap(), "127.0.0.1:80".parse().unwrap(), data);
  server.process(Some(dgram), Instant::now());
  let mut expected = false;
  for event in conn.next_events() {
    match event {
        ConnectionEvent::NewStream { stream_id } => {
            server.stream_readable(stream_id.as_u64(), &mut conn, &super::Args{use_old_http: true, ..Default::default()});
            expected = true;
        },
        _ => {}
    }
  }
  assert!(expected);
}
</Rust>