#[test]
fn test_partial_request_handling() {
    let local_addr: SocketAddr = "[::1]:0".parse().unwrap();
    let mut socket = UdpSocket::bind(local_addr).unwrap();
    let client = Http3Client::new();
    let handler = Handler::new();

    // Simulate a partial request
    let partial_request = b"GET /".to_vec();
    let full_request = b"GET / HTTP/1.0\r\nHost: example.com\r\n".to_vec();

    // Send the first part of the request
    process_loop(&local_addr, &socket, &mut client, &mut handler).unwrap();

    // Wait for the server to process the partial request
    std::thread::sleep(Duration::from_millis(100));

    // Send the second part of the request
    process_loop(&local_addr, &socket, &mut client, &mut handler).unwrap();

    // Check that the server responded correctly
    let expected_response = b"HTTP/1.1 200 OK\r\n\r\nHello World";
    let actual_response = handler.get_output().unwrap();
    assert!(actual_response.starts_with(expected_response));
}