<Filename>neqo-transport/src/send_stream.rs</Filename>
<imports>
use super::SendStream;
use super::FlowMgr;
use super::Frame;
use std::cell::RefCell;
use std::rc::Rc;
</imports>
<Rust>
#[test]
fn test_data_blocked_sent_once() {
    let flow_mgr = Rc::new(RefCell::new(FlowMgr::new()));
    let mut s = SendStream::new(2, Rc::clone(&flow_mgr));

    // Simulate sending data that uses up all available credit
    assert_eq!(s.send(b"abc").unwrap(), 2);
    assert_eq!(s.next_bytes(), Some((0, &b"ab"[..])));
    assert!(flow_mgr.borrow_mut().next().is_none());

    // Mark as sent to trigger the blocked condition
    s.mark_as_sent(0, 2, false);
    assert_eq!(
        flow_mgr.borrow_mut().next().unwrap(),
        Frame::StreamDataBlocked {
            stream_id: 2,
            limit: 2
        }
    );

    // Ensure no additional DataBlocked frames are sent
    assert!(flow_mgr.borrow_mut().next().is_none());
}
</Rust>