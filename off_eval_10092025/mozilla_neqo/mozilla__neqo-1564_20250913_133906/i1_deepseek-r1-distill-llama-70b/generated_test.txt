#[test]
fn test_download_handler_closes_stream() {
    struct TestClient {
        called: bool,
        stream_id: StreamId,
    }

    impl TestClient {
        fn new() -> Self {
            Self {
                called: false,
                stream_id: StreamId::default(),
            }
        }
    }

    impl Http3Client for TestClient {
        fn stream_close_send(&mut self, stream_id: StreamId) -> Result<()> {
            self.called = true;
            self.stream_id = stream_id;
            Ok(())
        }
    }

    let mut client = TestClient::new();
    let stream_id = StreamId::from(1);
    let url = Url::parse("http://example.com").unwrap();
    let args = Args::default();
    let mut all_paths = Vec::new();

    let _handler = StreamHandlerType::create_stream_handler(
        StreamHandlerType::Download,
        &url,
        &args,
        &mut all_paths,
        &mut client,
        stream_id,
    );

    assert!(client.called);
    assert_eq!(client.stream_id, stream_id);
}