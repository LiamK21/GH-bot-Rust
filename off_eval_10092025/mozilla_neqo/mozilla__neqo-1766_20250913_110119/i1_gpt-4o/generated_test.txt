#[test]
fn test_stats_printed_on_close() {
    struct MockClient {
        closed: bool,
        stats_called: bool,
    }

    impl Client for MockClient {
        fn fetch<S>(&mut self, _url: S) where S: AsRef<str> + std::fmt::Display {}
        fn fetch_with_data<S>(&mut self, _url: S, _data: Vec<u8>) where S: AsRef<str> + std::fmt::Display {}
        fn close(&mut self, _now: std::time::Instant, _app_error: u64, _msg: &str) {}
        fn is_closed(&self) -> bool { self.closed }
        fn stats(&self) -> Stats {
            self.stats_called = true;
            Stats::default()
        }
    }

    let mut client = MockClient { closed: true, stats_called: false };
    let args = Args { stats: true, ..Default::default() };
    let mut runner = Runner { client: &mut client, args, handler: None };

    runner.client.is_closed();
    assert!(client.stats_called, "Stats should be called when connection is closed and stats flag is true.");
}