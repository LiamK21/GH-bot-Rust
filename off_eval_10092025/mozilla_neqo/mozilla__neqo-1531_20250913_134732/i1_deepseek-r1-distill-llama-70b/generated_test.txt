#[test]
fn test_server_version_information_failed() {
    struct MockQlog {
        data: Option<qlog::EventData>,
    }

    impl MockQlog {
        fn new() -> Self {
            Self { data: None }
        }
    }

    impl NeqoQlog for MockQlog {
        fn add_event_data(&mut self, data: impl Fn() -> Option<qlog::EventData>) {
            self.data = data();
        }
    }

    let mut qlog = MockQlog::new();
    let server_versions = [
        Version::from_wire_version(WireVersion::from(0x01)).unwrap(),
        Version::from_wire_version(WireVersion::from(0x02)).unwrap(),
    ];
    let client_version = WireVersion::from(0x03);

    server_version_information_failed(&mut qlog, &server_versions, client_version);

    let expected_event = qlog::EventData::VersionInformation(qlog::VersionInformation {
        client_versions: Some(vec![format!("{:02x}", client_version)]),
        server_versions: Some(server_versions.iter()
            .map(|v| format!("{:02x}", v.wire_version()))
            .collect()),
        chosen_version: None,
    });

    assert_eq!(qlog.data, Some(expected_event));
}