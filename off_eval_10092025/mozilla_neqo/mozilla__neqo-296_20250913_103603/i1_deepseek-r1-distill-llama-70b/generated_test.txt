#[test]
fn test_zero_rtt_rejected_cannot_send_data() {
    let mut client = Connection::new_client("localhost".into(), &["hq-22"]);
    let mut server = Connection::new_server(&["hq-22"]);

    // Simulate initial handshake and 0-RTT rejection
    let client_init = client.process(None, 0);
    let server_init = server.process(client_init.dgram(), 0);
    let client_hs = client.process(server_init.dgram(), 0);

    // Verify 0-RTT is rejected
    assert!(client.events().any(|e| matches!(e, ConnectionEvent::ZeroRttRejected)));

    // Attempt to send data after rejection
    let stream_id = client.stream_create(super::StreamType::BiDi).unwrap();
    let result = client.stream_send(stream_id, &[1, 2, 3]);
    assert!(result.is_err());

    // Verify no data is sent
    let client_out = client.process(None, 0);
    assert!(client_out.as_dgram_ref().is_none());
}