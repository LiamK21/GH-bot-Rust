#[test]
fn test_datagram_priority() {
    let mut connection = Connection::new();
    let mut builder = Builder::new();
    let mut tokens = Tokens::new();
    let mut frame_stats = FrameStats::new();

    // Simulate a full builder to test priority handling
    builder.set_full(false);

    // Call the function under test
    connection.write_frames(&mut builder, &mut tokens, &mut frame_stats);

    // Check that datagrams are sent after critical and important priorities
    assert!(builder.contains_priority(TransmissionPriority::Critical));
    assert!(builder.contains_priority(TransmissionPriority::Important));
    assert!(!builder.contains_priority(TransmissionPriority::Normal));
}