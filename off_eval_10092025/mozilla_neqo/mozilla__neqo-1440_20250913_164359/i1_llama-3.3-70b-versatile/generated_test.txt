#[test]
fn test_datagram_priority() {
  let mut connection = Connection::new();
  let builder = connection.get_builder();
  let tokens = connection.get_tokens();
  let mut frame_stats = connection.get_frame_stats();

  connection.streams.write_frames(TransmissionPriority::Critical, builder, tokens, &mut frame_stats);
  if builder.is_full() {
    return;
  }

  let datagram_sent = connection.datagrams.write_frames(builder, tokens, &mut frame_stats);
  assert!(datagram_sent == 0);

  connection.streams.write_frames(TransmissionPriority::Normal, builder, tokens, &mut frame_stats);
}