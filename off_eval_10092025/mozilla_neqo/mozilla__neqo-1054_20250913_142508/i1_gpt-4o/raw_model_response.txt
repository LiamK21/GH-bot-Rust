<Filename>neqo-transport/src/connection/mod.rs</Filename>
<imports>
use super::Connection;
use super::Error;
use super::CloseError;
use super::now;
use super::builder::PacketBuilder;
</imports>
<Rust>
#[test]
fn test_client_close_with_long_reason_string() {
    let mut builder = PacketBuilder::new();
    let mut client = Connection::new();
    let long_reason = String::from_utf8([0x61; 2048].to_vec()).unwrap();
    client.close(now(), Error::HttpGeneralProtocol.code(), long_reason.clone());
    let reason_len = std::cmp::min(std::cmp::min(long_reason.len(), 256), builder.remaining() - 2);
    builder.encode_vvec(&long_reason[..reason_len]);
    assert_eq!(builder.encoded_len(), reason_len + 2);
}
</Rust>