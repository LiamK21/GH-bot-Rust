#[test]
fn test_socket_send_with_reference() {
    let rt = Runtime::new().unwrap();
    rt.block_on(async {
        let sender_addr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), 0);
        let receiver_addr = SocketAddr::new(Ipv4Addr::LOCALHOST.into(), 0);

        let sender_socket = UdpSocket::bind(sender_addr).await.unwrap();
        let receiver_socket = UdpSocket::bind(receiver_addr).await.unwrap();

        let sender = Socket::new(sender_socket);
        let receiver = Socket::new(receiver_socket);

        let data = vec![1, 2, 3, 4];
        let datagram = Datagram::new(sender_addr, receiver_addr, data.clone());

        sender.writable().await.unwrap();
        sender.send(&datagram).unwrap();

        receiver.readable().await.unwrap();
        let mut buf = [0; 1024];
        let (len, _) = receiver.socket.recv_from(&mut buf).await.unwrap();

        assert_eq!(&buf[..len], &data[..]);
    });
}