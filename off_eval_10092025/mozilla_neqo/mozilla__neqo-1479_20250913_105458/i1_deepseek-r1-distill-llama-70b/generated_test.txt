#[test]
fn test_multiple_ack_ranges_cwnd() {
    let mut cc = ClassicCongestionControl::new(super::NewReno::default());
    let mut now = std::time::Instant::now();
    let mut next_pn = 0;

    // Send 10 packets
    let mut sent_packets = Vec::new();
    for _ in 0..10 {
        let p = SentPacket::new(
            PacketType::Short,
            next_pn,
            now,
            true,
            Vec::new(),
            MAX_DATAGRAM_SIZE,
        );
        next_pn += 1;
        cc.on_packet_sent(&p);
        sent_packets.push(p);
    }

    // First ACK range covering packets 0-4
    now += Duration::from_secs(1);
    cc.on_packets_acked(&sent_packets[0..5].to_vec(), Duration::from_secs(1), now);
    assert_eq!(cc.congestion_window, (5 + 1) * MAX_DATAGRAM_SIZE);

    // Second ACK range covering packets 5-9
    now += Duration::from_secs(1);
    cc.on_packets_acked(&sent_packets[5..10].to_vec(), Duration::from_secs(1), now);
    assert_eq!(cc.congestion_window, (10 + 1) * MAX_DATAGRAM_SIZE);

    // Ensure only the first 5 packets counted towards cwnd
    assert_eq!(cc.acked_bytes, 0);
}