#[test]
fn test_cwnd_increase_after_app_limited() {
  let mut cc = ClassicCongestionControl::new(NewReno::default());
  let cwnd = cc.congestion_window;
  let mut now = std::time::Instant::now();
  let mut next_pn = 0;
  let mut pkts = Vec::new();

  // simulate packet bursts below app_limit
  for _ in 0..5 {
    let p = SentPacket::new(
      crate::packet::PacketType::Short,
      next_pn,           // pn
      now,               // time sent
      true,              // ack eliciting
      Vec::new(),        // tokens
      1200, // size
    );
    next_pn += 1;
    cc.on_packet_sent(&p);
    pkts.push(p);
  }

  now += Duration::from_millis(100);
  for (i, pkt) in pkts.into_iter().enumerate() {
    cc.on_packets_acked(&[pkt], Duration::from_millis(100), now);
    assert_eq!(cc.bytes_in_flight(), (5 - i - 1) * 1200);
    if i == 4 {
      assert_eq!(cc.congestion_window, cwnd + 1200);
    }
  }
}