#[test]
fn test_recv_buffer() -> Result<(), io::Error> {
    let sender = Socket::bind("127.0.0.1:0")?;
    let receiver_addr: SocketAddr = "127.0.0.1:0".parse().unwrap();
    let mut receiver = Socket::bind(receiver_addr)?;

    let test_data = b"test_data";
    sender.send(&receiver_addr, test_data, 0, None)?;

    let received = receiver.recv(&receiver_addr)?;

    assert!(received.is_some(), "Should receive data");
    let datagram = received.unwrap();
    let received_data = datagram.d.as_slice();
    assert_eq!(received_data, test_data, "Received data should match sent data");

    Ok(())
}