<Filename>neqo-transport/src/recovery.rs</Filename>
<imports>
use super::LossRecovery;
use std::time::{Duration, Instant};
use crate::recovery::{SentPacket, RecoveryToken, PNSpace};
</imports>
<Rust>
#[test]
fn test_packet_removal_after_2rtt() {
    let mut loss_recovery = LossRecovery::default();
    let now = Instant::now();
    let pn_space = PNSpace::ApplicationData;
    let rtt = Duration::from_millis(100);

    // Simulate sending a packet
    loss_recovery.spaces[pn_space].sent_packets.insert(
        1,
        SentPacket {
            ack_eliciting: true,
            time_sent: now,
            tokens: vec![RecoveryToken::Ack(crate::tracking::AckToken {
                space: pn_space,
                ranges: vec![],
            })],
            time_declared_lost: None,
        },
    );

    // Simulate detecting the packet as lost
    let lost_packets = loss_recovery.detect_lost_packets(pn_space, now + rtt * 3);
    assert_eq!(lost_packets.len(), 1);

    // Simulate time passing beyond 2*RTT
    let _ = loss_recovery.detect_lost_packets(pn_space, now + rtt * 5);

    // Check that the packet is removed after 2*RTT
    assert!(loss_recovery.spaces[pn_space].sent_packets.is_empty());
}
</Rust>