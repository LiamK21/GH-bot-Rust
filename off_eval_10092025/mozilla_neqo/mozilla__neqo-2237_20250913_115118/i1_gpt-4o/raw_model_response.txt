<Filename>
neqo-udp/src/lib.rs
</Filename>
<imports>
use super::send_inner;
use std::io;
use quinn_udp::{UdpSocketState, UdpSockRef};
use std::net::UdpSocket;
</imports>
<Rust>
#[test]
fn test_send_inner_io_error() {
    let socket = UdpSocket::bind("127.0.0.1:0").expect("Failed to bind socket");
    let state = UdpSocketState::default();
    let datagram = Datagram {
        destination: "127.0.0.1:1".parse().unwrap(),
        source: None,
        ecn: None,
        segment_size: None,
        contents: vec![0; 10],
    };

    // Simulate an IO error by closing the socket
    drop(socket);

    let result = send_inner(&state, UdpSockRef::new(&socket), &datagram);
    assert!(result.is_err());
    if let Err(e) = result {
        assert_ne!(e.kind(), io::ErrorKind::WouldBlock);
    }
}
</Rust>