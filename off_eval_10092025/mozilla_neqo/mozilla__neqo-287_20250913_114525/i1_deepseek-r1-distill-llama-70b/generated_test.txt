#[test]
fn test_encoder_respects_pmtu() {
    let mut conn = Connection::new();
    let pmtu = conn.pmtu();
    let mut encoder = Vec::new();

    // Write data to the encoder until it reaches PMTU
    let data = b"test_data".to_vec();
    for _ in 0..(pmtu / data.len()) + 1 {
        encoder.write_all(&data).unwrap();
    }

    // Check that the encoder length does not exceed PMTU
    assert!(encoder.len() <= pmtu);
}