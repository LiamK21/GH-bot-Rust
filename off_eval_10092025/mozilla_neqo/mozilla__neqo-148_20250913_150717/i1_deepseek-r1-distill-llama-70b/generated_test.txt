#[test]
fn test_cstring_use_after_free() {
    let mut agent = SecretAgent::new().unwrap();
    // Create a CString that will fail
    let long_string = "a".repeat(300); // Exceeds NSS's internal buffer size
    let cstr = CString::new(long_string);
    assert!(cstr.is_err(), "CString::new should fail with a too-long string");

    // Now test that SSL_SetURL properly propagates the error
    let result = SSL_SetURL(&mut agent.fd as *mut _, cstr.unwrap().as_ptr());
    assert!(result.is_err(), "SSL_SetURL should return an error when CString::new fails");
}