#[test]
fn test_socket_buffer_size_increase() {
    let addr = "127.0.0.1:0";
    let socket = Socket::bind(addr).expect("Failed to bind socket");

    const ONE_MB: usize = 1 << 20;

    let send_buf_size = socket.state.send_buffer_size((&socket.inner).into()).expect("Failed to get send buffer size");
    let recv_buf_size = socket.state.recv_buffer_size((&socket.inner).into()).expect("Failed to get recv buffer size");

    assert!(recv_buf_size >= ONE_MB, "Receive buffer size did not increase as expected");
    // Note: The send buffer size is not changed in the patch, so we do not assert on it.
}