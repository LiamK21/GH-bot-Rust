#[test]
fn test_state_change_before_new_stream_event() {
  let mut conn = Connection::default();
  conn.events.connection_state_change(State::Connected);
  conn.events.new_stream(1.into());
  let mut events: VecDeque<ConnectionEvent> = VecDeque::new();
  loop {
    if let Some(event) = conn.events.next_event() {
      events.push_back(event);
    } else {
      break;
    }
  }
  let first_event = events.pop_front().unwrap();
  let second_event = events.pop_front().unwrap();
  assert!(matches!(first_event, ConnectionEvent::StateChange(State::Connected)));
  assert!(matches!(second_event, ConnectionEvent::NewStream { stream_id: 1, stream_type: _ }));
}