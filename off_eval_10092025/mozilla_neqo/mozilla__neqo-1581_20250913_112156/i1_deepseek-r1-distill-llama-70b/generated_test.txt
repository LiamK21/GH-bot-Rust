#[tokio::test]
fn test_timeout_handling_after_patch() {
    let test_server = Box::new(
        struct TestServer;
        impl HttpServer for TestServer {
            fn process(&self, _: Option<&Datagram>, _: u64) -> Output {
                Output::Callback(Some(Duration::from_millis(100)))
            }
            fn process_events(&self, _: &Args, _: u64) {}
        }
    );

    let mut runner = ServersRunner::new(Args::from_args()).unwrap();
    runner.server = test_server;

    let timeout_future = runner.process(None).await;
    let timeout = sleep(Duration::from_millis(200)).await;

    let (processed, _) = futures::join!(timeout_future, timeout);
    assert!(processed.is_ok());
}