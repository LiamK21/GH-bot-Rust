#[test]
fn test_server_udp_no_allocation() {
    // Set up server and client
    let mut server = HttpServer::new();
    let client = std::net::UdpSocket::bind("127.0.0.1:0").unwrap();

    // Send a request to the server
    let request = b"GET / HTTP/1.1\r\nHost: localhost\r\n\r\n";
    let server_addr = "127.0.0.1:8080".parse().unwrap();
    client.send_to(request, server_addr).unwrap();

    // Check if processing the request allocates memory
    let now = Instant::now;
    let result = server.process(Some(Datagram::from(request.to_vec())), now());

    // Using Miri to check for allocations
    miri::check_unsafe_block(|| {
        assert!(result.is_ok(), "Server processing failed");
        assert_eq!(miri::allocator::get_allocated(), 0, "Memory was allocated during processing");
    });
}