#[test]
fn test_init_with_insufficient_version() {
    // Setup: Mock NSS_VersionCheck to return 0 (insufficient version)
    let min_ver = CString::new("3.0").unwrap();
    unsafe {
        libc::setenv("NSS_INITARGS", "disable_builtins: yes", 0);
        // Override NSS_VersionCheck to return 0
        let mock_nss_version_check = libc::dlopen("libnss3.so", libc::RTLD_NOLOAD).unwrap();
        let version_check = libc::dlsym(mock_nss_version_check, "NSS_VersionCheck\0".as_ptr() as *const _);
        // Mock the function to return 0
        let mock = libc::dlsym(libc::RTLD_SELF, "mock_version_check\0".as_ptr() as *const _);
        libc::dlsethook(version_check as *mut _, mock);
    }

    let result = init();
    assert_eq!(result, Err(Error::UnsupportedVersion));

    // Cleanup
    unsafe { unsetenv("NSS_INITARGS") };
}