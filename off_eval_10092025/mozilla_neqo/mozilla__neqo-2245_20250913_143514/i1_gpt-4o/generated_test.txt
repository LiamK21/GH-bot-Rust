#[test]
fn test_take_ranges_optimization() {
    let mut sent_packets = SentPackets {
        packets: BTreeMap::new(),
    };

    // Simulate packets in flight
    for i in 0..100 {
        sent_packets.packets.insert(i, i);
    }

    // Define acked ranges
    let acked_ranges = vec![0..2];

    // Expected result after taking ranges
    let expected_result: Vec<i32> = vec![1, 0];

    // Call the function under test
    let actual_result: Vec<i32> = sent_packets.take_ranges(acked_ranges.into_iter());

    // Compare expected with actual
    assert_eq!(expected_result, actual_result);

    // Ensure remaining packets are correct
    let expected_remaining: Vec<i32> = (2..100).collect();
    let actual_remaining: Vec<i32> = sent_packets.packets.values().cloned().collect();
    assert_eq!(expected_remaining, actual_remaining);
}