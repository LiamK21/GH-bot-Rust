#[test]
fn test_idle_timeout_expiry() {
    let mut idle_timeout = IdleTimeout::new(Duration::from_secs(10));
    let now = Instant::now();
    let pto = Duration::from_secs(1);

    // Simulate the initial state where no packets have been received or sent.
    let expiry_time = idle_timeout.expiry(now, pto);
    assert_eq!(expiry_time, now + Duration::from_secs(10));

    // Simulate receiving a packet.
    idle_timeout.on_packet_received(now + Duration::from_secs(1));
    let expiry_time_after_receive = idle_timeout.expiry(now + Duration::from_secs(1), pto);
    assert_eq!(expiry_time_after_receive, now + Duration::from_secs(11));

    // Simulate sending an ack-eliciting packet.
    idle_timeout.on_packet_sent(now + Duration::from_secs(2));
    let expiry_time_after_send = idle_timeout.expiry(now + Duration::from_secs(2), pto);
    assert_eq!(expiry_time_after_send, now + Duration::from_secs(12));
}