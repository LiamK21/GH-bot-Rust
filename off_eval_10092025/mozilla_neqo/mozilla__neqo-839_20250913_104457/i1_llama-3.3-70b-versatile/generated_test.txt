#[test]
fn test_idle_timeout_expiration() {
  let mut idle_timeout = IdleTimeout { timeout: Duration::from_secs(10), state: IdleTimeoutState::Init };
  let now = Instant::now();
  let pto = Duration::from_millis(10);
  let expiry_before_patch = idle_timeout.expiry(now, pto);
  assert!(expiry_before_patch == now + max(Duration::from_secs(10), pto * 3));
  let idle_timeout_after_patch = IdleTimeout { timeout: Duration::from_secs(10), state: IdleTimeoutState::New(now) };
  let expiry_after_patch = idle_timeout_after_patch.expiry(now, pto);
  assert!(expiry_after_patch == now + max(Duration::from_secs(10), pto * 3));
}