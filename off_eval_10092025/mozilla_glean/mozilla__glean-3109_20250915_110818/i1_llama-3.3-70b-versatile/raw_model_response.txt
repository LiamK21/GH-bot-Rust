<Filename> glean-core/src/lib.rs </Filename>
<imports> 
use super::glean_set_collection_enabled;
use super::glean_set_ping_enabled;
use super::glean_apply_server_knobs_config;
use super::glean_set_debug_view_tag;
use super::glean_set_source_tags;
use super::glean_set_log_pings;
use super::glean_submit_ping_by_name_sync;
use super::glean_set_dirty_flag;
use super::glean_update_attribution;
use super::glean_test_get_attribution;
use super::glean_update_distribution;
use std::thread;
use std::sync::{Arc, Mutex};
</imports>
<Rust>
#[test]
fn test_glean_init_race() {
  let initialized = Arc::new(Mutex::new(false));
  let initialized_clone = Arc::clone(&initialized);
  let handle = thread::spawn(move || {
    glean_set_collection_enabled(true);
    *initialized_clone.lock().unwrap() = true;
  });
  while *initialized.lock().unwrap() == false {
    thread::yield_now();
  }
  handle.join().unwrap();
  assert!(glean_set_ping_enabled(&"test.ping".into(), true));
}</Rust>