<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use super::PingUploadManager;
use crate::glean::Glean;
use crate::metrics::Metric;
use crate::metrics::U64Metric;
</imports>
<Rust>
#[test]
fn test_pending_pings_directory_size_accumulation() {
    let glean = Glean::new();
    let mut ping_upload_manager = PingUploadManager::new();
    let pending_pings_directory_size = 2048; // 2 KB

    // Expected value after patch: size in KB
    let expected_size_in_kb = pending_pings_directory_size / 1024;

    // Simulate the accumulation
    ping_upload_manager.upload_metrics.pending_pings_directory_size.accumulate(&glean, pending_pings_directory_size as u64 / 1024);

    // Retrieve the accumulated value
    let actual_size_in_kb = ping_upload_manager.upload_metrics.pending_pings_directory_size.test_get_value(&glean).unwrap();

    // Compare expected and actual values
    assert_eq!(expected_size_in_kb, actual_size_in_kb);
}
</Rust>