<Filename> glean-core/src/upload/mod.rs </Filename>
<imports> 
use super::PingUploadManager;
use std::sync::atomic::{AtomicBool, Ordering};
use std::thread;
use std::collections::VecDeque;
use log;
use serde_json::Value as JsonValue;
use std::time::Duration;
use std::thread::sleep;
</imports>
<Rust>
#[test]
fn test_clearing_the_queue_doesnt_clear_deletion_request_pings() {
  let mut upload_manager = PingUploadManager::new("test");
  let ping_type = "test";
  let schema_version = "1";
  let doc_id = "doc_id";
  let uuid = "uuid";
  let body = json!({"key":"value"});
  upload_manager.enqueue_ping(uuid, &format!("/submit/app_id/{}/{}", ping_type, schema_version), body.clone());
  upload_manager.enqueue_ping(uuid, &format!("/submit/app_id/deletion-request/{}", schema_version), body);
  let _ = upload_manager.clear_ping_queue();
  let upload_task = upload_manager.get_upload_task();
  match upload_task {
    PingUploadTask::Upload(request) => assert!(request.is_deletion_request()),
    _ => panic!("Expected upload manager to return the next request!"),
  }
  let upload_task = upload_manager.get_upload_task();
  match upload_task {
    PingUploadTask::Done => assert!(true),
    _ => panic!("Expected Done!"),
  }
}
</Rust>