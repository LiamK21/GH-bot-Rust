<Filename> glean-core/src/lib.rs </Filename>
<imports> 
use super::OnGleanEvents;
use super::CallbackError;
use super::glean_set_upload_enabled;
use std::sync::atomic::{AtomicBool, Ordering};
use std::sync::{Arc, Mutex};
use log::error;
</imports>
<Rust>
#[test]
fn test_trigger_upload_error_handling() {
  let callbacks = MockOnGleanEvents {};
  let result = callbacks.trigger_upload();
  assert!(result.is_err());
  glean_set_upload_enabled(true);
  let result = callbacks.trigger_upload();
  assert!(result.is_err());
}

struct MockOnGleanEvents {}

impl OnGleanEvents for MockOnGleanEvents {
  fn trigger_upload(&self) -> Result<(), CallbackError> {
    Err(CallbackError::UnexpectedError)
  }

  fn start_metrics_ping_scheduler(&self) -> bool {
    true
  }

  fn cancel_uploads(&self) -> Result<(), CallbackError> {
    Ok(())
  }
}
</Rust>