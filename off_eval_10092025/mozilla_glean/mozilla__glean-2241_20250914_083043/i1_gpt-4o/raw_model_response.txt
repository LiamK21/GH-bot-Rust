<Filename>glean-core/src/lib.rs</Filename>
<imports>
use super::initialize_inner;
use std::sync::{Arc, Mutex};
use crate::OnGleanEvents;
use crate::glean_core::CallbackError;
</imports>
<Rust>
#[test]
fn test_trigger_upload_error_handling() {
    struct MockGleanEvents;
    impl OnGleanEvents for MockGleanEvents {
        fn trigger_upload(&self) -> Result<(), CallbackError> {
            Err(CallbackError::UnexpectedError)
        }
        fn start_metrics_ping_scheduler(&self) -> bool {
            true
        }
        fn cancel_uploads(&self) -> Result<(), CallbackError> {
            Ok(())
        }
    }

    let cfg = InternalConfiguration::default();
    let client_info = ClientInfoMetrics::default();
    let callbacks = Box::new(MockGleanEvents);

    let result = std::panic::catch_unwind(|| {
        initialize_inner(cfg, client_info, callbacks);
    });

    assert!(result.is_err());
}
</Rust>