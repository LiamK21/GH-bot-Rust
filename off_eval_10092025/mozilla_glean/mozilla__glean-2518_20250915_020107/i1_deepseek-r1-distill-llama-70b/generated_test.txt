#[test]
fn test_shutdown_before_init() {
    // Simulate a scenario where shutdown is called before initialization completes
    let handle = thread::spawn(|| {
        thread::sleep(Duration::from_millis(100));
        // Initialize after a short delay
        let result = initialize_inner(InternalConfiguration::default(), ClientInfoMetrics::default(), Box::new(OnGleanEvents::default()));
        assert!(result.is_ok());
    });

    // Immediately call shutdown on the main thread
    shutdown();

    // Wait for the thread to finish
    handle.join().unwrap();

    // Check if Glean was properly initialized
    assert!(global_glean().is_some());
}