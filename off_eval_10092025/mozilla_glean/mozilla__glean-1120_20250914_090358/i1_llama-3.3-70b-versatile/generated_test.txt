#[test]
fn test_maximum_recoverable_failures() {
  let (mut glean, _) = new_glean(None);
  let ping_type = PingType::new("test", true, /* send_if_empty */ true, vec![]);
  glean.register_ping_type(&ping_type);
  for _ in 0..5 {
      glean.submit_ping(&ping_type, None).unwrap();
  }
  for _ in 0..3 {
      match get_upload_task(&glean, true) {
          PingUploadTask::Upload(req) => {
              glean.process_ping_upload_response(&req.document_id, RecoverableFailure)
          }
          _ => panic!("Expected upload manager to return the next request!"),
      }
  }
  assert_eq!(get_upload_task(&glean, true), PingUploadTask::Done);
}