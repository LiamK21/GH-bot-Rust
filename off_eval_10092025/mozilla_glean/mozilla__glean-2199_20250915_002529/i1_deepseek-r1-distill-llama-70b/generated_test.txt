#[test]
fn test_url_truncation() {
    let glean = Glean::new();
    let metric = UrlMetric::new(
        "test_url",
        "test_url",
        "test_url",
        None,
        MetricType::Url,
        &glean,
    );

    // Create a string longer than MAX_URL_LENGTH (8192)
    let long_path_base = "abcdefgh";
    let test_url = format!("glean://{}", long_path_base.repeat(2000));

    metric.set_sync(&glean, &test_url);

    // The expected value is the first 8192 characters
    let expected = format!("glean://{}", long_path_base.repeat(1023));

    assert_eq!(metric.get_value(&glean, "store1").unwrap(), expected);

    // Ensure no InvalidOverflow errors were recorded
    assert_eq!(
        test_get_num_recorded_errors(&glean, metric.meta(), ErrorType::InvalidOverflow),
        0
    );
}