#[test]
fn test_error_reporting_in_subprocess() {
    // Initialize Glean for subprocess
    let cfg = Configuration {
        data_path: "/tmp/glean_test".into(),
        upload_enabled: true,
        ..Default::default()
    };

    let glean = Glean::new_for_subprocess(&cfg).unwrap();

    // Define test document ID
    let document_id = CString::new("test-doc-id").unwrap();

    // Create a dummy upload task
    let mut task = FfiPingUploadTask::Upload {
        document_id: document_id.as_ptr(),
        ..Default::default()
    };

    // Process the upload response with an error status
    unsafe {
        glean_process_ping_upload_response(&mut task as *mut FfiPingUploadTask, 400);
    }

    // Verify that the error was recorded
    let result = UploadResult::from_glean(glean);
    assert!(result.is_err());
}