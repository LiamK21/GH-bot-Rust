#[test]
fn test_boolean_metric_set_off_main_thread() {
    let _ = env_logger::builder().is_test(true).try_init();

    let metric = BooleanMetric::new(glean_core::CommonMetricData {
        name: "test_boolean".to_string(),
        description: "Test boolean metric".to_string(),
        ..Default::default()
    });

    let result = Arc::new(Mutex::new(None));
    let result_clone = Arc::clone(&result);

    // Set the metric to true off the main thread
    metric.set(true);

    // Block until all tasks are processed
    dispatcher::block_on_queue();

    // Now check the value
    let value = metric.test_get_value("test_boolean");
    *result_clone.lock().unwrap() = Some(value);

    assert_eq!(Some(Some(true)), *result.lock().unwrap());
}