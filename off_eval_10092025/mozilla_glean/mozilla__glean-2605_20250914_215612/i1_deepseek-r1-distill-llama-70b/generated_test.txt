#[test]
fn test_snapshot_labeled_metrics_behavior() {
    let mut snapshot = HashMap::new();
    let metric_id = "test/metric";
    let metric = serde_json::json!({
        "value": 42
    });

    snapshot_labeled_metrics(&mut snapshot, metric_id, &metric);

    let expected = HashMap::from({
        let mut map = HashMap::new();
        map.insert("test".to_string(), json!({ "value": 42 }));
        map
    });

    let actual = snapshot.get("labeled_test").cloned().unwrap_or_default();
    assert_eq!(expected, actual);
}