<Filename> glean-core/src/lib_unit_tests.rs </Filename>
<imports> 
use super::*;
use crate::metrics::{TimingDistributionMetric, TimeUnit};
use crate::metrics::CommonMetricData;
use std::collections::HashSet;
</imports>
<Rust>
#[test]
fn test_timing_distribution_truncation() {
    let dir = tempfile::tempdir().unwrap();
    let (glean, _) = new_glean(Some(dir));
    let max_sample_time = 1000 * 1000 * 1000 * 60 * 10;
    let mut dist = TimingDistributionMetric::new(
        CommonMetricData {
            name: "local_metric_test".into(),
            category: "local".into(),
            send_in_pings: vec!["baseline".into()],
            ..Default::default()
        },
        TimeUnit::Nanosecond,
    );
    let timer_id = dist.set_start(0);
    dist.set_stop_and_accumulate(&glean, timer_id, max_sample_time * 1000);
    let hist = dist.test_get_value(&glean, "baseline").unwrap();
    let keys = HashSet::<u64>::from_iter(hist.values().keys().cloned());
    assert!(keys.len() < 316);
}
</Rust>