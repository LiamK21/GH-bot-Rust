#[test]
fn test_lock_order_inversion_fix() {
    let metric = Arc::new(TimingDistributionMetric::new());
    let handles: Vec<_> = (0..10)
        .map(|i| {
            let metric_clone = Arc::clone(&metric);
            thread::spawn(move || {
                let result = metric_clone.test_get_value(None);
                assert!(result.is_some(), "Should get a value");
            })
        })
        .collect();

    for handle in handles {
        handle.join().unwrap();
    }
}