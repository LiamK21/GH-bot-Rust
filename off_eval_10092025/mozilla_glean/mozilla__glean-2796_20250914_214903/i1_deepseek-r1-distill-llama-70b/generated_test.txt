#[test]
fn test_object_metric_set_string() {
    let metric = ObjectMetric::new("test_object");

    // Test valid JSON
    let expected_value = json!({"key": "value"});
    let mut actual_value = None;

    launch_with_glean(|glean| {
        metric.set_string(glean, serde_json::to_string(&expected_value).unwrap());
        let result = glean.storage().get::<String>(glean, &metric.meta);
        if let Some(value) = result {
            actual_value = Some(serde_json::from_str(&value).unwrap());
        }
    });

    assert_eq!(expected_value, actual_value.unwrap());

    // Test invalid JSON
    let invalid_json = "{invalid: json}";
    let mut error_recorded = false;

    launch_with_glean(|glean| {
        metric.set_string(glean, invalid_json.to_string());
        let errors = glean.storage().get_errors(glean, &metric.meta);
        if let Some(errors) = errors {
            for error in errors {
                if error.error_type == ErrorType::InvalidValue {
                    error_recorded = true;
                    break;
                }
            }
        }
    });

    assert!(error_recorded);
}