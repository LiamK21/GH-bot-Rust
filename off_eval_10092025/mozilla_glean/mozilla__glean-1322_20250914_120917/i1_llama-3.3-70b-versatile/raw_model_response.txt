<Filename> glean-core/src/database/mod.rs </Filename>
<imports> 
use super::migrate;
use std::path::Path;
use tempfile::tempdir;
use rkv::Rkv;
use rkv::backend::Lmdb;
use rkv::backend::SafeMode;
</imports>
<Rust>
#[test]
fn test_migrate_lmdb_to_safe_mode() {
  let dir = tempdir().unwrap();
  let path = dir.path().join("db");
  fs::create_dir_all(&path).expect("create dir");
  let rkv_db = Rkv::new::<Lmdb>(&path).expect("rkv env");
  let store = rkv_db.open_single("ping", rkv::store::StoreOptions::create()).expect("opened");
  let mut writer = rkv_db.write().expect("writer");
  writer.commit().expect("committed");
  let datamdb = path.join("data.mdb");
  let lockmdb = path.join("lock.mdb");
  assert!(datamdb.exists());
  assert!(lockmdb.exists());
  migrate(&path, &Rkv::new::<SafeMode>(&path).expect("rkv env"));
  assert!(!datamdb.exists());
  assert!(!lockmdb.exists());
}
</Rust>