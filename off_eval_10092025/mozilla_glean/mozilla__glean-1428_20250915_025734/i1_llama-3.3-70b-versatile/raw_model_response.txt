<Filename> glean-core/src/lib_unit_tests.rs </Filename>
<imports> 
use std::fs;
use super::Glean;
use super::new_glean;
use super::CoreMetrics;
use env_logger::builder;
</imports>
<Rust>
#[test]
fn test_io_errors_are_recorded() {
  let _ = builder::new().is_test(true).try_init();
  let (glean, _data_dir) = new_glean(None);
  let pending_pings_dir = glean.get_data_path().join(crate::PENDING_PINGS_DIRECTORY);
  fs::create_dir_all(&pending_pings_dir).unwrap();
  let attr = fs::metadata(&pending_pings_dir).unwrap();
  let original_permissions = attr.permissions();
  let mut permissions = original_permissions.clone();
  permissions.set_readonly(true);
  fs::set_permissions(&pending_pings_dir, permissions).unwrap();
  let submitted = glean.internal_pings.metrics.submit(&glean, None);
  assert!(submitted.is_err());
  let metric = &glean.core_metrics.io_errors;
  assert_eq!(1, metric.test_get_value(&glean, "metrics").unwrap());
  fs::set_permissions(&pending_pings_dir, original_permissions).unwrap();
}</Rust>