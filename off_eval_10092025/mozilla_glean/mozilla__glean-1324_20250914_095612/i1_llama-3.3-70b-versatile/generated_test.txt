#[test]
fn test_setting_long_string_records_error() {
  let (glean, _) = new_glean(None);
  let metric = StringMetric::new(crate::CommonMetricData {
    name: "string_metric".into(),
    category: "test".into(),
    send_in_pings: vec!["store1".into()],
    lifetime: Lifetime::Application,
    disabled: false,
    dynamic_label: None,
  });
  let sample_string = "0123456789".repeat(11);
  metric.set(sample_string.clone());
  let truncated = truncate_string_at_boundary(sample_string, 14);
  assert_eq!(truncated, metric.test_get_value("store1").unwrap());
  assert_eq!(1, metric.test_get_num_recorded_errors(ErrorType::InvalidOverflow, "store1"));
}