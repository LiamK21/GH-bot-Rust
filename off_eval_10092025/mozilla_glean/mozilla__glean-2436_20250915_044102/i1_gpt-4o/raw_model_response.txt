<Filename>glean-core/src/upload/mod.rs</Filename>
<imports>
use super::create_date_header_value;
use chrono::Utc;
use crate::upload::PingUploadManager;
use crate::upload::PingUploadTask;
use crate::upload::PingRequest;
use std::collections::VecDeque;
</imports>
<Rust>
#[test]
fn test_date_header_set_at_upload_time() {
    // Initialize required variables
    let mut queue = VecDeque::new();
    let mut request = PingRequest {
        document_id: "test-doc-id".to_string(),
        path: "/test/path".to_string(),
        body: vec![],
        headers: std::collections::HashMap::new(),
    };
    queue.push_back(request);

    let mut in_flight = std::collections::HashMap::new();
    let success_id = 1;
    let failure_id = 2;

    // Generate actual variables
    let task = PingUploadManager::get_upload_task(&mut queue, &mut in_flight, success_id, failure_id);

    // Define expected variable
    let expected_date_header = create_date_header_value(Utc::now());

    // Compare expected with actual
    if let PingUploadTask::Upload { request } = task {
        assert_eq!(request.headers.get("Date").unwrap(), &expected_date_header);
    } else {
        panic!("Expected an Upload task");
    }
}
</Rust>