#[test]
fn test_date_header_set_at_upload_time() {
    let mut upload_manager = PingUploadManager::new();

    // Create a test ping
    let request = PingRequestBuilder::new("test".to_string(), 100)
        .build()
        .unwrap();

    // Enqueue the ping
    upload_manager.enqueue(request).unwrap();

    // Simulate some delay before upload
    thread::sleep(Duration::from_secs(1));

    // Get the current time after delay
    let expected_time = Utc::now();

    // Force an upload task to be created
    let task = upload_manager.get_upload_task().unwrap();

    // Get the actual Date header value
    let actual_header = task.request.headers.get("Date").unwrap();
    let actual_time = create_date_header_value(Utc::now());

    // The actual header should be close to the current time after delay
    assert!(actual_header >= &actual_time);
}