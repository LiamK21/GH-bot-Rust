#[test]
fn test_record_with_time_records_event() {
    let metric = EventMetric::<u32>::new("test_event".into());
    let timestamp = get_timestamp_ms();
    let mut extra = HashMap::new();
    extra.insert(1, "test_extra".to_string());

    metric.record_with_time(timestamp, extra.clone());

    let stored_events = metric.inner.event_store.read().unwrap();
    assert!(stored_events.iter().any(|event| {
        event.timestamp == timestamp && event.extra == extra
    }));
}