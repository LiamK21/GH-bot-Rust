#[test]
fn test_gen_coverage_json_reports_correct_coverage() {
    let stats = HtmlStats {
        covered_lines: 24,
        total_lines: 100,
        ..Default::default()
    };
    let conf = Config {
        hi_limit: 80,
        med_limit: 50,
        ..Default::default()
    };
    let output_path = Path::new("test_coverage.json");

    gen_coverage_json(&stats, &conf, &output_path);

    let expected = r#"{"schemaVersion":1,"label":"coverage","message":"24%","color":"red"}"#;
    let actual = std::fs::read_to_string(output_path).unwrap();

    assert_eq!(expected, actual);
    std::fs::remove_file(output_path).unwrap();
}