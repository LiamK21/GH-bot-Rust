<Filename> src/output.rs </Filename>
<imports> 
use super::output_covdir;
use std::collections::BTreeMap;
use std::path::PathBuf;
use crate::defs::CovResult;
use crate::defs::CovResultIter;
</imports>
<Rust>
#[test]
fn test_output_covdir() {
  let results = vec![
    (PathBuf::from("foo/bar/a.cpp"), 
     PathBuf::from("foo/bar/a.cpp"), 
     CovResult { 
       lines: [(1, 10), (2, 11)].iter().cloned().collect(), 
       branches: BTreeMap::new(), 
       functions: std::collections::HashMap::default(), 
     }),
    (PathBuf::from("foo/bar/b.cpp"), 
     PathBuf::from("foo/bar/b.cpp"), 
     CovResult { 
       lines: [(1, 0), (2, 10), (4, 0)].iter().cloned().collect(), 
       branches: BTreeMap::new(), 
       functions: std::collections::HashMap::default(), 
     }),
  ];
  let results: CovResultIter = Box::new(results.into_iter());
  let temp_file = std::path::PathBuf::from("test.json");
  output_covdir(results, Some(temp_file.to_str().unwrap()));
  let json: serde_json::Value = serde_json::from_str(&std::fs::read_to_string(temp_file).unwrap()).unwrap();
  let children = json["children"].as_object().unwrap();
  assert!(children.contains_key("foo"));
  assert!(children["foo"].as_object().unwrap().contains_key("bar"));
  assert!(children["foo"]["bar"].as_object().unwrap().contains_key("a.cpp"));
  assert!(children["foo"]["bar"].as_object().unwrap().contains_key("b.cpp"));
}
</Rust>