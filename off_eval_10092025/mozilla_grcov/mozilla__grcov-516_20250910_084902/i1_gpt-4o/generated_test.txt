#[test]
fn test_profraw_producer_sends_correct_work_item() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let tmp_path = tmp_dir.path();

    let mut profraws = FxHashMap::default();
    profraws.insert("test1.profraw".to_string(), vec![]);
    profraws.insert("test2.profraw".to_string(), vec![]);

    let (sender, receiver) = mpsc::channel();

    profraw_producer(tmp_path, &profraws, &sender);

    let work_item = receiver.recv().unwrap();
    if let ItemType::Paths(paths) = work_item.item {
        assert_eq!(paths.len(), 2);
        assert!(paths.iter().any(|p| p.ends_with("test1.profraw")));
        assert!(paths.iter().any(|p| p.ends_with("test2.profraw")));
    } else {
        panic!("Expected ItemType::Paths");
    }
}