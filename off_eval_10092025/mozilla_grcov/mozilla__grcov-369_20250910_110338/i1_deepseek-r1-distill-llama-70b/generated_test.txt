#[test]
fn test_duplicate_fn_handling() {
    let lcov_content = "FN:1,top-level
FNDA:1,1
FN:2,top-level
FNDA:2,1";

    let mut lines = lcov_content.lines();
    let reader = BufReader::new(io::Cursor::new(lines));
    let results = parse_lcov(reader, true).unwrap();

    assert_eq!(results.len(), 1);
    let (source_name, result) = &results[0];
    assert!(source_name.is_some());

    let functions = &result.functions;
    assert!(functions.contains_key("top-level"));
    let func = functions.get("top-level").unwrap();
    assert_eq!(func.start, 2);
    assert_eq!(func.executed, true);
}