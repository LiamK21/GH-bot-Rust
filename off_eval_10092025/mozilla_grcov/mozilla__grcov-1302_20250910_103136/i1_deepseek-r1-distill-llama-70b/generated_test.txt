#[test]
fn test_absolute_links_with_prefix() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let output = tmp_dir.path().join("test.html");
    let mut context = Context::new();
    context.insert("current", "test");
    context.insert("parents", &[(PathBuf::from("test"), "test")]);
    context.insert("stats", &());

    // Test with abs_link_prefix
    gen_html(
        &tera::Tera::default(),
        PathBuf::from("test"),
        &(),
        &(),
        &output,
        PathBuf::from("test"),
        Arc::new(std::sync::Mutex::new(serde_json::json!({}))),
        &Some(String::from("https://example.com/prefix/")),
    ).unwrap();

    assert!(output.exists());
    let content = std::fs::read_to_string(output).unwrap();
    assert!(content.contains("https://example.com/prefix/"));

    // Test without abs_link_prefix
    gen_html(
        &tera::Tera::default(),
        PathBuf::from("test"),
        &(),
        &(),
        &output,
        PathBuf::from("test"),
        Arc::new(std::sync::Mutex::new(serde_json::json!({})),
        &None,
    ).unwrap();

    let content = std::fs::read_to_string(output).unwrap();
    assert!(!content.contains("https://example.com/prefix/"));
}