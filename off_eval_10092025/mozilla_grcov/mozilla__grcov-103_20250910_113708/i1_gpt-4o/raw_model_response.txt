<Filename>src/lib.rs</Filename>
<imports>
use super::add_results;
use std::collections::HashMap;
use std::sync::{Arc, Mutex};
use std::path::PathBuf;
use std::fs::File;
use std::io::BufReader;
use crate::parse_lcov;
</imports>
<Rust>
#[test]
fn test_cleanup_dot_and_dotdot_in_paths() {
    let f = File::open("./test/relative_path/relative_path.info").expect("Failed to open lcov file");
    let file = BufReader::new(&f);
    let results = parse_lcov(file, false).unwrap();
    let result_map: Arc<SyncCovResultMap> = Arc::new(Mutex::new(HashMap::with_capacity(1)));
    add_results(results, &result_map, &Some(PathBuf::from("./test/relative_path")));
    let result_map = Arc::try_unwrap(result_map).unwrap().into_inner().unwrap();

    assert!(result_map.len() == 1);

    let cpp_file = fs::canonicalize(PathBuf::from("./test/relative_path/foo/bar/oof.cpp")).unwrap();
    let cpp_file = cpp_file.to_str().unwrap();
    let cov_result = result_map.get(cpp_file).unwrap();

    assert_eq!(cov_result.lines, [(1,63), (2,63), (3,84), (4,42)].iter().cloned().collect());
    assert!(cov_result.functions.contains_key("myfun"));
}
</Rust>