#[test]
fn test_get_coveralls_git_info() {
    let temp_dir = TempDir::new("grcov_test").unwrap();
    let repo_path = PathBuf::from(temp_dir.path()).join(".git");

    // Initialize a new Git repository
    let init = Command::new("git")
        .arg("init")
        .current_dir(&temp_dir)
        .stdout(Stdio::null())
        .stderr(Stdio::null())
        .spawn()
        .unwrap()
        .wait()
        .unwrap();
    assert!(init.success());

    // Create a test file and commit
    let file_path = temp_dir.path().join("test_file.txt");
    File::create(&file_path).unwrap();
    let add = Command::new("git")
        .arg("add")
        .arg(&file_path)
        .current_dir(&temp_dir)
        .stdout(Stdio::null())
        .stderr(Stdio::null())
        .spawn()
        .unwrap()
        .wait()
        .unwrap();
    assert!(add.success());

    // Create a commit with known author and message
    let commit = Command::new("git")
        .arg("commit")
        .arg("-m")
        .arg("test commit message")
        .env("GIT_AUTHOR_NAME", "Test Author")
        .env("GIT_AUTHOR_EMAIL", "test@author.com")
        .env("GIT_COMMITTER_NAME", "Test Committer")
        .env("GIT_COMMITTER_EMAIL", "test@committer.com")
        .current_dir(&temp_dir)
        .stdout(Stdio::null())
        .stderr(Stdio::null())
        .spawn()
        .unwrap()
        .wait()
        .unwrap();
    assert!(commit.success());

    // Get the commit SHA
    let commit_sha = Command::new("git")
        .arg("rev-parse")
        .arg("HEAD")
        .current_dir(&temp_dir)
        .stdout(Stdio::piped())
        .stderr(Stdio::piped())
        .spawn()
        .unwrap()
        .wait_with_output()
        .unwrap()
        .stdout
        .lines()
        .next()
        .unwrap()
        .to_string();

    let vcs_branch = "master";
    let actual = get_coveralls_git_info(&commit_sha, vcs_branch);

    let expected = json!({
        "head": {
            "id": commit_sha,
            "author_name": "Test Author",
            "author_email": "test@author.com",
            "committer_name": "Test Committer",
            "committer_email": "test@committer.com",
            "message": "test commit message"
        },
        "branch": "master",
        "remotes": []
    });

    assert_eq!(actual, expected);
}