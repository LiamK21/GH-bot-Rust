#[test]
fn test_jacoco_xml_consumer() {
    let tmp_dir = tempfile::tempdir().unwrap();
    let source_dir = PathBuf::from(env!("CARGO_MANIFEST_DIR"));
    let result_map = SyncCovResultMap::new();
    let queue = Arc::new(grcov::MsQueue::new());

    // Create a sample JaCoCo XML content
    let xml_content = r#"<coverage version="1.1">
        <sources>
            <source>src</source>
        </sources>
        <packages>
            <package name="example">
                <classes>
                    <class name="example.Class">
                        <methods>
                            <method name="method" line="1">
                                <lines>
                                    <line number="1" hits="1"/>
                                </lines>
                            </method>
                        </methods>
                    </class>
                </packages>
            </package>
        </coverage>"#;

    // Push the XML content into the queue as a work item
    queue.push(Some(grcov::WorkItem {
        format: grcov::ItemFormat::JACOCO_XML,
        item: grcov::ItemType::Content(xml_content.as_bytes().to_vec()),
        name: "test.xml".to_string(),
    }));

    consumer(&tmp_dir, &source_dir, &result_map, &queue, false, false);

    // Verify that the coverage was processed correctly
    assert!(result_map.results.read().unwrap().len() > 0);
}