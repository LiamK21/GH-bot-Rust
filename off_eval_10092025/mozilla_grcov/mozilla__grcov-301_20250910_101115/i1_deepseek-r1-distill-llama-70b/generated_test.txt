#[test]
fn test_coveralls_output_branch_name() {
    let temp_file = PathBuf::from("test_coveralls_output.json");
    let branch = "test_branch";

    // Generate some coverage data
    let cov_result = Command::new("echo")
        .arg("STABLE:1 (1, 1, 1) line 1")
        .output()
        .unwrap();

    output_coveralls(
        cov_result.get_output().unwrap().lines().map(|l| l.to_string()),
        "token",
        "service",
        "number",
        "job_number",
        "sha",
        false,
        Some(temp_file.as_path()),
        branch,
    );

    let mut file = File::open(temp_file).unwrap();
    let mut contents = String::new();
    file.read_to_string(&mut contents).unwrap();

    let json: Value = serde_json::from_str(&contents).unwrap();
    assert_eq!(json["head"]["branch"].as_str().unwrap(), branch);
}